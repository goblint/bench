6807c6807
< #line 2457 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2458 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
8274,8278c8274,8276
<     __ns.i = mdev->state.i;
< #line 1830
<     __ns.ldv_37520.disk = 4U;
< #line 1830
<     _drbd_set_state(mdev, __ns, CS_HARD, 0);
---
>     if ((int )mdev->state.ldv_37520.disk > 4) {
> #line 1831
>       __ns.i = mdev->state.i;
8279a8278,8284
>       __ns.ldv_37520.disk = 4U;
> #line 1831
>       _drbd_set_state(mdev, __ns, CS_HARD, 0);
>     } else {
> 
>     }
> #line 1832
8286,8287d8290
< #line 1836
<   set_bit(19U, (unsigned long volatile   *)(& mdev->flags));
8289c8292
<   if ((int )mdev->state.ldv_37520.disk > 2) {
---
>   set_bit(19U, (unsigned long volatile   *)(& mdev->flags));
8290a8294,8295
>   if ((int )mdev->state.ldv_37520.disk > 2) {
> #line 1839
8292c8297
< #line 1838
---
> #line 1839
8294,8295d8298
< #line 1838
<     _drbd_set_state(mdev, __ns___0, CS_HARD, 0);
8296a8300,8301
>     _drbd_set_state(mdev, __ns___0, CS_HARD, 0);
> #line 1840
8302c8307
< #line 1842
---
> #line 1843
8306c8311
< #line 1845
---
> #line 1846
8310c8315
< #line 1855 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1856 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
8318c8323
< #line 1858
---
> #line 1859
8320c8325
< #line 1860
---
> #line 1861
8322,8323d8326
< #line 1860
<     flags = _raw_spin_lock_irqsave(tmp);
8325c8328
<     __drbd_chk_io_error_(mdev, forcedetach, where);
---
>     flags = _raw_spin_lock_irqsave(tmp);
8326a8330,8331
>     __drbd_chk_io_error_(mdev, forcedetach, where);
> #line 1863
8331c8336
< #line 1864
---
> #line 1865
8335c8340
< #line 1890 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1891 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
8341c8346
< #line 1892
---
> #line 1893
8345c8350
< #line 1895
---
> #line 1896
8349c8354
< #line 1898
---
> #line 1899
8354c8359
< #line 2153 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2154 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
8361c8366
< #line 2155
---
> #line 2156
8363c8368
< #line 2155
---
> #line 2156
8365c8370
< #line 2157
---
> #line 2158
8367c8372
< #line 2157
---
> #line 2158
8370c8375
<             2157);
---
>             2158);
8374,8375d8378
< #line 2158
<   if (i == 0) {
8376a8380,8381
>   if (i == 0) {
> #line 2160
8378c8383
< #line 2161
---
> #line 2162
8383c8388
< #line 2162
---
> #line 2163
8385c8390
< #line 2164
---
> #line 2165
8390c8395
< #line 2165
---
> #line 2166
8395c8400
< #line 2167
---
> #line 2168
8399c8404
< #line 2170 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2171 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
8405,8406d8409
< #line 2175
<   if ((unsigned int )*((unsigned char *)mdev + 2277UL) == 0U) {
8407a8411,8412
>   if ((unsigned int )*((unsigned char *)mdev + 2277UL) == 0U) {
> #line 2177
8412,8413d8416
< #line 2178
<   atomic_inc(& mdev->local_cnt);
8415c8418
<   io_allowed = (unsigned int )mdev->state.ldv_37520.disk >= (unsigned int )mins;
---
>   atomic_inc(& mdev->local_cnt);
8417c8420
<   if (io_allowed == 0) {
---
>   io_allowed = (unsigned int )mdev->state.ldv_37520.disk >= (unsigned int )mins;
8418a8422,8423
>   if (io_allowed == 0) {
> #line 2182
8423c8428
< #line 2182
---
> #line 2183
8427c8432
< #line 2444 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2445 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
8434c8439
< #line 2448
---
> #line 2449
8436,8437d8440
< #line 2448
<   if (tmp != 0) {
8438a8442,8443
>   if (tmp != 0) {
> #line 2450
8443,8444d8447
< #line 2451
<   r = blkdev_issue_flush((mdev->ldev)->md_bdev, 208U, 0);
8446c8449
<   if (r != 0) {
---
>   r = blkdev_issue_flush((mdev->ldev)->md_bdev, 208U, 0);
8448c8451
<     set_bit(14U, (unsigned long volatile   *)(& mdev->flags));
---
>   if (r != 0) {
8449a8453,8454
>     set_bit(14U, (unsigned long volatile   *)(& mdev->flags));
> #line 2455
8455c8460
< #line 2456
---
> #line 2457
12126c12131
< #line 2189 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2190 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
12138,12139d12142
< #line 2200
<   if ((unsigned int )*((unsigned short *)mdev + 1138UL) == 288U || (unsigned int )*((unsigned short *)mdev + 1138UL) == 304U) {
12140a12144,12145
>   if ((unsigned int )*((unsigned short *)mdev + 1138UL) == 288U || (unsigned int )*((unsigned short *)mdev + 1138UL) == 304U) {
> #line 2202
12143c12148
< #line 2203
---
> #line 2204
12145c12150
< #line 2203
---
> #line 2204
12148c12153
< #line 2206
---
> #line 2207
12150,12151d12154
< #line 2212
<     __asm__  volatile   ("": : : "memory");
12152a12156,12157
>     __asm__  volatile   ("": : : "memory");
> #line 2214
12154c12159
< #line 2213
---
> #line 2214
12157c12162
< #line 2216
---
> #line 2217
12160,12161d12164
< #line 2227
<     shift = (unsigned long long )mdev->rs_total > 4294967295ULL ? 16U : 10U;
12163c12166
<     left = *bits_left >> (int )shift;
---
>     shift = (unsigned long long )mdev->rs_total > 4294967295ULL ? 16U : 10U;
12165c12168
<     total = (mdev->rs_total >> (int )shift) + 1UL;
---
>     left = *bits_left >> (int )shift;
12167c12170
<     tmp___1 = 1000UL - (left * 1000UL) / total;
---
>     total = (mdev->rs_total >> (int )shift) + 1UL;
12168a12172,12173
>     tmp___1 = 1000UL - (left * 1000UL) / total;
> #line 2232
12171c12176
< #line 2233
---
> #line 2234
12175c12180
< #line 2319 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2320 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
12181c12186
< #line 2321
---
> #line 2322
13714,13718c13719
<     __ns.i = mdev->state.i;
< #line 1830
<     __ns.ldv_37520.disk = 4U;
< #line 1830
<     _drbd_set_state(mdev, __ns, CS_HARD, 0);
---
>     if ((int )mdev->state.ldv_37520.disk > 4) {
13719a13721,13729
>       __ns.i = mdev->state.i;
> #line 1831
>       __ns.ldv_37520.disk = 4U;
> #line 1831
>       _drbd_set_state(mdev, __ns, CS_HARD, 0);
>     } else {
> 
>     }
> #line 1832
13726,13727d13735
< #line 1836
<   set_bit(19U, (unsigned long volatile   *)(& mdev->flags));
13729c13737
<   if ((int )mdev->state.ldv_37520.disk > 2) {
---
>   set_bit(19U, (unsigned long volatile   *)(& mdev->flags));
13730a13739,13740
>   if ((int )mdev->state.ldv_37520.disk > 2) {
> #line 1839
13732c13742
< #line 1838
---
> #line 1839
13734,13735d13743
< #line 1838
<     _drbd_set_state(mdev, __ns___0, CS_HARD, 0);
13736a13745,13746
>     _drbd_set_state(mdev, __ns___0, CS_HARD, 0);
> #line 1840
13742c13752
< #line 1842
---
> #line 1843
13746c13756
< #line 1845
---
> #line 1846
13750c13760
< #line 1903 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1904 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
13757c13767
< #line 1906
---
> #line 1907
13759c13769
< #line 1906
---
> #line 1907
13761c13771
< #line 1906
---
> #line 1907
13764c13774
< #line 1906
---
> #line 1907
13767c13777
< #line 1906
---
> #line 1907
13771c13781
< #line 1985 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1986 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
13778c13788
< #line 1988
---
> #line 1989
13780,13781d13789
< #line 1988
<   flags = _raw_spin_lock_irqsave(tmp);
13783c13791
<   list_add_tail(& w->list, & q->q);
---
>   flags = _raw_spin_lock_irqsave(tmp);
13784a13793,13794
>   list_add_tail(& w->list, & q->q);
> #line 1991
13786,13787d13795
< #line 1992
<   spin_unlock_irqrestore(& q->q_lock, flags);
13788a13797,13798
>   spin_unlock_irqrestore(& q->q_lock, flags);
> #line 1994
13792c13802
< #line 1995 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1996 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
13798c13808
< #line 1997
---
> #line 1998
13800,13801d13809
< #line 1997
<   if (tmp != 0) {
13802a13811,13812
>   if (tmp != 0) {
> #line 1999
13807c13817
< #line 1999
---
> #line 2000
13811c13821
< #line 2001 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2002 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
13817,13818d13826
< #line 2003
<   set_bit(2U, (unsigned long volatile   *)(& mdev->flags));
13820c13828
<   wake_asender(mdev);
---
>   set_bit(2U, (unsigned long volatile   *)(& mdev->flags));
13821a13830,13831
>   wake_asender(mdev);
> #line 2006
13825c13835
< #line 2007 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2008 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
13832c13842
< #line 2011
---
> #line 2012
13834c13844
< #line 2011
---
> #line 2012
13838c13848
< #line 2026 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2027 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
13844,13845d13853
< #line 2028
<   _drbd_thread_stop(thi, 0, 1);
13846a13855,13856
>   _drbd_thread_stop(thi, 0, 1);
> #line 2030
13850c13860
< #line 2086 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2087 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
13856,13857d13865
< #line 2088
<   atomic_inc(& mdev->rs_pending_cnt);
13858a13867,13868
>   atomic_inc(& mdev->rs_pending_cnt);
> #line 2090
18408c18418
< #line 1874 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1875 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18414c18424
< #line 1876
---
> #line 1877
18418c18428
< #line 1879
---
> #line 1880
18422c18432
< #line 1882
---
> #line 1883
18427c18437
< #line 1917 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1918 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18445c18455
< #line 1920
---
> #line 1921
18449c18459
< #line 1924
---
> #line 1925
18451c18461
< #line 1924
---
> #line 1925
18453c18463
< #line 1924
---
> #line 1925
18455c18465
< #line 1924
---
> #line 1925
18457c18467
< #line 1924
---
> #line 1925
18459c18469
< #line 1924
---
> #line 1925
18462c18472
< #line 1924
---
> #line 1925
18465c18475
< #line 1927
---
> #line 1928
18468c18478
< #line 1929
---
> #line 1930
18470c18480
< #line 1929
---
> #line 1930
18472c18482
< #line 1929
---
> #line 1930
18474c18484
< #line 1929
---
> #line 1930
18476c18486
< #line 1932
---
> #line 1933
18478c18488
< #line 1932
---
> #line 1933
18480c18490
< #line 1932
---
> #line 1933
18482c18492
< #line 1935
---
> #line 1936
18485c18495
< #line 1937
---
> #line 1938
18487c18497
< #line 1937
---
> #line 1938
18489c18499
< #line 1937
---
> #line 1938
18491c18501
< #line 1937
---
> #line 1938
18495c18505
< #line 1940
---
> #line 1941
18499c18509
< #line 1974 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1975 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18506c18516
< #line 1977
---
> #line 1978
18508,18509d18517
< #line 1977
<   flags = _raw_spin_lock_irqsave(tmp);
18511c18519
<   list_add(& w->list, & q->q);
---
>   flags = _raw_spin_lock_irqsave(tmp);
18512a18521,18522
>   list_add(& w->list, & q->q);
> #line 1980
18514,18515d18523
< #line 1981
<   spin_unlock_irqrestore(& q->q_lock, flags);
18516a18525,18526
>   spin_unlock_irqrestore(& q->q_lock, flags);
> #line 1983
18520c18530
< #line 2014 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2015 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18527c18537
< #line 2017
---
> #line 2018
18529c18539
< #line 2017
---
> #line 2018
18533c18543
< #line 2020 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2021 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18540c18550
< #line 2023
---
> #line 2024
18542c18552
< #line 2023
---
> #line 2024
18546c18556
< #line 2105 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2106 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18552,18553d18561
< #line 2107
<   atomic_inc(& mdev->unacked_cnt);
18554a18563,18564
>   atomic_inc(& mdev->unacked_cnt);
> #line 2109
18558c18568
< #line 2121 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2122 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18564c18574
< #line 2123
---
> #line 2124
18566,18567d18575
< #line 2123
<   if (tmp != 0) {
18568a18577,18578
>   if (tmp != 0) {
> #line 2125
18573c18583
< #line 2125
---
> #line 2126
18577c18587
< #line 2133 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2134 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18583,18584d18592
< #line 2137
<   atomic_inc(& mdev->net_cnt);
18586c18594
<   have_net_conf = (int )mdev->state.ldv_37520.conn > 1;
---
>   atomic_inc(& mdev->net_cnt);
18588c18596
<   if (have_net_conf == 0) {
---
>   have_net_conf = (int )mdev->state.ldv_37520.conn > 1;
18589a18598,18599
>   if (have_net_conf == 0) {
> #line 2141
18594c18604
< #line 2141
---
> #line 2142
18598c18608
< #line 2393 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2394 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18604,18605d18613
< #line 2395
<   changed = mdev->ed_uuid != val;
18607c18615
<   mdev->ed_uuid = val;
---
>   changed = mdev->ed_uuid != val;
18608a18617,18618
>   mdev->ed_uuid = val;
> #line 2398
18612c18622
< #line 2400 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2401 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18618c18628
< #line 2407
---
> #line 2408
18622c18632
< #line 2416 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2417 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
18629,18630d18638
< #line 2419
<   spin_lock(& mdev->peer_seq_lock);
18631a18640,18641
>   spin_lock(& mdev->peer_seq_lock);
> #line 2421
18633,18634d18642
< #line 2420
<   m = tmp > 0 ? mdev->peer_seq : new_seq;
18636c18644
<   mdev->peer_seq = m;
---
>   m = tmp > 0 ? mdev->peer_seq : new_seq;
18638c18646
<   spin_unlock(& mdev->peer_seq_lock);
---
>   mdev->peer_seq = m;
18640c18648
<   if (m == new_seq) {
---
>   spin_unlock(& mdev->peer_seq_lock);
18641a18650,18651
>   if (m == new_seq) {
> #line 2425
18646c18656
< #line 2425
---
> #line 2426
29532c29542
< #line 2063 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2064 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
29538,29539d29547
< #line 2065
<   atomic_inc(& mdev->ap_pending_cnt);
29540a29549,29550
>   atomic_inc(& mdev->ap_pending_cnt);
> #line 2067
29544c29554
< #line 2239 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2240 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
29551,29552d29560
< #line 2241
<   mxb = 1000000;
29553a29562,29563
>   mxb = 1000000;
> #line 2243
29555,29556d29564
< #line 2242
<   if (tmp != 0) {
29558c29566
<     mxb = (mdev->net_conf)->max_buffers;
---
>   if (tmp != 0) {
29559a29568,29569
>     mxb = (mdev->net_conf)->max_buffers;
> #line 2245
29564c29574
< #line 2246
---
> #line 2247
29568c29578
< #line 2249 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2250 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
29574c29584
< #line 2251
---
> #line 2252
29576c29586
< #line 2256
---
> #line 2257
29599c29609
< #line 2281
---
> #line 2282
29602,29603d29611
< #line 2285
<   if (mdev->agreed_pro_version <= 95) {
29604a29613,29614
>   if (mdev->agreed_pro_version <= 95) {
> #line 2287
29609c29619
< #line 2287
---
> #line 2288
29614c29624
< #line 2294
---
> #line 2295
29618c29628
< #line 2297
---
> #line 2298
29625c29635
< #line 2304
---
> #line 2305
29632c29642
< #line 2313
---
> #line 2314
29636c29646
< #line 2316
---
> #line 2317
29640c29650
< #line 2324 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2325 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
29652c29662
< #line 2326
---
> #line 2327
29654c29664
< #line 2326
---
> #line 2327
29656c29666
< #line 2328
---
> #line 2329
29658,29659d29667
< #line 2328
<   if (tmp___0 != 0) {
29660a29669,29670
>   if (tmp___0 != 0) {
> #line 2330
29665c29675
< #line 2330
---
> #line 2331
29667,29668d29676
< #line 2330
<   if (tmp___1 != 0) {
29669a29678,29679
>   if (tmp___1 != 0) {
> #line 2332
29674c29684
< #line 2338
---
> #line 2339
29676,29677d29685
< #line 2338
<   if (tmp___2 == 0) {
29678a29687,29688
>   if (tmp___2 == 0) {
> #line 2340
29683c29693
< #line 2343
---
> #line 2344
29685,29686d29694
< #line 2343
<   if (tmp___3 > mxb) {
29687a29696,29697
>   if (tmp___3 > mxb) {
> #line 2345
29692c29702
< #line 2345
---
> #line 2346
29694,29695d29703
< #line 2345
<   if (tmp___4 != 0) {
29696a29705,29706
>   if (tmp___4 != 0) {
> #line 2347
29701c29711
< #line 2347
---
> #line 2348
29705c29715
< #line 2350 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2351 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
29711c29721
< #line 2352
---
> #line 2353
29713,29714d29722
< #line 2354
<   spin_lock_irq(& mdev->req_lock);
29716c29724
<   rv = may_inc_ap_bio(mdev);
---
>   spin_lock_irq(& mdev->req_lock);
29718c29726
<   if ((int )rv) {
---
>   rv = may_inc_ap_bio(mdev);
29719a29728,29729
>   if ((int )rv) {
> #line 2358
29724c29734
< #line 2358
---
> #line 2359
29726c29736
< #line 2360
---
> #line 2361
29730c29740
< #line 2363 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2364 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
29739c29749
< #line 2373
---
> #line 2374
29741c29751
< #line 2373
---
> #line 2374
29743c29753
< #line 2373
---
> #line 2374
29748c29758
< #line 2373
---
> #line 2374
29750c29760
< #line 2373
---
> #line 2374
29752c29762
< #line 2373
---
> #line 2374
29754c29764
< #line 2373
---
> #line 2374
29756c29766
< #line 2373
---
> #line 2374
29758c29768
< #line 2373
---
> #line 2374
29761c29771
< #line 2373
---
> #line 2374
29763c29773
< #line 2373
---
> #line 2374
29765c29775
< #line 2373
---
> #line 2374
29767c29777
< #line 2373
---
> #line 2374
29772c29782
< #line 2373
---
> #line 2374
29774c29784
< #line 2373
---
> #line 2374
29777c29787
< #line 2373
---
> #line 2374
29780c29790
< #line 2376
---
> #line 2377
29784c29794
< #line 2376 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2377 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
29795c29805
< #line 2378
---
> #line 2379
29797,29798d29806
< #line 2378
<   mxb = tmp;
29799a29808,29809
>   mxb = tmp;
> #line 2380
29801c29811
< #line 2379
---
> #line 2380
29803c29813
< #line 2381
---
> #line 2382
29805c29815
< #line 2381
---
> #line 2382
29808c29818
<             2381);
---
>             2382);
29812,29813d29821
< #line 2385
<   if (ap_bio < mxb) {
29814a29823,29824
>   if (ap_bio < mxb) {
> #line 2387
29819c29829
< #line 2387
---
> #line 2388
29821c29831
< #line 2387
---
> #line 2388
29823,29824d29832
< #line 2387
<     if (tmp___2 != 0) {
29825a29834,29835
>     if (tmp___2 != 0) {
> #line 2389
29827,29828d29836
< #line 2388
<       if (tmp___1 == 0) {
29829a29838,29839
>       if (tmp___1 == 0) {
> #line 2390
29840c29850
< #line 2390
---
> #line 2391
31902c31912
<   if (rw == 1 && local != 0) {
---
>   if ((req->rq_state & 2048UL) != 0UL) {
35758,35762c35768
<     __ns.i = mdev->state.i;
< #line 1830
<     __ns.ldv_37520.disk = 4U;
< #line 1830
<     _drbd_set_state(mdev, __ns, CS_HARD, 0);
---
>     if ((int )mdev->state.ldv_37520.disk > 4) {
35763a35770,35778
>       __ns.i = mdev->state.i;
> #line 1831
>       __ns.ldv_37520.disk = 4U;
> #line 1831
>       _drbd_set_state(mdev, __ns, CS_HARD, 0);
>     } else {
> 
>     }
> #line 1832
35770,35771d35784
< #line 1836
<   set_bit(19U, (unsigned long volatile   *)(& mdev->flags));
35773c35786
<   if ((int )mdev->state.ldv_37520.disk > 2) {
---
>   set_bit(19U, (unsigned long volatile   *)(& mdev->flags));
35774a35788,35789
>   if ((int )mdev->state.ldv_37520.disk > 2) {
> #line 1839
35776c35791
< #line 1838
---
> #line 1839
35778,35779d35792
< #line 1838
<     _drbd_set_state(mdev, __ns___0, CS_HARD, 0);
35780a35794,35795
>     _drbd_set_state(mdev, __ns___0, CS_HARD, 0);
> #line 1840
35786c35801
< #line 1842
---
> #line 1843
35790c35805
< #line 1845
---
> #line 1846
35794c35809
< #line 1855 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1856 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
35802c35817
< #line 1858
---
> #line 1859
35804c35819
< #line 1860
---
> #line 1861
35806,35807d35820
< #line 1860
<     flags = _raw_spin_lock_irqsave(tmp);
35809c35822
<     __drbd_chk_io_error____3(mdev, forcedetach, where);
---
>     flags = _raw_spin_lock_irqsave(tmp);
35810a35824,35825
>     __drbd_chk_io_error____3(mdev, forcedetach, where);
> #line 1863
35815c35830
< #line 1864
---
> #line 1865
35819c35834
< #line 1917 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1918 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
35837c35852
< #line 1920
---
> #line 1921
35841c35856
< #line 1924
---
> #line 1925
35843c35858
< #line 1924
---
> #line 1925
35845c35860
< #line 1924
---
> #line 1925
35847c35862
< #line 1924
---
> #line 1925
35849c35864
< #line 1924
---
> #line 1925
35851c35866
< #line 1924
---
> #line 1925
35854c35869
< #line 1924
---
> #line 1925
35857c35872
< #line 1927
---
> #line 1928
35860c35875
< #line 1929
---
> #line 1930
35862c35877
< #line 1929
---
> #line 1930
35864c35879
< #line 1929
---
> #line 1930
35866c35881
< #line 1929
---
> #line 1930
35868c35883
< #line 1932
---
> #line 1933
35870c35885
< #line 1932
---
> #line 1933
35872c35887
< #line 1932
---
> #line 1933
35874c35889
< #line 1935
---
> #line 1936
35877c35892
< #line 1937
---
> #line 1938
35879c35894
< #line 1937
---
> #line 1938
35881c35896
< #line 1937
---
> #line 1938
35883c35898
< #line 1937
---
> #line 1938
35887c35902
< #line 1940
---
> #line 1941
35891c35906
< #line 1948 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1949 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
35898c35913
< #line 1951
---
> #line 1952
35901c35916
< #line 1953
---
> #line 1954
35905,35906d35919
< #line 1959
<   if ((unsigned long )bdev->backing_bdev == (unsigned long )((struct block_device *)0)) {
35907a35921,35922
>   if ((unsigned long )bdev->backing_bdev == (unsigned long )((struct block_device *)0)) {
> #line 1961
35909,35910d35923
< #line 1960
<     if (tmp != 0) {
35912c35925
<       dev_err((struct device  const  *)(& (mdev->vdisk)->part0.__dev), "bdev->backing_bdev==NULL\n");
---
>     if (tmp != 0) {
35913a35927,35928
>       dev_err((struct device  const  *)(& (mdev->vdisk)->part0.__dev), "bdev->backing_bdev==NULL\n");
> #line 1963
35918c35933
< #line 1964
---
> #line 1965
35923c35938
< #line 1966
---
> #line 1967
35925c35940
< #line 1966
---
> #line 1967
35928c35943
< #line 1969
---
> #line 1970
35933c35948
< #line 2031 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2032 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
35939,35940d35953
< #line 2033
<   _drbd_thread_stop(thi, 0, 0);
35941a35955,35956
>   _drbd_thread_stop(thi, 0, 0);
> #line 2035
35945c35960
< #line 2036 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2037 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
35951,35952d35965
< #line 2038
<   _drbd_thread_stop(thi, 1, 0);
35953a35967,35968
>   _drbd_thread_stop(thi, 1, 0);
> #line 2040
35957c35972
< #line 2249 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2250 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
35963c35978
< #line 2251
---
> #line 2252
35965c35980
< #line 2256
---
> #line 2257
35988c36003
< #line 2281
---
> #line 2282
35991,35992d36005
< #line 2285
<   if (mdev->agreed_pro_version <= 95) {
35993a36007,36008
>   if (mdev->agreed_pro_version <= 95) {
> #line 2287
35998c36013
< #line 2287
---
> #line 2288
36003c36018
< #line 2294
---
> #line 2295
36007c36022
< #line 2297
---
> #line 2298
36014c36029
< #line 2304
---
> #line 2305
36021c36036
< #line 2313
---
> #line 2314
36025c36040
< #line 2316
---
> #line 2317
36029c36044
< #line 2324 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2325 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
36041c36056
< #line 2326
---
> #line 2327
36043c36058
< #line 2326
---
> #line 2327
36045c36060
< #line 2328
---
> #line 2329
36047,36048d36061
< #line 2328
<   if (tmp___0 != 0) {
36049a36063,36064
>   if (tmp___0 != 0) {
> #line 2330
36054c36069
< #line 2330
---
> #line 2331
36056,36057d36070
< #line 2330
<   if (tmp___1 != 0) {
36058a36072,36073
>   if (tmp___1 != 0) {
> #line 2332
36063c36078
< #line 2338
---
> #line 2339
36065,36066d36079
< #line 2338
<   if (tmp___2 == 0) {
36067a36081,36082
>   if (tmp___2 == 0) {
> #line 2340
36072c36087
< #line 2343
---
> #line 2344
36074,36075d36088
< #line 2343
<   if (tmp___3 > mxb) {
36076a36090,36091
>   if (tmp___3 > mxb) {
> #line 2345
36081c36096
< #line 2345
---
> #line 2346
36083,36084d36097
< #line 2345
<   if (tmp___4 != 0) {
36085a36099,36100
>   if (tmp___4 != 0) {
> #line 2347
36090c36105
< #line 2347
---
> #line 2348
36094c36109
< #line 2427 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2428 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
36100,36101d36114
< #line 2429
<   sk = (mdev->data.socket)->sk;
36103c36116
<   if (sk->sk_wmem_queued > (sk->sk_sndbuf * 4) / 5) {
---
>   sk = (mdev->data.socket)->sk;
36104a36118,36119
>   if (sk->sk_wmem_queued > (sk->sk_sndbuf * 4) / 5) {
> #line 2432
36109c36124
< #line 2432
---
> #line 2433
36113c36128
< #line 2434 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 2435 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
36119c36134
< #line 2441
---
> #line 2442
45032c45047
< #line 1917 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
---
> #line 1918 "/work/ldvuser/novikov/inst/current/envs/linux/linux/drivers/block/drbd/drbd_int.h"
45050c45065
< #line 1920
---
> #line 1921
45054c45069
< #line 1924
---
> #line 1925
45056c45071
< #line 1924
---
> #line 1925
45058c45073
< #line 1924
---
> #line 1925
45060c45075
< #line 1924
---
> #line 1925
45062c45077
< #line 1924
---
> #line 1925
45064c45079
< #line 1924
---
> #line 1925
45067c45082
< #line 1924
---
> #line 1925
45070c45085
< #line 1927
---
> #line 1928
45073c45088
< #line 1929
---
> #line 1930
45075c45090
< #line 1929
---
> #line 1930
45077c45092
< #line 1929
---
> #line 1930
45079c45094
< #line 1929
---
> #line 1930
45081c45096
< #line 1932
---
> #line 1933
45083c45098
< #line 1932
---
> #line 1933
45085c45100
< #line 1932
---
> #line 1933
45087c45102
< #line 1935
---
> #line 1936
45090c45105
< #line 1937
---
> #line 1938
45092c45107
< #line 1937
---
> #line 1938
45094c45109
< #line 1937
---
> #line 1938
45096c45111
< #line 1937
---
> #line 1938
45100c45115
< #line 1940
---
> #line 1941

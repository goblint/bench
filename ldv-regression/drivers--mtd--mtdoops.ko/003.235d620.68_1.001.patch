3340c3340
<   if (retlen != (size_t )4 || ret < 0) {
---
>   if (retlen != (size_t )4 || (ret < 0 && ret != -117)) {
3372d3371
<   int tmp ;
3406,3409d3404
< #line 140
<       tmp = (*(mtd->block_isbad))(mtd, cxt->nextpage * 4096);
< #line 140
<       if (tmp) {
3411,3414d3405
<       } else {
< #line 140
<         break;
<       }
3419c3410,3413
<     badblock: 
---
> #line 141
>     ret = (*(mtd->block_isbad))(mtd, cxt->nextpage * 4096);
> #line 142
>     if (! ret) {
3421c3415,3420
<     printk("<4>mtdoops: Bad block at %08x\n", cxt->nextpage * 4096);
---
>       break;
>     } else {
> 
>     }
> #line 144
>     if (ret < 0) {
3423c3422
<     i = i + 1;
---
>       printk("<3>mtdoops: block_isbad failed, aborting.\n");
3424a3424,3433
>       return;
>     } else {
> 
>     }
>     badblock: 
> #line 149
>     printk("<4>mtdoops: Bad block at %08x\n", cxt->nextpage * 4096);
> #line 151
>     i = i + 1;
> #line 152
3426c3435
< #line 147
---
> #line 153
3428c3437
< #line 148
---
> #line 154
3433c3442
< #line 149
---
> #line 155
3435c3444
< #line 150
---
> #line 156
3437c3446
< #line 151
---
> #line 157
3443c3452
< #line 155
---
> #line 161
3445c3454
< #line 155
---
> #line 161
3447c3456
< #line 155
---
> #line 161
3449c3458
< #line 155
---
> #line 161
3453c3462
< #line 155
---
> #line 161
3456c3465
< #line 156
---
> #line 162
3458c3467
< #line 155
---
> #line 161
3461,3466c3470,3490
< #line 158
<   if (ret < 0) {
< #line 159
<     if (mtd->block_markbad) {
< #line 160
<       (*(mtd->block_markbad))(mtd, cxt->nextpage * 4096);
---
> #line 164
>   if (ret >= 0) {
> #line 165
>     printk("<7>mtdoops: Ready %d, %d \n", cxt->nextpage, cxt->nextcount);
> #line 166
>     cxt->ready = 1;
> #line 167
>     return;
>   } else {
> 
>   }
> #line 170
>   if (mtd->block_markbad && ret == -5) {
> #line 171
>     ret = (*(mtd->block_markbad))(mtd, cxt->nextpage * 4096);
> #line 172
>     if (ret < 0) {
> #line 173
>       printk("<3>mtdoops: block_markbad failed, aborting.\n");
> #line 174
>       return;
3470,3471d3493
< #line 161
<     goto badblock;
3475,3480c3497,3498
< #line 164
<   printk("<7>mtdoops: Ready %d, %d \n", cxt->nextpage, cxt->nextcount);
< #line 166
<   cxt->ready = 1;
< #line 167
<   return;
---
> #line 177
>   goto badblock;
3483c3501
< #line 169 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 180 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3490c3508
< #line 172
---
> #line 183
3492c3510
< #line 172
---
> #line 183
3494c3512
< #line 174
---
> #line 185
3496c3514
< #line 175
---
> #line 186
3500c3518
< #line 177 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 188 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3503a3522
>   int ret ;
3512c3531
< #line 179
---
> #line 190
3514c3533
< #line 180
---
> #line 191
3516c3535
< #line 181
---
> #line 192
3518c3537
< #line 184
---
> #line 195
3520c3539
< #line 184
---
> #line 195
3522c3541
< #line 184
---
> #line 195
3526c3545
< #line 184
---
> #line 195
3529,3531c3548,3560
< #line 185
<     (*(mtd->read))(mtd, page * 4096, 4, & retlen, (u_char *)(& count));
< #line 186
---
> #line 196
>     ret = (*(mtd->read))(mtd, page * 4096, 4, & retlen, (u_char *)(& count));
> #line 197
>     if (retlen != (size_t )4 || (ret < 0 && ret != -117)) {
> #line 198
>       printk("<3>mtdoops: Read failure at %d (%td of 4 read), err %d.\n", page * 4096,
>              retlen, ret);
> #line 200
>       goto __Cont;
>     } else {
> 
>     }
> #line 203
3533c3562
< #line 187
---
> #line 204
3538c3567
< #line 188
---
> #line 205
3540c3569
< #line 189
---
> #line 206
3542c3571
< #line 190
---
> #line 207
3545c3574
< #line 191
---
> #line 208
3547c3576
< #line 192
---
> #line 209
3549c3578
< #line 193
---
> #line 210
3552c3581
< #line 194
---
> #line 211
3554c3583
< #line 195
---
> #line 212
3556c3585
< #line 196
---
> #line 213
3559c3588
< #line 197
---
> #line 214
3561c3590
< #line 199
---
> #line 216
3563c3592
< #line 200
---
> #line 217
3569c3598
< #line 184
---
> #line 195
3572c3601
< #line 203
---
> #line 220
3574c3603
< #line 204
---
> #line 221
3576c3605
< #line 205
---
> #line 222
3578c3607
< #line 206
---
> #line 223
3580c3609
< #line 207
---
> #line 224
3582c3611
< #line 209
---
> #line 226
3587c3616
< #line 212
---
> #line 229
3589c3618
< #line 213
---
> #line 230
3591c3620
< #line 215
---
> #line 232
3593c3622
< #line 215
---
> #line 232
3597c3626
< #line 219 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 236 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3604c3633
< #line 221
---
> #line 238
3606c3635
< #line 224
---
> #line 241
3608c3637
< #line 225
---
> #line 242
3613c3642
< #line 227
---
> #line 244
3615c3644
< #line 228
---
> #line 245
3617c3646
< #line 230
---
> #line 247
3622c3651
< #line 233
---
> #line 250
3624c3653
< #line 234
---
> #line 251
3626c3655
< #line 236
---
> #line 253
3628c3657
< #line 237
---
> #line 254
3630c3659
< #line 238
---
> #line 255
3635c3664
< #line 240
---
> #line 257
3637c3666
< #line 241
---
> #line 258
3641c3670
< #line 243 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 260 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3647c3676
< #line 245
---
> #line 262
3649c3678
< #line 247
---
> #line 264
3651c3680
< #line 248
---
> #line 265
3656c3685
< #line 250
---
> #line 267
3658c3687
< #line 251
---
> #line 268
3660c3689
< #line 252
---
> #line 269
3664c3693
< #line 254 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 271 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3673c3702
< #line 256
---
> #line 273
3675c3704
< #line 257
---
> #line 274
3677c3706
< #line 261
---
> #line 278
3679c3708
< #line 262
---
> #line 279
3684c3713
< #line 264
---
> #line 281
3686c3715
< #line 265
---
> #line 282
3691c3720
< #line 267
---
> #line 284
3693c3722
< #line 268
---
> #line 285
3698c3727
< #line 271
---
> #line 288
3700c3729
< #line 273
---
> #line 290
3702c3731
< #line 274
---
> #line 291
3704c3733
< #line 276
---
> #line 293
3706c3735
< #line 277
---
> #line 294
3712c3741
< #line 280
---
> #line 297
3714c3743
< #line 281
---
> #line 298
3716c3745
< #line 282
---
> #line 299
3721c3750
< #line 283
---
> #line 300
3725c3754
< #line 285 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 302 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3735c3764
< #line 288
---
> #line 305
3737c3766
< #line 289
---
> #line 306
3739c3768
< #line 291
---
> #line 308
3741c3770
< #line 292
---
> #line 309
3743c3772
< #line 293
---
> #line 310
3748c3777
< #line 296
---
> #line 313
3750c3779
< #line 297
---
> #line 314
3755c3784
< #line 299
---
> #line 316
3757c3786
< #line 300
---
> #line 317
3759c3788
< #line 301
---
> #line 318
3761c3790
< #line 302
---
> #line 319
3766c3795
< #line 305
---
> #line 322
3768c3797
< #line 306
---
> #line 323
3773c3802
< #line 308
---
> #line 325
3775c3804
< #line 308
---
> #line 325
3777c3806
< #line 309
---
> #line 326
3779c3808
< #line 310
---
> #line 327
3783c3812
< #line 312
---
> #line 329
3785c3814
< #line 312 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 329 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3791c3820
< #line 314
---
> #line 331
3793c3822
< #line 316
---
> #line 333
3795c3824
< #line 317
---
> #line 334
3800c3829
< #line 318
---
> #line 335
3802c3831
< #line 319
---
> #line 336
3807c3836
< #line 321
---
> #line 338
3809c3838
< #line 322
---
> #line 339
3813c3842
< #line 325 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 342 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3815c3844
< #line 330 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 347 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3817c3846
< #line 330
---
> #line 347
3820c3849
< #line 352 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 369 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3822c3851
< #line 340
---
> #line 357
3824c3853
< #line 340 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 357 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3831c3860
< #line 342
---
> #line 359
3833c3862
< #line 344
---
> #line 361
3835c3864
< #line 345
---
> #line 362
3837c3866
< #line 347
---
> #line 364
3839c3868
< #line 348
---
> #line 365
3841c3870
< #line 349
---
> #line 366
3846c3875
< #line 352
---
> #line 369
3848c3877
< #line 352
---
> #line 369
3850c3879
< #line 352
---
> #line 369
3852c3881
< #line 352
---
> #line 369
3854c3883
< #line 352
---
> #line 369
3856c3885
< #line 352
---
> #line 369
3858c3887
< #line 352
---
> #line 369
3860c3889
< #line 352
---
> #line 369
3863c3892
< #line 352
---
> #line 369
3866c3895
< #line 354
---
> #line 371
3868c3897
< #line 355
---
> #line 372
3870c3899
< #line 356
---
> #line 373
3874c3903
< #line 359
---
> #line 376
3876c3905
< #line 359 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 376 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3882c3911
< #line 361
---
> #line 378
3884c3913
< #line 363
---
> #line 380
3886c3915
< #line 364
---
> #line 381
3888c3917
< #line 365
---
> #line 382
3890c3919
< #line 366
---
> #line 383
3894c3923
< #line 369 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 386 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3900c3929
< #line 369
---
> #line 386
3902c3931
< #line 369
---
> #line 386
3906c3935
< #line 370 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 387 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3912c3941
< #line 370
---
> #line 387
3914c3943
< #line 370
---
> #line 387
3918,3920c3947,3949
< #line 372 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
< static char const   __mod_license372[12]  __attribute__((__used__, __unused__, __section__(".modinfo")))  = 
< #line 372
---
> #line 389 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
> static char const   __mod_license389[12]  __attribute__((__used__, __unused__, __section__(".modinfo")))  = 
> #line 389
3924,3926c3953,3955
< #line 373 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
< static char const   __mod_author373[47]  __attribute__((__used__, __unused__, __section__(".modinfo")))  = 
< #line 373
---
> #line 390 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
> static char const   __mod_author390[47]  __attribute__((__used__, __unused__, __section__(".modinfo")))  = 
> #line 390
3939,3940c3968,3969
< #line 374 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
< static char const   __mod_description374[49]  __attribute__((__used__, __unused__,
---
> #line 391 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
> static char const   __mod_description391[49]  __attribute__((__used__, __unused__,
3942c3971
< #line 374
---
> #line 391
3956c3985
< #line 392
---
> #line 409
3958c3987
< #line 401
---
> #line 418
3960c3989
< #line 404
---
> #line 421
3962c3991
< #line 407
---
> #line 424
3964c3993
< #line 410 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 427 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3966c3995
< #line 413 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
---
> #line 430 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--68_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/68_1/drivers/mtd/mtdoops.c"
3980c4009
< #line 459
---
> #line 476
3982c4011
< #line 468
---
> #line 485
3984c4013
< #line 476
---
> #line 493
3986c4015
< #line 477
---
> #line 494
3988c4017
< #line 477
---
> #line 494
3990c4019
< #line 478
---
> #line 495
3995c4024
< #line 479
---
> #line 496
3997c4026
< #line 485
---
> #line 502
3999c4028
< #line 485
---
> #line 502
4001c4030
< #line 485
---
> #line 502
4005c4034
< #line 485
---
> #line 502
4008c4037
< #line 489
---
> #line 506
4010c4039
< #line 489
---
> #line 506
4013c4042
< #line 494
---
> #line 511
4015c4044
< #line 501
---
> #line 518
4017c4046
< #line 502
---
> #line 519
4019c4048
< #line 503
---
> #line 520
4024c4053
< #line 509
---
> #line 526
4027c4056
< #line 520
---
> #line 537
4029c4058
< #line 521
---
> #line 538
4031c4060
< #line 528
---
> #line 545
4034c4063
< #line 539
---
> #line 556
4036c4065
< #line 540
---
> #line 557
4038c4067
< #line 547
---
> #line 564
4041c4070
< #line 558
---
> #line 575
4043c4072
< #line 559
---
> #line 576
4045c4074
< #line 566
---
> #line 583
4048c4077
< #line 577
---
> #line 594
4050c4079
< #line 578
---
> #line 595
4052c4081
< #line 585
---
> #line 602
4055c4084
< #line 586
---
> #line 603
4059c4088
< #line 600
---
> #line 617
4061c4090
< #line 601
---
> #line 618
4064c4093
< #line 604
---
> #line 621
4066c4095
< #line 607
---
> #line 624

2005c2005
<   if (retlen != (size_t )4 || ret < 0) {
---
>   if (retlen != (size_t )4 || (ret < 0 && ret != -117)) {
2037d2036
<   int tmp ;
2071,2074d2069
< #line 140
<       tmp = (*(mtd->block_isbad))(mtd, cxt->nextpage * 4096);
< #line 140
<       if (tmp) {
2076,2079d2070
<       } else {
< #line 140
<         break;
<       }
2084c2075,2078
<     badblock: 
---
> #line 141
>     ret = (*(mtd->block_isbad))(mtd, cxt->nextpage * 4096);
> #line 142
>     if (! ret) {
2086c2080,2085
<     printk("<4>mtdoops: Bad block at %08x\n", cxt->nextpage * 4096);
---
>       break;
>     } else {
> 
>     }
> #line 144
>     if (ret < 0) {
2088c2087
<     i = i + 1;
---
>       printk("<3>mtdoops: block_isbad failed, aborting.\n");
2089a2089,2098
>       return;
>     } else {
> 
>     }
>     badblock: 
> #line 149
>     printk("<4>mtdoops: Bad block at %08x\n", cxt->nextpage * 4096);
> #line 151
>     i = i + 1;
> #line 152
2091c2100
< #line 147
---
> #line 153
2093c2102
< #line 148
---
> #line 154
2098c2107
< #line 149
---
> #line 155
2100c2109
< #line 150
---
> #line 156
2102c2111
< #line 151
---
> #line 157
2108c2117
< #line 155
---
> #line 161
2110c2119
< #line 155
---
> #line 161
2112c2121
< #line 155
---
> #line 161
2114c2123
< #line 155
---
> #line 161
2118c2127
< #line 155
---
> #line 161
2121c2130
< #line 156
---
> #line 162
2123c2132
< #line 155
---
> #line 161
2126,2131c2135,2155
< #line 158
<   if (ret < 0) {
< #line 159
<     if (mtd->block_markbad) {
< #line 160
<       (*(mtd->block_markbad))(mtd, cxt->nextpage * 4096);
---
> #line 164
>   if (ret >= 0) {
> #line 165
>     printk("<7>mtdoops: Ready %d, %d \n", cxt->nextpage, cxt->nextcount);
> #line 166
>     cxt->ready = 1;
> #line 167
>     return;
>   } else {
> 
>   }
> #line 170
>   if (mtd->block_markbad && ret == -5) {
> #line 171
>     ret = (*(mtd->block_markbad))(mtd, cxt->nextpage * 4096);
> #line 172
>     if (ret < 0) {
> #line 173
>       printk("<3>mtdoops: block_markbad failed, aborting.\n");
> #line 174
>       return;
2135,2136d2158
< #line 161
<     goto badblock;
2140,2145c2162,2163
< #line 164
<   printk("<7>mtdoops: Ready %d, %d \n", cxt->nextpage, cxt->nextcount);
< #line 166
<   cxt->ready = 1;
< #line 167
<   return;
---
> #line 177
>   goto badblock;
2148c2166
< #line 169 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 180 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2155c2173
< #line 172
---
> #line 183
2157c2175
< #line 172
---
> #line 183
2159c2177
< #line 174
---
> #line 185
2161c2179
< #line 175
---
> #line 186
2165c2183
< #line 177 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 188 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2168a2187
>   int ret ;
2177c2196
< #line 179
---
> #line 190
2179c2198
< #line 180
---
> #line 191
2181c2200
< #line 181
---
> #line 192
2183c2202
< #line 184
---
> #line 195
2185c2204
< #line 184
---
> #line 195
2187c2206
< #line 184
---
> #line 195
2191c2210
< #line 184
---
> #line 195
2194,2196c2213,2225
< #line 185
<     (*(mtd->read))(mtd, page * 4096, 4, & retlen, (u_char *)(& count));
< #line 186
---
> #line 196
>     ret = (*(mtd->read))(mtd, page * 4096, 4, & retlen, (u_char *)(& count));
> #line 197
>     if (retlen != (size_t )4 || (ret < 0 && ret != -117)) {
> #line 198
>       printk("<3>mtdoops: Read failure at %d (%td of 4 read), err %d.\n", page * 4096,
>              retlen, ret);
> #line 200
>       goto __Cont;
>     } else {
> 
>     }
> #line 203
2198c2227
< #line 187
---
> #line 204
2203c2232
< #line 188
---
> #line 205
2205c2234
< #line 189
---
> #line 206
2207c2236
< #line 190
---
> #line 207
2210c2239
< #line 191
---
> #line 208
2212c2241
< #line 192
---
> #line 209
2214c2243
< #line 193
---
> #line 210
2217c2246
< #line 194
---
> #line 211
2219c2248
< #line 195
---
> #line 212
2221c2250
< #line 196
---
> #line 213
2224c2253
< #line 197
---
> #line 214
2226c2255
< #line 199
---
> #line 216
2228c2257
< #line 200
---
> #line 217
2234c2263
< #line 184
---
> #line 195
2237c2266
< #line 203
---
> #line 220
2239c2268
< #line 204
---
> #line 221
2241c2270
< #line 205
---
> #line 222
2243c2272
< #line 206
---
> #line 223
2245c2274
< #line 207
---
> #line 224
2247c2276
< #line 209
---
> #line 226
2252c2281
< #line 212
---
> #line 229
2254c2283
< #line 213
---
> #line 230
2256c2285
< #line 215
---
> #line 232
2258c2287
< #line 215
---
> #line 232
2262c2291
< #line 219 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 236 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2269c2298
< #line 221
---
> #line 238
2271c2300
< #line 224
---
> #line 241
2273c2302
< #line 225
---
> #line 242
2278c2307
< #line 227
---
> #line 244
2280c2309
< #line 228
---
> #line 245
2282c2311
< #line 230
---
> #line 247
2287c2316
< #line 233
---
> #line 250
2289c2318
< #line 234
---
> #line 251
2291c2320
< #line 236
---
> #line 253
2293c2322
< #line 237
---
> #line 254
2295c2324
< #line 238
---
> #line 255
2300c2329
< #line 240
---
> #line 257
2302c2331
< #line 241
---
> #line 258
2306c2335
< #line 243 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 260 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2312c2341
< #line 245
---
> #line 262
2314c2343
< #line 247
---
> #line 264
2316c2345
< #line 248
---
> #line 265
2321c2350
< #line 250
---
> #line 267
2323c2352
< #line 251
---
> #line 268
2325c2354
< #line 252
---
> #line 269
2329c2358
< #line 254 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 271 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2338c2367
< #line 256
---
> #line 273
2340c2369
< #line 257
---
> #line 274
2342c2371
< #line 261
---
> #line 278
2344c2373
< #line 262
---
> #line 279
2349c2378
< #line 264
---
> #line 281
2351c2380
< #line 265
---
> #line 282
2356c2385
< #line 267
---
> #line 284
2358c2387
< #line 268
---
> #line 285
2363c2392
< #line 271
---
> #line 288
2365c2394
< #line 273
---
> #line 290
2367c2396
< #line 274
---
> #line 291
2369c2398
< #line 276
---
> #line 293
2371c2400
< #line 277
---
> #line 294
2377c2406
< #line 280
---
> #line 297
2379c2408
< #line 281
---
> #line 298
2381c2410
< #line 282
---
> #line 299
2386c2415
< #line 283
---
> #line 300
2390c2419
< #line 285 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 302 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2400c2429
< #line 288
---
> #line 305
2402c2431
< #line 289
---
> #line 306
2404c2433
< #line 291
---
> #line 308
2406c2435
< #line 292
---
> #line 309
2408c2437
< #line 293
---
> #line 310
2413c2442
< #line 296
---
> #line 313
2415c2444
< #line 297
---
> #line 314
2420c2449
< #line 299
---
> #line 316
2422c2451
< #line 300
---
> #line 317
2424c2453
< #line 301
---
> #line 318
2426c2455
< #line 302
---
> #line 319
2431c2460
< #line 305
---
> #line 322
2433c2462
< #line 306
---
> #line 323
2438c2467
< #line 308
---
> #line 325
2440c2469
< #line 308
---
> #line 325
2442c2471
< #line 309
---
> #line 326
2444c2473
< #line 310
---
> #line 327
2448c2477
< #line 312
---
> #line 329
2450c2479
< #line 312 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 329 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2456c2485
< #line 314
---
> #line 331
2458c2487
< #line 316
---
> #line 333
2460c2489
< #line 317
---
> #line 334
2465c2494
< #line 318
---
> #line 335
2467c2496
< #line 319
---
> #line 336
2472c2501
< #line 321
---
> #line 338
2474c2503
< #line 322
---
> #line 339
2478c2507
< #line 325 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 342 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2480c2509
< #line 330 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 347 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2482c2511
< #line 330
---
> #line 347
2485c2514
< #line 340
---
> #line 357
2487c2516
< #line 340 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 357 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2494c2523
< #line 342
---
> #line 359
2496c2525
< #line 344
---
> #line 361
2498c2527
< #line 345
---
> #line 362
2500c2529
< #line 347
---
> #line 364
2502c2531
< #line 348
---
> #line 365
2504c2533
< #line 349
---
> #line 366
2509c2538
< #line 352
---
> #line 369
2511c2540
< #line 352
---
> #line 369
2513c2542
< #line 352
---
> #line 369
2515c2544
< #line 352
---
> #line 369
2517c2546
< #line 352
---
> #line 369
2519c2548
< #line 352
---
> #line 369
2521c2550
< #line 352
---
> #line 369
2524c2553
< #line 352
---
> #line 369
2527c2556
< #line 354
---
> #line 371
2529c2558
< #line 355
---
> #line 372
2531c2560
< #line 356
---
> #line 373
2535c2564
< #line 359
---
> #line 376
2537c2566
< #line 359 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 376 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2543c2572
< #line 361
---
> #line 378
2545c2574
< #line 363
---
> #line 380
2547c2576
< #line 364
---
> #line 381
2549c2578
< #line 365
---
> #line 382
2551c2580
< #line 366
---
> #line 383
2555c2584
< #line 369 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 386 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2561c2590
< #line 369
---
> #line 386
2563c2592
< #line 369
---
> #line 386
2567c2596
< #line 370 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 387 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2573c2602
< #line 370
---
> #line 387
2575c2604
< #line 370
---
> #line 387
2579,2581c2608,2610
< #line 372 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
< static char const   __mod_license372[12]  __attribute__((__used__, __unused__, __section__(".modinfo")))  = 
< #line 372
---
> #line 389 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
> static char const   __mod_license389[12]  __attribute__((__used__, __unused__, __section__(".modinfo")))  = 
> #line 389
2585,2587c2614,2616
< #line 373 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
< static char const   __mod_author373[47]  __attribute__((__used__, __unused__, __section__(".modinfo")))  = 
< #line 373
---
> #line 390 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
> static char const   __mod_author390[47]  __attribute__((__used__, __unused__, __section__(".modinfo")))  = 
> #line 390
2600,2601c2629,2630
< #line 374 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
< static char const   __mod_description374[49]  __attribute__((__used__, __unused__,
---
> #line 391 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
> static char const   __mod_description391[49]  __attribute__((__used__, __unused__,
2603c2632
< #line 374
---
> #line 391
2617c2646
< #line 392
---
> #line 409
2619c2648
< #line 401
---
> #line 418
2621c2650
< #line 404
---
> #line 421
2623c2652
< #line 407
---
> #line 424
2625c2654
< #line 410 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 427 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2627c2656
< #line 413 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
---
> #line 430 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--32_1--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/32_1/drivers/mtd/mtdoops.c"
2641c2670
< #line 459
---
> #line 476
2643c2672
< #line 468
---
> #line 485
2645c2674
< #line 476
---
> #line 493
2647c2676
< #line 477
---
> #line 494
2649c2678
< #line 477
---
> #line 494
2651c2680
< #line 478
---
> #line 495
2656c2685
< #line 479
---
> #line 496
2658c2687
< #line 485
---
> #line 502
2660c2689
< #line 485
---
> #line 502
2662c2691
< #line 485
---
> #line 502
2666c2695
< #line 485
---
> #line 502
2669c2698
< #line 489
---
> #line 506
2671c2700
< #line 489
---
> #line 506
2674c2703
< #line 494
---
> #line 511
2676c2705
< #line 501
---
> #line 518
2678c2707
< #line 502
---
> #line 519
2680c2709
< #line 503
---
> #line 520
2685c2714
< #line 509
---
> #line 526
2688c2717
< #line 520
---
> #line 537
2690c2719
< #line 521
---
> #line 538
2692c2721
< #line 528
---
> #line 545
2695c2724
< #line 539
---
> #line 556
2697c2726
< #line 540
---
> #line 557
2699c2728
< #line 547
---
> #line 564
2702c2731
< #line 558
---
> #line 575
2704c2733
< #line 559
---
> #line 576
2706c2735
< #line 566
---
> #line 583
2709c2738
< #line 577
---
> #line 594
2711c2740
< #line 578
---
> #line 595
2713c2742
< #line 585
---
> #line 602
2716c2745
< #line 586
---
> #line 603
2720c2749
< #line 600
---
> #line 617
2722c2751
< #line 601
---
> #line 618
2725c2754
< #line 604
---
> #line 621
2727c2756
< #line 607
---
> #line 624

1966c1966
<   if (mtd->erasesize <= 4095U) {
---
>   erase.len = mtd->erasesize;
1968,1973d1967
<     erase.len = 4096U;
<   } else {
< #line 81
<     erase.len = mtd->erasesize;
<   }
< #line 82
1975c1969
< #line 84
---
> #line 81
1977c1971
< #line 84
---
> #line 81
1979c1973
< #line 85
---
> #line 82
1981c1975
< #line 87
---
> #line 84
1983c1977
< #line 88
---
> #line 85
1985c1979
< #line 89
---
> #line 86
1987c1981
< #line 89
---
> #line 86
1989c1983
< #line 90
---
> #line 87
1991c1985
< #line 91
---
> #line 88
1994c1988
< #line 94
---
> #line 91
1999c1993
< #line 97
---
> #line 94
2001c1995
< #line 98
---
> #line 95
2003c1997
< #line 100
---
> #line 97
2007c2001
< #line 103 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 100 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2016c2010
< #line 105
---
> #line 102
2018c2012
< #line 110
---
> #line 107
2020c2014
< #line 111
---
> #line 108
2022c2016
< #line 112
---
> #line 109
2027c2021
< #line 113
---
> #line 110
2029c2023
< #line 114
---
> #line 111
2031c2025
< #line 115
---
> #line 112
2036c2030
< #line 117
---
> #line 114
2038c2032
< #line 119
---
> #line 116
2040c2034
< #line 120
---
> #line 117
2043c2037
< #line 123
---
> #line 120
2045c2039
< #line 124
---
> #line 121
2050c2044
< #line 128
---
> #line 125
2052c2046
< #line 129
---
> #line 126
2054c2048
< #line 130
---
> #line 127
2059c2053
< #line 133
---
> #line 130
2061c2055
< #line 135
---
> #line 132
2063c2057
< #line 136
---
> #line 133
2067c2061
< #line 139 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 136 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2079c2073
< #line 142
---
> #line 139
2081c2075
< #line 142
---
> #line 139
2083c2077
< #line 143
---
> #line 140
2085c2079
< #line 144
---
> #line 141
2087c2081
< #line 147
---
> #line 144
2089c2083
< #line 148
---
> #line 145
2094c2088
< #line 150
---
> #line 147
2096c2090
< #line 151
---
> #line 148
2098c2092
< #line 152
---
> #line 149
2100c2094
< #line 153
---
> #line 150
2102c2096
< #line 154
---
> #line 151
2110c2104
< #line 157
---
> #line 154
2113c2107
< #line 158
---
> #line 155
2115c2109
< #line 159
---
> #line 156
2117c2111
< #line 160
---
> #line 157
2122c2116
< #line 161
---
> #line 158
2124c2118
< #line 162
---
> #line 159
2126c2120
< #line 163
---
> #line 160
2132c2126
< #line 166
---
> #line 163
2134c2128
< #line 168
---
> #line 165
2136c2130
< #line 169
---
> #line 166
2138c2132
< #line 170
---
> #line 167
2140c2134
< #line 171
---
> #line 168
2145c2139
< #line 172
---
> #line 169
2147c2141
< #line 173
---
> #line 170
2149c2143
< #line 174
---
> #line 171
2155c2149
< #line 157
---
> #line 154
2158c2152
< #line 158
---
> #line 155
2164c2158
< #line 178
---
> #line 175
2166c2160
< #line 178
---
> #line 175
2168c2162
< #line 178
---
> #line 175
2171c2165
< #line 179
---
> #line 176
2173c2167
< #line 178
---
> #line 175
2176c2170
< #line 178
---
> #line 175
2178c2172
< #line 179
---
> #line 176
2184c2178
< #line 181
---
> #line 178
2186c2180
< #line 182
---
> #line 179
2188c2182
< #line 183
---
> #line 180
2190c2184
< #line 184
---
> #line 181
2195c2189
< #line 187
---
> #line 184
2198c2192
< #line 188
---
> #line 185
2200c2194
< #line 189
---
> #line 186
2202c2196
< #line 190
---
> #line 187
2204c2198
< #line 191
---
> #line 188
2212c2206
< #line 194
---
> #line 191
2216c2210
< #line 197 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 194 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2226c2220
< #line 200
---
> #line 197
2228c2222
< #line 200
---
> #line 197
2230c2224
< #line 201
---
> #line 198
2232c2226
< #line 205
---
> #line 202
2234c2228
< #line 206
---
> #line 203
2239c2233
< #line 209
---
> #line 206
2241c2235
< #line 212
---
> #line 209
2243c2237
< #line 214
---
> #line 211
2245c2239
< #line 215
---
> #line 212
2251c2245
< #line 218
---
> #line 215
2253c2247
< #line 219
---
> #line 216
2257c2251
< #line 221 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 218 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2269c2263
< #line 223
---
> #line 220
2271c2265
< #line 224
---
> #line 221
2273c2267
< #line 225
---
> #line 222
2275c2269
< #line 228
---
> #line 225
2277c2271
< #line 228
---
> #line 225
2280c2274
< #line 229
---
> #line 226
2282c2276
< #line 230
---
> #line 227
2284c2278
< #line 231
---
> #line 228
2287c2281
< #line 233
---
> #line 230
2292c2286
< #line 236
---
> #line 233
2294c2288
< #line 237
---
> #line 234
2299c2293
< #line 238
---
> #line 235
2300a2295,2301
> #line 236
>     maxcount = count;
> #line 237
>     maxpos = page;
>   } else
> #line 238
>   if (count <= 1073741823U && maxcount > 3221225472U) {
2307c2308
<   if (count <= 1073741823U && maxcount > 3221225472U) {
---
>   if (count > maxcount && count <= 3221225471U) {
2314,2320d2314
<   if (count > maxcount && count <= 3221225471U) {
< #line 245
<     maxcount = count;
< #line 246
<     maxpos = page;
<   } else
< #line 247
2322c2316
< #line 249
---
> #line 246
2324c2318
< #line 250
---
> #line 247
2330c2324
< #line 228
---
> #line 225
2333c2327
< #line 228
---
> #line 225
2335c2329
< #line 229
---
> #line 226
2341c2335
< #line 253
---
> #line 250
2343c2337
< #line 254
---
> #line 251
2345c2339
< #line 255
---
> #line 252
2347c2341
< #line 256
---
> #line 253
2349c2343
< #line 257
---
> #line 254
2351c2345
< #line 259
---
> #line 256
2356c2350
< #line 262
---
> #line 259
2358c2352
< #line 263
---
> #line 260
2360c2354
< #line 265
---
> #line 262
2362c2356
< #line 266
---
> #line 263
2366c2360
< #line 269 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 266 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2372c2366
< #line 271
---
> #line 268
2374c2368
< #line 273
---
> #line 270
2376c2370
< #line 274
---
> #line 271
2381c2375
< #line 276
---
> #line 273
2383c2377
< #line 277
---
> #line 274
2385c2379
< #line 279
---
> #line 276
2389a2384,2387
> #line 279
>   if (mtd->erasesize <= 4095U) {
> #line 280
>     printk("<3>Eraseblock size of MTD partition %d too small\n", mtd->index);
2390a2389,2393
>     return;
>   } else {
> 
>   }
> #line 285
2392c2395
< #line 283
---
> #line 286
2394,2397d2396
< #line 285
<   find_next_position(cxt);
< #line 287
<   printk("<7>mtdoops: Attached to MTD device %d\n", mtd->index);
2398a2398,2401
>   find_next_position(cxt);
> #line 290
>   printk("<6>mtdoops: Attached to MTD device %d\n", mtd->index);
> #line 291
2402c2405
< #line 290 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 293 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2408c2411
< #line 292
---
> #line 295
2410c2413
< #line 294
---
> #line 297
2412c2415
< #line 295
---
> #line 298
2417c2420
< #line 297
---
> #line 300
2419c2422
< #line 298
---
> #line 301
2421c2424
< #line 299
---
> #line 302
2425c2428
< #line 301 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 304 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2433c2436
< #line 303
---
> #line 306
2435,2436d2437
< #line 304
<   mtd = cxt->mtd;
2437a2439,2440
>   mtd = cxt->mtd;
> #line 310
2439c2442
< #line 308
---
> #line 311
2444c2447
< #line 314
---
> #line 317
2446c2449
< #line 315
---
> #line 318
2448c2451
< #line 316
---
> #line 319
2450c2453
< #line 317
---
> #line 320
2455c2458
< #line 319
---
> #line 322
2457c2460
< #line 320
---
> #line 323
2459c2462
< #line 322
---
> #line 325
2461c2464
< #line 323
---
> #line 326
2465c2468
< #line 326 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 329 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2476c2479
< #line 328
---
> #line 331
2478,2479d2480
< #line 329
<   mtd = cxt->mtd;
2480a2482,2483
>   mtd = cxt->mtd;
> #line 335
2482c2485
< #line 333
---
> #line 336
2484c2487
< #line 334
---
> #line 337
2489c2492
< #line 337
---
> #line 340
2491c2494
< #line 338
---
> #line 341
2496,2497d2498
< #line 341
<   flags = _spin_lock_irqsave(& cxt->writecount_lock);
2498a2500,2501
>   flags = _spin_lock_irqsave(& cxt->writecount_lock);
> #line 347
2500c2503
< #line 345
---
> #line 348
2505c2508
< #line 347
---
> #line 350
2507c2510
< #line 348
---
> #line 351
2509c2512
< #line 349
---
> #line 352
2511c2514
< #line 350
---
> #line 353
2516c2519
< #line 353
---
> #line 356
2518c2521
< #line 354
---
> #line 357
2523c2526
< #line 356
---
> #line 359
2525c2528
< #line 356
---
> #line 359
2528c2531
< #line 357
---
> #line 360
2530c2533
< #line 359
---
> #line 362
2532c2535
< #line 361
---
> #line 364
2534c2537
< #line 362
---
> #line 365
2539c2542
< #line 363
---
> #line 366
2543c2546
< #line 365 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 368 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2549c2552
< #line 367
---
> #line 370
2551c2554
< #line 369
---
> #line 372
2553c2556
< #line 370
---
> #line 373
2558c2561
< #line 371
---
> #line 374
2560c2563
< #line 372
---
> #line 375
2565c2568
< #line 374
---
> #line 377
2567c2570
< #line 375
---
> #line 378
2571c2574
< #line 378 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 381 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2573c2576
< #line 383 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 386 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2575c2578
< #line 383
---
> #line 386
2577,2578c2580,2581
<     & mtdoops_console_setup, 0, 1, -1, 0, (void *)(& oops_cxt), 0};
< #line 393 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
>     & mtdoops_console_setup, 0, (short)0, -1, 0, (void *)(& oops_cxt), 0};
> #line 395 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2588,2589d2590
< #line 395
<   cxt = & oops_cxt;
2590a2592,2593
>   cxt = & oops_cxt;
> #line 399
2592,2593d2594
< #line 398
<   cxt->oops_buf = vmalloc(4096UL);
2595,2597c2596
<   if ((unsigned long )cxt->oops_buf == (unsigned long )((void *)0)) {
< #line 401
<     printk("<3>Failed to allocate oops buffer workspace\n");
---
>   cxt->oops_buf = vmalloc(4096UL);
2598a2598,2601
>   if ((unsigned long )cxt->oops_buf == (unsigned long )((void *)0)) {
> #line 403
>     printk("<3>Failed to allocate mtdoops buffer workspace\n");
> #line 404
2603c2606
< #line 405
---
> #line 407
2605c2608
< #line 405
---
> #line 407
2607c2610
< #line 405
---
> #line 407
2609c2612
< #line 405
---
> #line 407
2611c2614
< #line 405
---
> #line 407
2613c2616
< #line 406
---
> #line 408
2615c2618
< #line 406
---
> #line 408
2617c2620
< #line 406
---
> #line 408
2620c2623
< #line 406
---
> #line 408
2622,2623d2624
< #line 406
<   cxt->work_write.func = & mtdoops_workfunc_write;
2624a2626,2627
>   cxt->work_write.func = & mtdoops_workfunc_write;
> #line 410
2626c2629
< #line 409
---
> #line 411
2628c2631
< #line 410
---
> #line 412
2632c2635
< #line 413 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 415 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2638,2639d2640
< #line 415
<   cxt = & oops_cxt;
2640a2642,2643
>   cxt = & oops_cxt;
> #line 419
2642c2645
< #line 418
---
> #line 420
2644c2647
< #line 419
---
> #line 421
2646c2649
< #line 420
---
> #line 422
2650c2653
< #line 446
---
> #line 448
2652c2655
< #line 455
---
> #line 457
2654c2657
< #line 458
---
> #line 460
2656c2659
< #line 461
---
> #line 463
2658c2661
< #line 464 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 466 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2660c2663
< #line 467 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
---
> #line 469 "/work/ldvuser/novikov/work/current--X--drivers/mtd/mtdoops.ko--X--defaultlinux--X--08_1a--X--cpachecker/linux/csd_deg_dscv/10/dscv_tempdir/dscv/ri/08_1a/drivers/mtd/mtdoops.c.prepared"
2674c2677
< #line 533
---
> #line 535
2676c2679
< #line 513
---
> #line 515
2678c2681
< #line 522
---
> #line 524
2680c2683
< #line 530
---
> #line 532
2682c2685
< #line 531
---
> #line 533
2684c2687
< #line 531
---
> #line 533
2686c2689
< #line 532
---
> #line 534
2691c2694
< #line 539
---
> #line 541
2694c2697
< #line 543
---
> #line 545
2696c2699
< #line 543
---
> #line 545
2699c2702
< #line 548
---
> #line 550
2701c2704
< #line 555
---
> #line 557
2703c2706
< #line 556
---
> #line 558
2705c2708
< #line 557
---
> #line 559
2710c2713
< #line 563
---
> #line 565
2713c2716
< #line 574
---
> #line 576
2715c2718
< #line 575
---
> #line 577
2717c2720
< #line 582
---
> #line 584
2720c2723
< #line 593
---
> #line 595
2722c2725
< #line 594
---
> #line 596
2724c2727
< #line 601
---
> #line 603
2727c2730
< #line 612
---
> #line 614
2729c2732
< #line 613
---
> #line 615
2731c2734
< #line 620
---
> #line 622
2734c2737
< #line 631
---
> #line 633
2736c2739
< #line 632
---
> #line 634
2738c2741
< #line 639
---
> #line 641
2741c2744
< #line 640
---
> #line 642
2746c2749
< #line 539
---
> #line 541
2748,2749d2750
< #line 539
<   if (tmp___1 != 0 || ldv_s_mtdoops_notifier_mtd_notifier != 0) {
2750a2752,2753
>   if (tmp___1 != 0 || ldv_s_mtdoops_notifier_mtd_notifier != 0) {
> #line 543
2756c2759
< #line 654
---
> #line 656
2758c2761
< #line 655
---
> #line 657
2761c2764
< #line 658
---
> #line 660
2763c2766
< #line 661
---
> #line 663

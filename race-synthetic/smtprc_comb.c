/* Generated by CIL v. 1.3.6 */
/* print_CIL_Input is true */

typedef unsigned int size_t;
typedef unsigned long pthread_t;
struct _check {
   unsigned char failed ;
   unsigned char passed ;
   unsigned char error_code ;
   char *helo ;
   char *mail_from ;
   char *rcpt_to ;
   char *r_banner ;
   char *r_helo ;
   char *r_mail_from ;
   char *r_rcpt_to ;
   char *r_data_start ;
   char *r_data_end ;
   char *r_reset ;
};
typedef struct _check check;
struct _host {
   unsigned char smtp_open ;
   unsigned char resolved ;
   unsigned char fatal_error ;
   unsigned char fatal ;
   char *ip_address ;
   char *hostname ;
   char *r_quit ;
   check **smtp_check ;
};
typedef struct _host host;
struct _rule {
   char *helo ;
   char *mail_from ;
   char *rcpt_to ;
};
typedef struct _rule rule;
struct options {
   unsigned int time ;
   unsigned short number_of_threads ;
   unsigned short c_timeout ;
   unsigned short r_timeout ;
   unsigned short m_timeout ;
   unsigned short cur_threads ;
   unsigned short no_rules ;
   unsigned long no_hostnames ;
   unsigned long cur_host ;
   pthread_t *tid ;
   char *email_address ;
   char *ip_range ;
   char *ip_list ;
   char *mailbox ;
   char *auto_config_file ;
   char *generate_file ;
   char *config_file ;
   char *email_template ;
   char *name ;
   char *domain ;
   char *html_file ;
   char *html_path ;
   char *xml_file ;
   char *xml_path ;
   char *machine_file ;
   char *machine_path ;
   char *text_file ;
   char *text_path ;
   char *email ;
   char *email_subject ;
   unsigned char hours ;
   unsigned char mins ;
   unsigned char seconds ;
};
typedef long long __quad_t;
typedef long __off_t;
typedef __quad_t __off64_t;
typedef long __time_t;
typedef long __suseconds_t;
typedef int __ssize_t;
typedef unsigned int __socklen_t;
struct _IO_FILE;
typedef struct _IO_FILE FILE;
typedef void _IO_lock_t;
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15U * sizeof(int ) - 4U * sizeof(void *)) - sizeof(size_t )] ;
};
typedef __ssize_t ssize_t;
struct timeval {
   __time_t tv_sec ;
   __suseconds_t tv_usec ;
};
typedef long __fd_mask;
struct __anonstruct_fd_set_13 {
   __fd_mask __fds_bits[1024U / (8U * sizeof(__fd_mask ))] ;
};
typedef struct __anonstruct_fd_set_13 fd_set;
typedef unsigned short uint16_t;
typedef unsigned int uint32_t;
typedef __socklen_t socklen_t;
typedef unsigned short sa_family_t;
struct sockaddr {
   sa_family_t sa_family ;
   char sa_data[14] ;
};
typedef uint16_t in_port_t;
typedef uint32_t in_addr_t;
struct in_addr {
   in_addr_t s_addr ;
};
struct sockaddr_in {
   sa_family_t sin_family ;
   in_port_t sin_port ;
   struct in_addr sin_addr ;
   unsigned char sin_zero[((sizeof(struct sockaddr ) - sizeof(unsigned short )) - sizeof(in_port_t )) - sizeof(struct in_addr )] ;
};
struct hostent {
   char *h_name ;
   char **h_aliases ;
   int h_addrtype ;
   int h_length ;
   char **h_addr_list ;
};
struct flags {
   unsigned char debug ;
   unsigned char verbose ;
   unsigned char check_mailbox ;
   unsigned char maildir ;
   unsigned char mbox ;
   unsigned char pop ;
   unsigned char auto_config ;
   unsigned char generate_config ;
   unsigned char output_html ;
   unsigned char output_text ;
   unsigned char output_machine ;
   unsigned char output_xml ;
   unsigned char resolve_hostnames ;
   unsigned char display_only_ips ;
   unsigned char ip_range ;
   unsigned char ip_list ;
   unsigned char send_email ;
   unsigned char config_file ;
   unsigned char email_template ;
   unsigned char got_name_macro ;
   unsigned char got_email ;
   unsigned char threads ;
   unsigned char display_all ;
};
typedef __time_t time_t;
typedef unsigned long __ino_t;
struct dirent {
   __ino_t d_ino ;
   __off_t d_off ;
   unsigned short d_reclen ;
   unsigned char d_type ;
   char d_name[256] ;
};
struct __dirstream;
typedef struct __dirstream DIR;
typedef unsigned int __useconds_t;
struct timespec {
   __time_t tv_sec ;
   long tv_nsec ;
};
union __anonunion_pthread_attr_t_14 {
   char __size[36] ;
   long __align ;
};
typedef union __anonunion_pthread_attr_t_14 pthread_attr_t;
struct __pthread_internal_slist {
   struct __pthread_internal_slist *__next ;
};
typedef struct __pthread_internal_slist __pthread_slist_t;
union __anonunion____missing_field_name_16 {
   int __spins ;
   __pthread_slist_t __list ;
};
struct __pthread_mutex_s {
   int __lock ;
   unsigned int __count ;
   int __owner ;
   int __kind ;
   unsigned int __nusers ;
   union __anonunion____missing_field_name_16 __annonCompField1 ;
};
union __anonunion_pthread_mutex_t_15 {
   struct __pthread_mutex_s __data ;
   char __size[24] ;
   long __align ;
};
typedef union __anonunion_pthread_mutex_t_15 pthread_mutex_t;
union __anonunion_pthread_mutexattr_t_17 {
   char __size[4] ;
   long __align ;
};
typedef union __anonunion_pthread_mutexattr_t_17 pthread_mutexattr_t;
typedef __builtin_va_list __gnuc_va_list;
typedef __gnuc_va_list va_list;
#pragma merger(0,"/tmp/cil-igB1lIFD.i","-Wall,-g,-pthread")
extern  __attribute__((__nothrow__)) int atoi(char const   *__nptr )  __attribute__((__pure__,
__nonnull__(1))) ;
int check_mail_file(char *email_address , char *key ) ;
extern  __attribute__((__nothrow__)) char *strncpy(char * __restrict  __dest , char const   * __restrict  __src ,
                                                   size_t __n )  __attribute__((__nonnull__(1,2))) ;
extern  __attribute__((__nothrow__)) int strncmp(char const   *__s1 , char const   *__s2 ,
                                                 size_t __n )  __attribute__((__pure__,
__nonnull__(1,2))) ;
extern  __attribute__((__nothrow__)) char *strtok(char * __restrict  __s , char const   * __restrict  __delim )  __attribute__((__nonnull__(2))) ;
extern  __attribute__((__nothrow__)) size_t strlen(char const   *__s )  __attribute__((__pure__,
__nonnull__(1))) ;
void swap_rule(char *dest , char const   *rule___0 , int hostn ) ;
struct options o ;
host **hosts ;
rule **rules ;
int check_mail_file(char *email_address , char *key ) 
{ char mac_buf[8193] ;
  char tmp[9][8193] ;
  char *word ;
  int count ;
  int emailc ;
  int x ;
  int y ;
  int flag ;
  size_t tmp___0 ;
  int tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  int tmp___4 ;
  int tmp___5 ;

  {
  count = 0;
  emailc = 0;
  x = 0;
  y = 0;
  flag = 0;
  if ((unsigned int )email_address == (unsigned int )((void *)0)) {
    return (0);
  }
  x = 0;
  while ((unsigned long )x < o.no_hostnames) {
    if (! (*(hosts + x))->smtp_open) {
      goto __Cont;
    }
    y = 0;
    while (y < (int )o.no_rules) {
      swap_rule(mac_buf, (char const   *)(*(rules + y))->mail_from, x);
      tmp___0 = strlen((char const   *)(mac_buf));
      tmp___1 = strncmp((char const   *)email_address, (char const   *)(mac_buf),
                        tmp___0);
      if (! tmp___1) {
        emailc ++;
      }
      y ++;
    }
    __Cont: /* CIL Label */ 
    x ++;
  }
  if (! emailc) {
    return (0);
  } else {
    word = strtok((char * __restrict  )key, (char const   * __restrict  )":");
    while (word) {
      count ++;
      if (count < 6) {
        strncpy((char * __restrict  )(tmp[count]), (char const   * __restrict  )word,
                8192U);
        tmp[count][8192] = (char )'\000';
      }
      word = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )":");
    }
    tmp___5 = atoi((char const   *)(tmp[2]));
    if ((unsigned int )tmp___5 == o.time) {
      x = 0;
      while ((unsigned long )x < o.no_hostnames) {
        y = 0;
        tmp___2 = strlen((char const   *)(tmp[3]));
        tmp___3 = strlen((char const   *)(*(hosts + x))->ip_address);
        if (tmp___2 != tmp___3) {
          goto __Cont___0;
        }
        while (tmp[3][y]) {
          if ((int )tmp[3][y] != (int )*((*(hosts + x))->ip_address + y)) {
            flag ++;
          }
          y ++;
        }
        if (! flag) {
          tmp___4 = atoi((char const   *)(tmp[4]));
          (*((*(hosts + x))->smtp_check + tmp___4))->failed = (unsigned char)2;
        }
        flag = 0;
        y = 0;
        __Cont___0: /* CIL Label */ 
        x ++;
      }
    }
  }
  return (0);
}
}
#pragma merger(0,"/tmp/cil-ZtejrG4Q.i","-Wall,-g,-pthread")
extern struct _IO_FILE *stderr ;
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
extern int printf(char const   * __restrict  __format  , ...) ;
extern void perror(char const   *__s ) ;
extern int select(int __nfds , fd_set * __restrict  __readfds , fd_set * __restrict  __writefds ,
                  fd_set * __restrict  __exceptfds , struct timeval * __restrict  __timeout ) ;
extern  __attribute__((__nothrow__)) void free(void *__ptr ) ;
extern  __attribute__((__nothrow__, __noreturn__)) void exit(int __status ) ;
extern  __attribute__((__nothrow__)) int *__errno_location(void)  __attribute__((__const__)) ;
extern  __attribute__((__nothrow__)) void *memcpy(void * __restrict  __dest , void const   * __restrict  __src ,
                                                  size_t __n )  __attribute__((__nonnull__(1,2))) ;
extern  __attribute__((__nothrow__)) void bzero(void *__s , size_t __n )  __attribute__((__nonnull__(1))) ;
extern  __attribute__((__nothrow__)) int socket(int __domain , int __type , int __protocol ) ;
extern int connect(int __fd , struct sockaddr  const  *__addr , socklen_t __len ) ;
extern  __attribute__((__nothrow__)) int getsockopt(int __fd , int __level , int __optname ,
                                                    void * __restrict  __optval ,
                                                    socklen_t * __restrict  __optlen ) ;
extern  __attribute__((__nothrow__)) uint16_t htons(uint16_t __hostshort )  __attribute__((__const__)) ;
extern struct hostent *gethostbyaddr(void const   *__addr , __socklen_t __len , int __type ) ;
extern struct hostent *gethostbyname(char const   *__name ) ;
extern int close(int __fd ) ;
extern ssize_t read(int __fd , void *__buf , size_t __nbytes ) ;
extern unsigned int sleep(unsigned int __seconds ) ;
extern int fcntl(int __fd , int __cmd  , ...) ;
extern  __attribute__((__nothrow__)) in_addr_t inet_addr(char const   *__cp ) ;
void fatal(char *fmt  , ...) ;
void error(char *fmt  , ...) ;
long get_ip(char *host___0 ) ;
int tcp_connect(long ipa ) ;
int connect_non_blocking(int sockfd , struct sockaddr  const  *thaddr , socklen_t salen ,
                         int nsec ) ;
int read_timeo(int sockfd , char *string , int max , int timeo ) ;
char *get_hostname(char const   *addr ) ;
void *s_malloc(unsigned long size ) ;
struct flags f ;
long get_ip(char *host___0 ) 
{ long ia ;
  struct hostent *h ;
  in_addr_t tmp ;

  {
  if (f.debug) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Getting IP\n");
  }
  tmp = inet_addr((char const   *)host___0);
  ia = (long )tmp;
  if (ia == -1L) {
    h = gethostbyname((char const   *)host___0);
    if ((unsigned int )h == (unsigned int )((void *)0)) {
      if (f.debug) {
        fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Couldn\'t resolv ip\n");
      }
      return (-1L);
    }
    memcpy((void * __restrict  )(& ia), (void const   * __restrict  )*(h->h_addr_list + 0),
           4U);
  }
  if (f.debug) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Got ip ok\n");
  }
  return (ia);
}
}
int tcp_connect(long ipa ) 
{ struct sockaddr_in their_addr ;
  int sockfd ;
  int socket_f ;

  {
  socket_f = 0;
  START1: 
  while (1) {
    sockfd = socket(2, 1, 0);
    if (! (sockfd == -1)) {
      break;
    }
    perror("socket: ");
    exit(1);
    if (socket_f > 12) {
      fatal((char *)"Still unable to create socket after 60 secs.... Try reducing the number of threads.....");
    }
    socket_f ++;
    if (f.verbose) {
      error((char *)"Unable to create socket.... sleeping for 5 seconds");
    } else {
      error((char *)"Unable to create socket.... sleeping for 5 seconds");
    }
    sleep(5U);
  }
  if (sockfd > 2000) {
    close(sockfd);
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Socket count exceding 2000; sleeping 5!\n");
    sleep(5U);
    goto START1;
  }
  their_addr.sin_family = (unsigned short)2;
  their_addr.sin_port = htons((unsigned short)25);
  their_addr.sin_addr.s_addr = (unsigned int )ipa;
  bzero((void *)(& their_addr.sin_zero), 8U);
  sockfd = connect_non_blocking(sockfd, (struct sockaddr  const  *)((struct sockaddr *)(& their_addr)),
                                sizeof(struct sockaddr ), (int )o.c_timeout);
  if (sockfd == -1) {
    if ((int )f.verbose > 1) {
      error((char *)"! Unable to connect to host");
    }
    return (-1);
  }
  if (sockfd > 2000) {
    printf((char const   * __restrict  )"\n\n\n\n\n\n\n\n******** in tcp_connect\n");
    sleep(10U);
  }
  return (sockfd);
}
}
int connect_non_blocking(int sockfd , struct sockaddr  const  *thaddr , socklen_t salen ,
                         int nsec ) 
{ int n ;
  int flags ;
  int serror ;
  socklen_t len ;
  fd_set rset ;
  fd_set wset ;
  struct timeval tval ;
  int tmp ;
  int *tmp___0 ;
  int __d0 ;
  int __d1 ;
  int *tmp___1 ;
  struct timeval *tmp___2 ;
  int tmp___3 ;
  register char __result ;
  register char __result___0 ;
  int tmp___4 ;
  int *tmp___5 ;

  {
  flags = fcntl(sockfd, 3, 0);
  if (flags == -1) {
    perror("Cant set flags");
    close(sockfd);
    return (-1);
  }
  tmp = fcntl(sockfd, 4, flags | 2048);
  if (tmp == -1) {
    perror("Cant set socket options");
    close(sockfd);
    return (-1);
  }
  serror = 0;
  n = connect(sockfd, thaddr, salen);
  if (n == -1) {
    tmp___0 = __errno_location();
    if (*tmp___0 != 115) {
      close(sockfd);
      return (-1);
    }
  }
  if (sockfd > 2000) {
    printf((char const   * __restrict  )"\n\n\n\n\n\n******** in connect non blocking\n");
    sleep(10U);
  }
  if (n == 0) {
    goto done;
  }
  while (1) {
    __asm__  volatile   ("cld; rep; stosl": "=c" (__d0), "=D" (__d1): "a" (0), "0" (sizeof(fd_set ) / sizeof(__fd_mask )),
                         "1" (& rset.__fds_bits[0]): "memory");
    break;
  }
  __asm__  volatile   ("btsl %1,%0": "=m" (rset.__fds_bits[(unsigned int )sockfd / (8U * sizeof(__fd_mask ))]): "r" ((unsigned int )sockfd % (8U * sizeof(__fd_mask ))): "cc",
                       "memory");
  wset = rset;
  tval.tv_sec = (long )nsec;
  tval.tv_usec = 500000L;
  if (nsec) {
    tmp___2 = & tval;
  } else {
    tmp___2 = (struct timeval *)((void *)0);
  }
  n = select(sockfd + 1, (fd_set * __restrict  )(& rset), (fd_set * __restrict  )(& wset),
             (fd_set * __restrict  )((void *)0), (struct timeval * __restrict  )tmp___2);
  if (n == 0) {
    close(sockfd);
    tmp___1 = __errno_location();
    *tmp___1 = 110;
    return (-1);
  } else {
    if (n == -1) {
      perror("Select failed\n");
      close(sockfd);
      return (-1);
    }
  }
  __asm__  volatile   ("btl %1,%2 ; setcb %b0": "=q" (__result): "r" ((unsigned int )sockfd % (8U * sizeof(__fd_mask ))),
                       "m" (rset.__fds_bits[(unsigned int )sockfd / (8U * sizeof(__fd_mask ))]): "cc");
  if (__result) {
    goto _L;
  } else {
    __asm__  volatile   ("btl %1,%2 ; setcb %b0": "=q" (__result___0): "r" ((unsigned int )sockfd % (8U * sizeof(__fd_mask ))),
                         "m" (wset.__fds_bits[(unsigned int )sockfd / (8U * sizeof(__fd_mask ))]): "cc");
    if (__result___0) {
      _L: /* CIL Label */ 
      len = sizeof(serror);
      tmp___3 = getsockopt(sockfd, 1, 4, (void * __restrict  )(& serror), (socklen_t * __restrict  )(& len));
      if (tmp___3 < 0) {
        close(sockfd);
        return (-1);
      }
    } else {
      error((char *)"**** Socket not set..... ");
      perror("FD_SET: ");
      close(sockfd);
      exit(-1);
    }
  }
  done: 
  tmp___4 = fcntl(sockfd, 4, flags);
  if (tmp___4 == -1) {
    perror("Can\'t restore the socket opts\n");
    close(sockfd);
    return (-1);
  }
  if (serror) {
    tmp___5 = __errno_location();
    *tmp___5 = serror;
    close(sockfd);
    return (-1);
  }
  return (sockfd);
}
}
int read_timeo(int sockfd , char *string , int max , int timeo ) 
{ struct timeval tv ;
  int numbytes ;
  fd_set readfds ;
  int __d0 ;
  int __d1 ;
  register char __result ;

  {
  numbytes = 0;
  tv.tv_sec = (long )timeo;
  tv.tv_usec = 500000L;
  while (1) {
    __asm__  volatile   ("cld; rep; stosl": "=c" (__d0), "=D" (__d1): "a" (0), "0" (sizeof(fd_set ) / sizeof(__fd_mask )),
                         "1" (& readfds.__fds_bits[0]): "memory");
    break;
  }
  __asm__  volatile   ("btsl %1,%0": "=m" (readfds.__fds_bits[(unsigned int )sockfd / (8U * sizeof(__fd_mask ))]): "r" ((unsigned int )sockfd % (8U * sizeof(__fd_mask ))): "cc",
                       "memory");
  select(sockfd + 1, (fd_set * __restrict  )(& readfds), (fd_set * __restrict  )((void *)0),
         (fd_set * __restrict  )((void *)0), (struct timeval * __restrict  )(& tv));
  __asm__  volatile   ("btl %1,%2 ; setcb %b0": "=q" (__result): "r" ((unsigned int )sockfd % (8U * sizeof(__fd_mask ))),
                       "m" (readfds.__fds_bits[(unsigned int )sockfd / (8U * sizeof(__fd_mask ))]): "cc");
  if (__result) {
    numbytes = read(sockfd, (void *)string, (unsigned int )max);
    if (numbytes < 1) {
      return (0);
    } else {
      *(string + numbytes) = (char )'\000';
    }
  } else {
    return (-1);
  }
  return (1);
}
}
char *get_hostname(char const   *addr ) 
{ struct hostent *hn ;
  struct in_addr *myaddr ;
  void *tmp ;

  {
  tmp = s_malloc((unsigned long )sizeof(struct in_addr ));
  myaddr = (struct in_addr *)tmp;
  myaddr->s_addr = inet_addr(addr);
  hn = gethostbyaddr((void const   *)((char *)myaddr), 4U, 2);
  if ((unsigned int )hn == (unsigned int )((void *)0)) {
    free((void *)myaddr);
    return ((char *)addr);
  }
  free((void *)myaddr);
  return (hn->h_name);
}
}
#pragma merger(0,"/tmp/cil-Pwl1SXo2.i","-Wall,-g,-pthread")
void display_screen(void) ;
void display_screen(void) 
{ int x ;
  int y ;

  {
  x = 0;
  y = 0;
  x = 0;
  while ((unsigned long )x < o.no_hostnames) {
    if ((*(hosts + x))->smtp_open) {
      printf((char const   * __restrict  )"Results for host: %s\n\n", (*(hosts + x))->ip_address);
      if ((*(hosts + x))->fatal_error) {
        printf((char const   * __restrict  )"There was a fatal error (%d) scanning this host\n",
               (*(hosts + x))->fatal_error);
        if ((int )(*(hosts + x))->fatal_error == 6) {
          goto _L;
        } else {
          if ((int )(*(hosts + x))->fatal_error == 7) {
            goto _L;
          } else {
            if ((int )(*(hosts + x))->fatal_error == 8) {
              _L: /* CIL Label */ 
              y = 0;
              while (y <= (int )o.no_rules) {
                printf((char const   * __restrict  )"\tResults for check: %d\n", y);
                printf((char const   * __restrict  )"\t\tError code: %d\n", (*((*(hosts + x))->smtp_check + y))->error_code);
                if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 3) {
                  printf((char const   * __restrict  )"\t\t*%s*\n", (*((*(hosts + x))->smtp_check + y))->r_mail_from);
                }
                if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 4) {
                  printf((char const   * __restrict  )"\t\t*%s*\n", (*((*(hosts + x))->smtp_check + y))->r_rcpt_to);
                }
                if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 7) {
                  printf((char const   * __restrict  )"\t\t*%s*\n", (*((*(hosts + x))->smtp_check + y))->r_reset);
                }
                y ++;
              }
            }
          }
        }
      } else {
        y = 0;
        while (y <= (int )o.no_rules) {
          printf((char const   * __restrict  )"\tResults for check: %d\n", y);
          if ((*((*(hosts + x))->smtp_check + y))->error_code) {
            printf((char const   * __restrict  )"This checkl failed with error code (%d)\n",
                   (*((*(hosts + x))->smtp_check + y))->error_code);
          } else {
            if ((*((*(hosts + x))->smtp_check + y))->passed) {
              printf((char const   * __restrict  )"\t\t*Passed this check\n");
            } else {
              printf((char const   * __restrict  )"\t\t!Failed this check\n");
            }
          }
          y ++;
        }
      }
    }
    x ++;
  }
  return;
}
}
#pragma merger(0,"/tmp/cil-keSUczDt.i","-Wall,-g,-pthread")
extern  __attribute__((__nothrow__)) time_t time(time_t *__timer ) ;
void set_defaults(void) ;
void banner(void) ;
void validate_options(void) ;
void parse_args(int argc , char * const  *argv ) ;
int get_domain(void) ;
int get_ip_range(char *iprange ) ;
int parse_config(char *configfile ) ;
int get_email_file(char *email_file ) ;
int parse_aconfig(void) ;
void start_scan(void) ;
void display_html(void) ;
void display_machine(void) ;
void display_text(void) ;
void display_xml(void) ;
int parse_mbox(void) ;
int parse_maildir(void) ;
int parse_popbox(void) ;
int main(int argc , char **argv ) 
{ time_t b_seconds ;
  time_t a_seconds ;
  int t_diff ;

  {
  b_seconds = (time_t )0;
  a_seconds = (time_t )0;
  banner();
  set_defaults();
  parse_args(argc, (char * const  *)argv);
  if (f.auto_config) {
    parse_aconfig();
  }
  validate_options();
  get_ip_range(o.ip_range);
  parse_config(o.config_file);
  get_domain();
  get_email_file(o.email_template);
  printf((char const   * __restrict  )"Starting the scan....... Please wait!\n\n\n");
  b_seconds = time((time_t *)((void *)0));
  start_scan();
  a_seconds = time((time_t *)((void *)0));
  if (b_seconds == -1L) {
    a_seconds = 20L;
    b_seconds = 0L;
  } else {
    if (a_seconds == -1L) {
      a_seconds = 20L;
      b_seconds = 0L;
    } else {
      if (a_seconds == b_seconds) {
        a_seconds = 20L;
        b_seconds = 0L;
      }
    }
  }
  t_diff = (int )(a_seconds - b_seconds);
  o.hours = (unsigned char )(t_diff / 3600);
  t_diff -= (int )o.hours * 3600;
  o.mins = (unsigned char )(t_diff / 60);
  t_diff -= (int )o.mins * 60;
  o.seconds = (unsigned char )t_diff;
  if (f.check_mailbox) {
    printf((char const   * __restrict  )"\n\n\nFinished Scanning, Waiting %d seconds for mails to arrive......\n\n",
           o.m_timeout);
    sleep((unsigned int )o.m_timeout);
    printf((char const   * __restrict  )"Checking mail....... Please Wait!\n");
    if (f.maildir) {
      parse_maildir();
    } else {
      if (f.mbox) {
        parse_mbox();
      } else {
        if (f.pop) {
          parse_popbox();
        }
      }
    }
  }
  if (f.output_html) {
    printf((char const   * __restrict  )"\n\nGenerating HTML results...... Please wait.\n\n");
    display_html();
  }
  if (f.output_text) {
    printf((char const   * __restrict  )"\n\nGenerating TEXT results...... Please wait.\n\n");
    display_text();
  }
  if (f.output_machine) {
    printf((char const   * __restrict  )"\n\nGenerating Machine Readable results...... Please wait.\n\n");
    display_machine();
  }
  if (f.output_xml) {
    printf((char const   * __restrict  )"\n\nGenerating XML results...... Please wait.\n\n");
    display_xml();
  }
  banner();
  return (0);
}
}
#pragma merger(0,"/tmp/cil-1UcA1mvr.i","-Wall,-g,-pthread")
extern  __attribute__((__nothrow__)) void *realloc(void *__ptr , size_t __size )  __attribute__((__warn_unused_result__,
__malloc__)) ;
extern struct _IO_FILE *stdin ;
extern int fclose(FILE *__stream ) ;
extern FILE *fopen(char const   * __restrict  __filename , char const   * __restrict  __modes ) ;
extern  __attribute__((__nothrow__)) int ( /* format attribute */  snprintf)(char * __restrict  __s ,
                                                                             size_t __maxlen ,
                                                                             char const   * __restrict  __format 
                                                                             , ...) ;
extern  __attribute__((__nothrow__)) int sscanf(char const   * __restrict  __s , char const   * __restrict  __format 
                                                , ...) ;
extern int fgetc(FILE *__stream ) ;
extern char *fgets(char * __restrict  __s , int __n , FILE * __restrict  __stream ) ;
extern void rewind(FILE *__stream ) ;
extern  __attribute__((__nothrow__)) void *memset(void *__s , int __c , size_t __n )  __attribute__((__nonnull__(1))) ;
extern  __attribute__((__nothrow__)) char *strcat(char * __restrict  __dest , char const   * __restrict  __src )  __attribute__((__nonnull__(1,2))) ;
extern  __attribute__((__nothrow__)) char *strncat(char * __restrict  __dest , char const   * __restrict  __src ,
                                                   size_t __n )  __attribute__((__nonnull__(1,2))) ;
extern  __attribute__((__nothrow__)) char *strstr(char const   *__haystack , char const   *__needle )  __attribute__((__pure__,
__nonnull__(1,2))) ;
extern unsigned short const   **__ctype_b_loc(void)  __attribute__((__const__)) ;
char *chomp(char *string ) ;
void debug(char *fmt  , ...) ;
host **hosts  ;
rule **rules  ;
int get_ip_range(char *iprange ) 
{ int start[4] ;
  int startc[4] ;
  int tstart[4] ;
  int tstartc[4] ;
  int end[4] ;
  int endc[4] ;
  int tend[4] ;
  int tendc[4] ;
  int i ;
  int last ;
  int hostnames ;
  char *r ;
  char *t ;
  char *p ;
  char buf[8193] ;
  char *addy[5] ;
  char *temp[2] ;
  char *iprange2 ;
  char hostnamet[8193] ;
  char *tmp ;
  size_t tmp___0 ;
  size_t tmp___1 ;
  void *tmp___2 ;
  size_t tmp___3 ;
  size_t tmp___4 ;
  unsigned short const   **tmp___5 ;
  unsigned short const   **tmp___6 ;
  char *tmp___7 ;
  char *tmp___8 ;
  void *tmp___9 ;
  void *tmp___10 ;
  void *tmp___11 ;
  size_t tmp___12 ;
  void *tmp___13 ;
  size_t tmp___14 ;
  size_t tmp___15 ;
  char *tmp___16 ;
  char *tmp___17 ;

  {
  i = 0;
  last = 0;
  hostnames = 0;
  tmp = strstr((char const   *)iprange, "/");
  if (tmp) {
    fatal((char *)"Netmask notation is not supported yet...... please use the format 192.168.*.1-255\n");
  }
  printf((char const   * __restrict  )"\nCreating a list of IP\'s to scan....... Please wait!\n\n");
  tmp___17 = strstr((char const   *)iprange, ",");
  if ((unsigned int )tmp___17 == (unsigned int )((void *)0)) {
    strncpy((char * __restrict  )(buf), (char const   * __restrict  )iprange, 8192U);
    tmp___0 = strlen((char const   *)iprange);
    buf[tmp___0] = (char )'\000';
    last = 1;
    goto GETIP;
  } else {
    p = iprange;
    t = p;
    while (1) {
      tmp___16 = p;
      p ++;
      if (! *tmp___16) {
        break;
      }
      if ((int )*p == 44) {
        *p = (char )'\000';
        p ++;
        strncpy((char * __restrict  )(buf), (char const   * __restrict  )t, 8192U);
        GETIP: 
        tmp___1 = strlen((char const   *)(buf));
        tmp___2 = s_malloc((unsigned long )((tmp___1 + 1U) * sizeof(char )));
        iprange2 = (char *)tmp___2;
        tmp___3 = strlen((char const   *)(buf));
        strncpy((char * __restrict  )iprange2, (char const   * __restrict  )(buf),
                tmp___3);
        tmp___4 = strlen((char const   *)(buf));
        *(iprange2 + tmp___4) = (char )'\000';
        addy[4] = (char *)((void *)0);
        addy[3] = addy[4];
        addy[2] = addy[3];
        addy[1] = addy[2];
        addy[0] = addy[1];
        r = buf;
        addy[0] = r;
        debug((char *)"R == %s\n", r);
        while (1) {
          r ++;
          if (! *r) {
            break;
          }
          if ((int )*r == 46) {
            i ++;
            if (i < 4) {
              *r = (char )'\000';
              addy[i] = r + 1;
            } else {
              goto _L;
            }
          } else {
            _L: /* CIL Label */ 
            if ((int )*r != 46) {
              if ((int )*r != 42) {
                if ((int )*r != 45) {
                  tmp___5 = __ctype_b_loc();
                  if (! ((int const   )*(*tmp___5 + (int )*r) & 2048)) {
                    if ((int )*r != 10) {
                      fatal((char *)"Invalid character in IP address notation\n");
                    }
                  }
                }
              }
            }
          }
        }
        if (i != 3) {
          fatal((char *)"IP address format is illegal\n");
        }
        i = 0;
        i = 0;
        while (i < 4) {
          if ((int )*(addy[i]) == 42) {
            if (i == 0) {
              fatal((char *)"For some reason I don\'t think it\'s wise scanning the whole bloody net\n\nBut if you sure then edit the source and remove this line\n");
            }
            if (i == 1) {
              fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Sure you wanna scan a entire class A.... \n\n..... OK!\n\n");
            }
            start[i] = 1;
            startc[i] = 1;
            end[i] = 255;
            endc[i] = 255;
          } else {
            tmp___8 = strstr((char const   *)addy[i], "-");
            if ((unsigned int )tmp___8 != (unsigned int )((void *)0)) {
              temp[0] = addy[i];
              while (1) {
                if ((int )*(addy[i]) != 10) {
                  if ((int )*(addy[i]) != 46) {
                    if (! *(addy[i])) {
                      break;
                    }
                  } else {
                    break;
                  }
                } else {
                  break;
                }
                if ((int )*(addy[i]) == 45) {
                  *(addy[i]) = (char )'\000';
                  temp[1] = addy[i] + 1;
                  start[i] = atoi((char const   *)temp[0]);
                  startc[i] = atoi((char const   *)temp[0]);
                  end[i] = atoi((char const   *)temp[1]);
                  endc[i] = atoi((char const   *)temp[1]);
                } else {
                  tmp___6 = __ctype_b_loc();
                  if (! ((int const   )*(*tmp___6 + (int )*(addy[i])) & 2048)) {
                    fatal((char *)"Invalid host specification\n");
                  }
                }
                tmp___7 = addy[i];
                (addy[i]) ++;
                if (*tmp___7) {

                }
              }
            } else {
              start[i] = atoi((char const   *)addy[i]);
              startc[i] = atoi((char const   *)addy[i]);
              end[i] = atoi((char const   *)addy[i]);
              endc[i] = atoi((char const   *)addy[i]);
            }
          }
          tstart[i] = start[i];
          tstartc[i] = start[i];
          tend[i] = end[i];
          tendc[i] = endc[i];
          if (start[i] > end[i]) {
            fatal((char *)"Invalid ip range\n");
          } else {
            if (start[i] < 0) {
              fatal((char *)"Invalid ip range\n");
            } else {
              if (end[i] > 255) {
                fatal((char *)"Invalid ip range\n");
              }
            }
          }
          i ++;
        }
        i = 0;
        while (i < 1) {
          while (start[i] <= end[i]) {
            while (start[i + 1] <= end[i + 1]) {
              while (start[i + 2] <= end[i + 2]) {
                while (start[i + 3] <= end[i + 3]) {
                  (o.no_hostnames) ++;
                  (start[i + 3]) ++;
                }
                start[i + 3] = tstart[i + 3];
                end[i + 3] = tend[i + 3];
                (start[i + 2]) ++;
              }
              start[i + 2] = tstart[i + 2];
              end[i + 2] = tend[i + 2];
              (start[i + 1]) ++;
            }
            start[i + 1] = tstart[i + 1];
            end[i + 1] = tend[i + 1];
            (start[i]) ++;
          }
          i ++;
        }
        if ((unsigned int )hosts == (unsigned int )((void *)0)) {
          tmp___9 = s_malloc((o.no_hostnames + 1UL) * (unsigned long )sizeof(host **));
          hosts = (host **)tmp___9;
        } else {
          tmp___10 = realloc((void *)hosts, (unsigned int )((o.no_hostnames + 1UL) * (unsigned long )sizeof(host **)));
          hosts = (host **)tmp___10;
        }
        i = 0;
        while (i < 1) {
          while (startc[i] <= endc[i]) {
            while (startc[i + 1] <= endc[i + 1]) {
              while (startc[i + 2] <= endc[i + 2]) {
                while (startc[i + 3] <= endc[i + 3]) {
                  if (f.debug) {
                    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"list == %i.%i.%i.%i\n",
                            startc[i], startc[i + 1], startc[i + 2], startc[i + 3]);
                    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"end --> %i.%i.%i.%i\n",
                            endc[i], endc[i + 1], endc[i + 2], endc[i + 3]);
                  }
                  snprintf((char * __restrict  )(hostnamet), 8192U, (char const   * __restrict  )"%i.%i.%i.%i",
                           startc[i], startc[i + 1], startc[i + 2], startc[i + 3]);
                  tmp___11 = s_malloc((unsigned long )sizeof(host ));
                  *(hosts + hostnames) = (host *)tmp___11;
                  (*(hosts + hostnames))->resolved = (unsigned char)0;
                  (*(hosts + hostnames))->smtp_open = (unsigned char)0;
                  (*(hosts + hostnames))->fatal = (unsigned char)0;
                  (*(hosts + hostnames))->fatal_error = (unsigned char)0;
                  tmp___12 = strlen((char const   *)(hostnamet));
                  tmp___13 = s_malloc((unsigned long )((tmp___12 + 1U) * sizeof(char )));
                  (*(hosts + hostnames))->ip_address = (char *)tmp___13;
                  tmp___14 = strlen((char const   *)(hostnamet));
                  strncpy((char * __restrict  )(*(hosts + hostnames))->ip_address,
                          (char const   * __restrict  )(hostnamet), tmp___14);
                  tmp___15 = strlen((char const   *)(hostnamet));
                  *((*(hosts + hostnames))->ip_address + tmp___15) = (char )'\000';
                  if (f.debug) {
                    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Hostname == %s",
                            (*(hosts + hostnames))->ip_address);
                  }
                  hostnames ++;
                  (startc[i + 3]) ++;
                }
                startc[i + 3] = tstartc[i + 3];
                endc[i + 3] = tendc[i + 3];
                (startc[i + 2]) ++;
              }
              startc[i + 2] = tstartc[i + 2];
              endc[i + 2] = tendc[i + 2];
              (startc[i + 1]) ++;
            }
            startc[i + 1] = tstartc[i + 1];
            endc[i + 1] = tendc[i + 1];
            (startc[i]) ++;
          }
          i ++;
        }
        if (last) {
          goto END;
        }
        if ((unsigned int )iprange2 != (unsigned int )((void *)0)) {
          free((void *)iprange2);
          iprange2 = (char *)((void *)0);
        }
        strncpy((char * __restrict  )(buf), (char const   * __restrict  )t, 8192U);
        t = p;
        i = 0;
      }
    }
    if (t) {
      if ((unsigned int )iprange2 != (unsigned int )((void *)0)) {
        free((void *)iprange2);
        iprange2 = (char *)((void *)0);
      }
      strncpy((char * __restrict  )(buf), (char const   * __restrict  )t, 8192U);
      t = p;
      i = 0;
      last = 1;
      goto GETIP;
    }
  }
  END: 
  if ((unsigned int )iprange2 != (unsigned int )((void *)0)) {
    free((void *)iprange2);
    iprange2 = (char *)((void *)0);
  }
  return (0);
}
}
int parse_config(char *configfile ) 
{ FILE *fd ;
  int i ;
  int nolines ;
  char *buf1 ;
  char buf2[3][250] ;
  char c ;
  int tmp ;
  void *tmp___0 ;
  void *tmp___1 ;
  char *tmp___2 ;
  char *tmp___3 ;
  char *tmp___4 ;
  void *tmp___5 ;
  size_t tmp___6 ;
  void *tmp___7 ;
  size_t tmp___8 ;
  size_t tmp___9 ;
  size_t tmp___10 ;
  void *tmp___11 ;
  size_t tmp___12 ;
  size_t tmp___13 ;
  size_t tmp___14 ;
  void *tmp___15 ;
  size_t tmp___16 ;
  size_t tmp___17 ;
  int tmp___18 ;
  char *tmp___19 ;

  {
  i = 0;
  nolines = 0;
  fd = fopen((char const   * __restrict  )configfile, (char const   * __restrict  )"r");
  if ((unsigned int )fd == (unsigned int )((void *)0)) {
    fatal((char *)"Unable to open config file \"%s\"\n", configfile);
  }
  while (1) {
    tmp = fgetc(fd);
    c = (char )tmp;
    if (! ((int )c != -1)) {
      break;
    }
    if ((int )c == 10) {
      nolines ++;
    }
  }
  nolines ++;
  rewind(fd);
  tmp___0 = s_malloc((unsigned long )((unsigned int )nolines * sizeof(rule **)));
  rules = (rule **)tmp___0;
  i = 0;
  tmp___1 = s_malloc((unsigned long )(352U * sizeof(char )));
  buf1 = (char *)tmp___1;
  while (1) {
    tmp___19 = fgets((char * __restrict  )buf1, 350, (FILE * __restrict  )fd);
    if (! tmp___19) {
      break;
    }
    if ((int )*(buf1 + 0) == 35) {
      continue;
    } else {
      if ((int )*(buf1 + 0) == 10) {
        continue;
      } else {
        if ((int )*(buf1 + 0) == 32) {
          continue;
        }
      }
    }
    tmp___2 = strstr((char const   *)buf1, "--NAME--");
    if ((unsigned int )tmp___2 != (unsigned int )((void *)0)) {
      goto _L;
    } else {
      tmp___3 = strstr((char const   *)buf1, "--DOMAIN--");
      if ((unsigned int )tmp___3 != (unsigned int )((void *)0)) {
        _L: /* CIL Label */ 
        if (! f.send_email) {
          fatal((char *)"You can only use the --NAME-- and --DOMAIN-- macro\'s if you supply the -b (email_address) option");
        }
        f.got_name_macro = (unsigned char)1;
      }
    }
    if (! f.resolve_hostnames) {
      tmp___4 = strstr((char const   *)buf1, "--HOSTNAME--");
      if ((unsigned int )tmp___4 != (unsigned int )((void *)0)) {
        fatal((char *)"You can only use the --HOSTNAME-- macro\'s in the configuration file\nif you specify the -n option on the command line or set RESOLVEDOMAINS:Yes in the auto config file\n");
      }
    }
    tmp___18 = sscanf((char const   * __restrict  )buf1, (char const   * __restrict  )"%240s%240s%240s",
                      buf2[0], buf2[1], buf2[2]);
    if (tmp___18 == 3) {
      tmp___5 = s_malloc((unsigned long )sizeof(rule *));
      *(rules + i) = (rule *)tmp___5;
      tmp___6 = strlen((char const   *)(buf2[0]));
      tmp___7 = s_malloc((unsigned long )((tmp___6 + 1U) * sizeof(char )));
      (*(rules + i))->helo = (char *)tmp___7;
      tmp___8 = strlen((char const   *)(buf2[0]));
      strncpy((char * __restrict  )(*(rules + i))->helo, (char const   * __restrict  )(buf2[0]),
              tmp___8);
      tmp___9 = strlen((char const   *)(buf2[0]));
      *((*(rules + i))->helo + tmp___9) = (char )'\000';
      debug((char *)"Rules->helo: %s\n", (*(rules + i))->helo);
      tmp___10 = strlen((char const   *)(buf2[1]));
      tmp___11 = s_malloc((unsigned long )((tmp___10 + 1U) * sizeof(char )));
      (*(rules + i))->mail_from = (char *)tmp___11;
      tmp___12 = strlen((char const   *)(buf2[1]));
      strncpy((char * __restrict  )(*(rules + i))->mail_from, (char const   * __restrict  )(buf2[1]),
              tmp___12);
      tmp___13 = strlen((char const   *)(buf2[1]));
      *((*(rules + i))->mail_from + tmp___13) = (char )'\000';
      debug((char *)"Rules->mail_from: %s\n", (*(rules + i))->mail_from);
      tmp___14 = strlen((char const   *)(buf2[2]));
      tmp___15 = s_malloc((unsigned long )((tmp___14 + 1U) * sizeof(char )));
      (*(rules + i))->rcpt_to = (char *)tmp___15;
      tmp___16 = strlen((char const   *)(buf2[2]));
      strncpy((char * __restrict  )(*(rules + i))->rcpt_to, (char const   * __restrict  )(buf2[2]),
              tmp___16);
      tmp___17 = strlen((char const   *)(buf2[2]));
      *((*(rules + i))->rcpt_to + tmp___17) = (char )'\000';
      debug((char *)"Rules->rcpt_to: %s\n", (*(rules + i))->rcpt_to);
      o.no_rules = (unsigned short )((int )o.no_rules + 1);
      i ++;
    }
  }
  o.no_rules = (unsigned short )((int )o.no_rules - 1);
  fclose(fd);
  return (0);
}
}
int get_email_file(char *email_file ) 
{ FILE *fd ;
  char *p ;
  char *t ;
  char *s ;
  char buf[8193] ;
  char c ;
  char *temp ;
  int subject ;
  int body ;
  int rflag ;
  int nflag ;
  int size ;
  int count ;
  int tmp ;
  int tmp___0 ;
  size_t tmp___1 ;
  size_t tmp___2 ;
  void *tmp___3 ;
  void *tmp___4 ;
  char *tmp___5 ;
  size_t tmp___6 ;
  size_t tmp___7 ;
  void *tmp___8 ;
  void *tmp___9 ;
  char *tmp___10 ;
  int tmp___11 ;
  char *tmp___12 ;
  size_t tmp___13 ;
  size_t tmp___14 ;
  void *tmp___15 ;
  void *tmp___16 ;
  char *tmp___17 ;
  size_t tmp___18 ;
  size_t tmp___19 ;
  void *tmp___20 ;
  void *tmp___21 ;
  char *tmp___22 ;
  int tmp___23 ;
  char *tmp___24 ;
  int tmp___25 ;
  int tmp___26 ;
  int tmp___27 ;
  int tmp___28 ;
  int tmp___29 ;
  int tmp___30 ;
  int tmp___31 ;
  int tmp___32 ;
  size_t tmp___33 ;
  int tmp___34 ;
  int tmp___35 ;
  size_t tmp___36 ;
  char *tmp___37 ;
  int tmp___38 ;
  int tmp___39 ;
  char *tmp___40 ;
  int tmp___41 ;
  int tmp___42 ;
  size_t tmp___43 ;
  void *tmp___44 ;
  size_t tmp___45 ;
  char *tmp___46 ;
  size_t tmp___47 ;
  void *tmp___48 ;
  size_t tmp___49 ;
  size_t tmp___50 ;

  {
  subject = 0;
  body = 0;
  rflag = 0;
  nflag = 0;
  size = 0;
  count = 0;
  fd = fopen((char const   * __restrict  )email_file, (char const   * __restrict  )"r");
  if ((unsigned int )fd == (unsigned int )((void *)0)) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n\nERROR:\n\nUnable to open the email file [%s] you specified\nDo you wan to continue using the default?\n\nContinue:\t[y] [n]\n:",
            email_file);
    tmp = fgetc(stdin);
    c = (char )tmp;
    if ((int )c == 121) {
      f.got_email = (unsigned char)0;
      return (1);
    } else {
      tmp___0 = fgetc(stdin);
      c = (char )tmp___0;
      if ((int )c == 89) {
        f.got_email = (unsigned char)0;
        return (1);
      } else {
        exit(1);
      }
    }
  }
  while (1) {
    tmp___12 = fgets((char * __restrict  )(buf), 8192, (FILE * __restrict  )fd);
    if (! tmp___12) {
      break;
    }
    tmp___11 = strncmp((char const   *)(buf), "SUBJECT:", 8U);
    if (! tmp___11) {
      subject = 1;
      p = buf + 8;
      if ((int )*p != 0) {
        if (f.debug) {
          fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"DEBUG: email subject == [%s]\n",
                  p);
        }
        tmp___1 = strlen((char const   *)p);
        size = (int )tmp___1;
        t = strstr((char const   *)p, "ENDSUBJECT");
        if ((unsigned int )t != (unsigned int )((void *)0)) {
          *t = (char )'\000';
          tmp___2 = strlen((char const   *)p);
          size = (int )tmp___2;
          tmp___3 = s_malloc((unsigned long )((unsigned int )(size + 1) * sizeof(char )));
          o.email_subject = (char *)tmp___3;
          strncpy((char * __restrict  )o.email_subject, (char const   * __restrict  )p,
                  (unsigned int )size);
          *(o.email_subject + size) = (char )'\000';
          break;
        }
        tmp___4 = s_malloc((unsigned long )((unsigned int )(size + 1) * sizeof(char )));
        o.email_subject = (char *)tmp___4;
        strncpy((char * __restrict  )o.email_subject, (char const   * __restrict  )p,
                (unsigned int )size);
        *(o.email_subject + size) = (char )'\000';
      }
      while (1) {
        tmp___5 = fgets((char * __restrict  )(buf), 8192, (FILE * __restrict  )fd);
        if ((unsigned int )tmp___5 == (unsigned int )((void *)0)) {
          subject = 0;
          break;
        }
        tmp___6 = strlen((char const   *)(buf));
        size = (int )((size_t )size + tmp___6);
        if (f.debug) {
          fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"DEBUG: email subject == [%s]\r\n",
                  buf);
        }
        t = strstr((char const   *)(buf), "ENDSUBJECT");
        if ((unsigned int )t != (unsigned int )((void *)0)) {
          *t = (char )'\000';
          tmp___7 = strlen((char const   *)(buf));
          size = (int )((size_t )size + tmp___7);
          tmp___8 = realloc((void *)o.email_subject, (unsigned int )(size + 2) * sizeof(char ));
          o.email_subject = (char *)tmp___8;
          if ((unsigned int )o.email_subject == (unsigned int )((void *)0)) {
            fatal((char *)"Realloc Error\n");
          }
          strncat((char * __restrict  )o.email_subject, (char const   * __restrict  )(buf),
                  (unsigned int )size);
          *(o.email + size) = (char )'\000';
          break;
        }
        tmp___9 = realloc((void *)o.email_subject, (unsigned int )(size + 1) * sizeof(char ));
        o.email_subject = (char *)tmp___9;
        if ((unsigned int )o.email_subject == (unsigned int )((void *)0)) {
          fatal((char *)"Realloc Error\n");
        }
        strncat((char * __restrict  )o.email_subject, (char const   * __restrict  )(buf),
                (unsigned int )size);
        *(o.email + size) = (char )'\000';
        tmp___10 = strstr((char const   *)(buf), "ENDSUBJECT");
        if (! ((unsigned int )tmp___10 == (unsigned int )((void *)0))) {
          break;
        }
      }
    }
  }
  rewind(fd);
  while (1) {
    tmp___24 = fgets((char * __restrict  )(buf), 8192, (FILE * __restrict  )fd);
    if (! tmp___24) {
      break;
    }
    tmp___23 = strncmp((char const   *)(buf), "BODY:", 5U);
    if (! tmp___23) {
      body = 1;
      p = buf + 5;
      if ((int )*p != 0) {
        if (f.debug) {
          fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"DEBUG: email body == [%s]\n",
                  p);
        }
        tmp___13 = strlen((char const   *)p);
        size = (int )tmp___13;
        t = strstr((char const   *)(buf), "ENDBODY");
        if ((unsigned int )t != (unsigned int )((void *)0)) {
          *t = (char )'\000';
          tmp___14 = strlen((char const   *)(buf));
          size = (int )tmp___14;
          tmp___15 = s_malloc((unsigned long )((unsigned int )(size + 1) * sizeof(char )));
          o.email = (char *)tmp___15;
          strncpy((char * __restrict  )o.email, (char const   * __restrict  )p, (unsigned int )size);
          *(o.email + size) = (char )'\000';
          break;
        }
        tmp___16 = s_malloc((unsigned long )((unsigned int )(size + 1) * sizeof(char )));
        o.email = (char *)tmp___16;
        strncpy((char * __restrict  )o.email, (char const   * __restrict  )p, (unsigned int )size);
        *(o.email + size) = (char )'\000';
      }
      while (1) {
        tmp___17 = fgets((char * __restrict  )(buf), 8192, (FILE * __restrict  )fd);
        if ((unsigned int )tmp___17 == (unsigned int )((void *)0)) {
          body = 0;
          break;
        }
        tmp___18 = strlen((char const   *)(buf));
        size = (int )((size_t )size + tmp___18);
        if (f.debug) {
          fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"DEBUG: email body == [%s]\n",
                  buf);
        }
        t = strstr((char const   *)(buf), "ENDBODY");
        if ((unsigned int )t != (unsigned int )((void *)0)) {
          *t = (char )'\000';
          tmp___19 = strlen((char const   *)(buf));
          size = (int )((size_t )size + tmp___19);
          tmp___20 = realloc((void *)o.email, (unsigned int )(size + 1) * sizeof(char ));
          o.email = (char *)tmp___20;
          if ((unsigned int )o.email == (unsigned int )((void *)0)) {
            fatal((char *)"Realloc Error\n");
          }
          strncat((char * __restrict  )o.email, (char const   * __restrict  )(buf),
                  (unsigned int )size);
          *(o.email + size) = (char )'\000';
          break;
        }
        tmp___21 = realloc((void *)o.email, (unsigned int )(size + 1) * sizeof(char ));
        o.email = (char *)tmp___21;
        if ((unsigned int )o.email == (unsigned int )((void *)0)) {
          fatal((char *)"Realloc Error\n");
        }
        strncat((char * __restrict  )o.email, (char const   * __restrict  )(buf),
                (unsigned int )size);
        *(o.email + size) = (char )'\000';
        tmp___22 = strstr((char const   *)(buf), "ENDBODY");
        if (! ((unsigned int )tmp___22 == (unsigned int )((void *)0))) {
          break;
        }
      }
    }
  }
  if (! body) {
    goto _L;
  } else {
    if (! subject) {
      _L: /* CIL Label */ 
      fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n\nERROR:\n\nEmail file is in the wrong format\nDo you want to continue using the default?\n\nContinue\t[y] [n]\t:");
      tmp___25 = fgetc(stdin);
      c = (char )tmp___25;
      if ((int )c == 121) {
        f.got_email = (unsigned char)0;
        return (1);
      } else {
        tmp___26 = fgetc(stdin);
        c = (char )tmp___26;
        if ((int )c == 89) {
          f.got_email = (unsigned char)0;
          return (1);
        } else {
          exit(1);
        }
      }
    }
  }
  if (! o.email) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n\nERROR:\n\nThe body of your email is empty\nDo you want to continue using the default?\n\nContinue\t[y] [n]\t:");
    tmp___27 = fgetc(stdin);
    c = (char )tmp___27;
    if ((int )c == 121) {
      f.got_email = (unsigned char)0;
      return (1);
    } else {
      tmp___28 = fgetc(stdin);
      c = (char )tmp___28;
      if ((int )c == 89) {
        f.got_email = (unsigned char)0;
        return (1);
      } else {
        exit(1);
      }
    }
  }
  if (! o.email_subject) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n\nERROR:\n\nThe subject of your email is empty\nDo you want to continue using the default?\n\nContinue\t[y] [n]\t:");
    tmp___29 = fgetc(stdin);
    c = (char )tmp___29;
    if ((int )c == 121) {
      f.got_email = (unsigned char)0;
      return (1);
    } else {
      tmp___30 = fgetc(stdin);
      c = (char )tmp___30;
      if ((int )c == 89) {
        f.got_email = (unsigned char)0;
        return (1);
      } else {
        exit(1);
      }
    }
  }
  tmp___33 = strlen((char const   *)o.email);
  if (tmp___33 < 2U) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n\nERROR:\n\nThe body of your email contains 1 character\nDo you want to continue using the default?\n\nContinue\t[y] [n]\t:");
    tmp___31 = fgetc(stdin);
    c = (char )tmp___31;
    if ((int )c == 121) {
      f.got_email = (unsigned char)0;
      return (1);
    } else {
      tmp___32 = fgetc(stdin);
      c = (char )tmp___32;
      if ((int )c == 89) {
        f.got_email = (unsigned char)0;
        return (1);
      } else {
        exit(1);
      }
    }
  }
  tmp___36 = strlen((char const   *)o.email_subject);
  if (tmp___36 < 2U) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n\nERROR:\n\nThe subject of your email contains 1 character\nDo you want to continue using the default?\n\nContinue\t[y] [n]\t:");
    tmp___34 = fgetc(stdin);
    c = (char )tmp___34;
    if ((int )c == 121) {
      f.got_email = (unsigned char)0;
      return (1);
    } else {
      tmp___35 = fgetc(stdin);
      c = (char )tmp___35;
      if ((int )c == 89) {
        f.got_email = (unsigned char)0;
        return (1);
      } else {
        exit(1);
      }
    }
  }
  p = o.email_subject;
  while (1) {
    if ((int )*p == 10) {
      nflag ++;
    }
    if ((int )*p == 13) {
      rflag ++;
    }
    tmp___37 = p;
    p ++;
    if (! ((int )*tmp___37 != 0)) {
      break;
    }
  }
  if (nflag > 1) {
    goto _L___2;
  } else {
    if (rflag > 1) {
      _L___2: /* CIL Label */ 
      fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n\nERROR:\n\nThere is more than one line feed in the email subject\nDo you want to continue using the default?\n\nContinue\t[y] [n]\t:");
      tmp___38 = fgetc(stdin);
      c = (char )tmp___38;
      if ((int )c == 121) {
        f.got_email = (unsigned char)0;
        return (1);
      } else {
        tmp___39 = fgetc(stdin);
        c = (char )tmp___39;
        if ((int )c == 89) {
          f.got_email = (unsigned char)0;
          return (1);
        } else {
          exit(1);
        }
      }
    } else {
      if (nflag == 0) {
        if (rflag == 0) {
          strcat((char * __restrict  )o.email_subject, (char const   * __restrict  )"\r\n");
        } else {
          goto _L___1;
        }
      } else {
        _L___1: /* CIL Label */ 
        if (nflag == 0) {
          if (rflag == 1) {
            strcat((char * __restrict  )o.email_subject, (char const   * __restrict  )"\r");
          } else {
            goto _L___0;
          }
        } else {
          _L___0: /* CIL Label */ 
          if (nflag == 1) {
            if (rflag == 1) {
              nflag = 0;
              rflag = 0;
              p = o.email_subject;
              while (1) {
                if ((int )*p == 10) {
                  s = p;
                  *s = (char )((int )*s - 1);
                  if (*s == 13) {
                    rflag ++;
                  }
                }
                tmp___40 = p;
                p ++;
                if (! ((int )*tmp___40 != 0)) {
                  break;
                }
              }
              if (! rflag) {
                fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n\nERROR:\n\nThere is supurious carraige return in the subject\nDo you want to continue using the default?\n\nContinue\t[y] [n]\t:");
                tmp___41 = fgetc(stdin);
                c = (char )tmp___41;
                if ((int )c == 121) {
                  f.got_email = (unsigned char)0;
                  return (1);
                } else {
                  tmp___42 = fgetc(stdin);
                  c = (char )tmp___42;
                  if ((int )c == 89) {
                    f.got_email = (unsigned char)0;
                    return (1);
                  } else {
                    exit(1);
                  }
                }
              }
            }
          }
        }
      }
    }
  }
  tmp___43 = strlen((char const   *)o.email);
  tmp___44 = s_malloc((unsigned long )((tmp___43 + 1U) * sizeof(char )));
  temp = (char *)tmp___44;
  tmp___45 = strlen((char const   *)o.email);
  strncpy((char * __restrict  )temp, (char const   * __restrict  )o.email, tmp___45);
  p = temp;
  rflag = 0;
  count = 0;
  memset((void *)(buf), 0, 8192U);
  while (1) {
    if ((int )*p == 10) {
      if (! count) {
        strncat((char * __restrict  )(buf), (char const   * __restrict  )"\r\n", 8192U);
        rflag ++;
        rflag ++;
        goto __Cont;
      }
      s = p;
      *s = (char )((int )*s - 1);
      if (*s != 13) {
        strncat((char * __restrict  )(buf), (char const   * __restrict  )"\r\n", 8192U);
        rflag ++;
        rflag ++;
        goto __Cont;
      }
    }
    if ((int )*p == 0) {
      break;
    }
    buf[rflag] = *p;
    count ++;
    rflag ++;
    __Cont: /* CIL Label */ 
    tmp___46 = p;
    p ++;
    if (! ((int )*tmp___46 != 0)) {
      break;
    }
  }
  tmp___47 = strlen((char const   *)(buf));
  tmp___48 = realloc((void *)o.email, (tmp___47 + 1U) * sizeof(char ));
  o.email = (char *)tmp___48;
  if ((unsigned int )o.email == (unsigned int )((void *)0)) {
    fatal((char *)"Realloc Error\n");
  }
  tmp___49 = strlen((char const   *)(buf));
  strncpy((char * __restrict  )o.email, (char const   * __restrict  )(buf), tmp___49);
  tmp___50 = strlen((char const   *)(buf));
  *(o.email + tmp___50) = (char )'\000';
  if (f.debug) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"DEBUG: end subject == [%s]\n",
            o.email_subject);
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"DEBUG: end body == [%s]\n",
            o.email);
  }
  free((void *)temp);
  return (0);
}
}
int parse_aconfig(void) 
{ FILE *fd ;
  char buf[8192] ;
  char *p ;
  size_t tmp ;
  void *tmp___0 ;
  size_t tmp___1 ;
  char *tmp___2 ;
  size_t tmp___3 ;
  size_t tmp___4 ;
  void *tmp___5 ;
  size_t tmp___6 ;
  char *tmp___7 ;
  size_t tmp___8 ;
  size_t tmp___9 ;
  void *tmp___10 ;
  size_t tmp___11 ;
  char *tmp___12 ;
  size_t tmp___13 ;
  int tmp___14 ;
  size_t tmp___15 ;
  void *tmp___16 ;
  size_t tmp___17 ;
  char *tmp___18 ;
  size_t tmp___19 ;
  size_t tmp___20 ;
  void *tmp___21 ;
  size_t tmp___22 ;
  char *tmp___23 ;
  size_t tmp___24 ;
  size_t tmp___25 ;
  void *tmp___26 ;
  size_t tmp___27 ;
  char *tmp___28 ;
  size_t tmp___29 ;
  size_t tmp___30 ;
  void *tmp___31 ;
  size_t tmp___32 ;
  char *tmp___33 ;
  size_t tmp___34 ;
  int tmp___35 ;
  int tmp___36 ;
  int tmp___37 ;
  int tmp___38 ;
  int tmp___39 ;
  int tmp___40 ;
  int tmp___41 ;
  int tmp___42 ;
  int tmp___43 ;
  size_t tmp___44 ;
  void *tmp___45 ;
  size_t tmp___46 ;
  char *tmp___47 ;
  size_t tmp___48 ;
  int tmp___49 ;
  int tmp___50 ;
  int tmp___51 ;
  int tmp___52 ;
  int tmp___53 ;
  int tmp___54 ;
  int tmp___55 ;
  int tmp___56 ;
  int tmp___57 ;
  int tmp___58 ;
  int tmp___59 ;
  int tmp___60 ;
  int tmp___61 ;
  int tmp___62 ;
  int tmp___63 ;
  int tmp___64 ;
  int tmp___65 ;
  int tmp___66 ;
  char *tmp___67 ;

  {
  fd = fopen((char const   * __restrict  )o.auto_config_file, (char const   * __restrict  )"r");
  if ((unsigned int )fd == (unsigned int )((void *)0)) {
    fatal((char *)"Unable to open auto config file %s\n\n", o.auto_config_file);
  }
  while (1) {
    tmp___67 = fgets((char * __restrict  )(buf), 8191, (FILE * __restrict  )fd);
    if (! ((unsigned int )tmp___67 != (unsigned int )((void *)0))) {
      break;
    }
    if ((int )buf[0] == 35) {
      continue;
    } else {
      if ((int )buf[1] == 35) {
        continue;
      } else {
        if ((int )buf[0] == 32) {
          continue;
        } else {
          if ((int )buf[0] == 10) {
            continue;
          }
        }
      }
    }
    tmp___66 = strncmp((char const   *)(buf), "IPRANGE:", 8U);
    if (tmp___66) {
      tmp___65 = strncmp((char const   *)(buf), "CONFIGFILE:", 11U);
      if (tmp___65) {
        tmp___64 = strncmp((char const   *)(buf), "WEBPAGE:", 8U);
        if (tmp___64) {
          tmp___63 = strncmp((char const   *)(buf), "THREADS:", 8U);
          if (tmp___63) {
            tmp___62 = strncmp((char const   *)(buf), "IPLIST:", 7U);
            if (tmp___62) {
              tmp___61 = strncmp((char const   *)(buf), "RELAYEMAIL:", 11U);
              if (tmp___61) {
                tmp___60 = strncmp((char const   *)(buf), "MBOXMAILBOX:", 12U);
                if (tmp___60) {
                  tmp___59 = strncmp((char const   *)(buf), "MAILDIRMAILBOX:", 15U);
                  if (tmp___59) {
                    tmp___58 = strncmp((char const   *)(buf), "ALLSCANS:", 9U);
                    if (tmp___58) {
                      tmp___57 = strncmp((char const   *)(buf), "RESOLVEDOMAINS:",
                                         15U);
                      if (tmp___57) {
                        tmp___56 = strncmp((char const   *)(buf), "CONNECTTIMEOUT:",
                                           15U);
                        if (tmp___56) {
                          tmp___55 = strncmp((char const   *)(buf), "READTIMEOUT:",
                                             12U);
                          if (tmp___55) {
                            tmp___54 = strncmp((char const   *)(buf), "WAITFORMAILTIME:",
                                               16U);
                            if (tmp___54) {
                              tmp___53 = strncmp((char const   *)(buf), "EMAILTEMPLATE:",
                                                 14U);
                              if (tmp___53) {
                                tmp___52 = strncmp((char const   *)(buf), "DISPLAYONLYIPS:",
                                                   15U);
                                if (tmp___52) {
                                  fatal((char *)"Detected error \"%s\" in configuration file...\n",
                                        buf);
                                } else {
                                  p = & buf[15];
                                  tmp___49 = strncmp((char const   *)p, "Yes", 3U);
                                  if (tmp___49) {
                                    tmp___50 = strncmp((char const   *)p, "YES", 3U);
                                    if (tmp___50) {
                                      tmp___51 = strncmp((char const   *)p, "yes",
                                                         3U);
                                      if (! tmp___51) {
                                        f.display_only_ips = (unsigned char)1;
                                      }
                                    } else {
                                      f.display_only_ips = (unsigned char)1;
                                    }
                                  } else {
                                    f.display_only_ips = (unsigned char)1;
                                  }
                                }
                              } else {
                                if (! f.got_email) {
                                  p = & buf[14];
                                  f.got_email = (unsigned char)1;
                                  tmp___44 = strlen((char const   *)p);
                                  tmp___45 = s_malloc((unsigned long )((tmp___44 + 1U) * sizeof(char )));
                                  o.email_template = (char *)tmp___45;
                                  tmp___46 = strlen((char const   *)p);
                                  tmp___47 = chomp(p);
                                  strncpy((char * __restrict  )o.email_template, (char const   * __restrict  )tmp___47,
                                          tmp___46);
                                  tmp___48 = strlen((char const   *)p);
                                  *(o.email_template + tmp___48) = (char )'\000';
                                }
                              }
                            } else {
                              if (! o.m_timeout == 60) {
                                p = & buf[16];
                                tmp___43 = atoi((char const   *)p);
                                o.m_timeout = (unsigned short )tmp___43;
                              }
                            }
                          } else {
                            if (! o.r_timeout) {
                              p = & buf[12];
                              tmp___42 = atoi((char const   *)p);
                              o.r_timeout = (unsigned short )tmp___42;
                            }
                          }
                        } else {
                          if (! o.c_timeout) {
                            p = & buf[15];
                            tmp___41 = atoi((char const   *)p);
                            o.c_timeout = (unsigned short )tmp___41;
                          }
                        }
                      } else {
                        p = & buf[15];
                        tmp___38 = strncmp((char const   *)p, "Yes", 3U);
                        if (tmp___38) {
                          tmp___39 = strncmp((char const   *)p, "YES", 3U);
                          if (tmp___39) {
                            tmp___40 = strncmp((char const   *)p, "yes", 3U);
                            if (! tmp___40) {
                              f.resolve_hostnames = (unsigned char)1;
                            }
                          } else {
                            f.resolve_hostnames = (unsigned char)1;
                          }
                        } else {
                          f.resolve_hostnames = (unsigned char)1;
                        }
                      }
                    } else {
                      p = & buf[9];
                      tmp___35 = strncmp((char const   *)p, "Yes", 3U);
                      if (tmp___35) {
                        tmp___36 = strncmp((char const   *)p, "YES", 3U);
                        if (tmp___36) {
                          tmp___37 = strncmp((char const   *)p, "yes", 3U);
                          if (! tmp___37) {
                            f.display_all = (unsigned char)1;
                          }
                        } else {
                          f.display_all = (unsigned char)1;
                        }
                      } else {
                        f.display_all = (unsigned char)1;
                      }
                    }
                  } else {
                    if (! f.check_mailbox) {
                      p = & buf[15];
                      f.check_mailbox = (unsigned char)1;
                      f.maildir = (unsigned char)1;
                      tmp___30 = strlen((char const   *)p);
                      tmp___31 = s_malloc((unsigned long )((tmp___30 + 1U) * sizeof(char )));
                      o.mailbox = (char *)tmp___31;
                      tmp___32 = strlen((char const   *)p);
                      tmp___33 = chomp(p);
                      strncpy((char * __restrict  )o.mailbox, (char const   * __restrict  )tmp___33,
                              tmp___32);
                      tmp___34 = strlen((char const   *)p);
                      *(o.mailbox + tmp___34) = (char )'\000';
                    }
                    f.maildir = (unsigned char)1;
                  }
                } else {
                  if (! f.check_mailbox) {
                    p = & buf[12];
                    f.check_mailbox = (unsigned char)1;
                    f.mbox = (unsigned char)1;
                    tmp___25 = strlen((char const   *)p);
                    tmp___26 = s_malloc((unsigned long )((tmp___25 + 1U) * sizeof(char )));
                    o.mailbox = (char *)tmp___26;
                    tmp___27 = strlen((char const   *)p);
                    tmp___28 = chomp(p);
                    strncpy((char * __restrict  )o.mailbox, (char const   * __restrict  )tmp___28,
                            tmp___27);
                    tmp___29 = strlen((char const   *)p);
                    *(o.mailbox + tmp___29) = (char )'\000';
                  }
                  f.mbox = (unsigned char)1;
                }
              } else {
                if (! f.send_email) {
                  p = & buf[11];
                  f.send_email = (unsigned char)1;
                  tmp___20 = strlen((char const   *)p);
                  tmp___21 = s_malloc((unsigned long )((tmp___20 + 1U) * sizeof(char )));
                  o.email_address = (char *)tmp___21;
                  tmp___22 = strlen((char const   *)p);
                  tmp___23 = chomp(p);
                  strncpy((char * __restrict  )o.email_address, (char const   * __restrict  )tmp___23,
                          tmp___22);
                  tmp___24 = strlen((char const   *)p);
                  *(o.email_address + tmp___24) = (char )'\000';
                }
              }
            } else {
              if (! f.ip_list) {
                p = & buf[7];
                if (f.ip_range) {
                  fatal((char *)"IPLIST and IPRANGE can\'t both be define in the config file\n");
                }
                f.ip_list = (unsigned char)1;
                tmp___15 = strlen((char const   *)p);
                tmp___16 = s_malloc((unsigned long )((tmp___15 + 1U) * sizeof(char ) + 1U));
                o.ip_list = (char *)tmp___16;
                tmp___17 = strlen((char const   *)p);
                tmp___18 = chomp(p);
                strncpy((char * __restrict  )o.ip_list, (char const   * __restrict  )tmp___18,
                        tmp___17);
                tmp___19 = strlen((char const   *)p);
                *(o.ip_list + tmp___19) = (char )'\000';
              }
            }
          } else {
            if (! f.threads) {
              p = & buf[8];
              tmp___14 = atoi((char const   *)p);
              o.number_of_threads = (unsigned short )tmp___14;
            }
          }
        } else {
          if (! f.output_html) {
            p = & buf[8];
            f.output_html = (unsigned char)1;
            tmp___9 = strlen((char const   *)p);
            tmp___10 = s_malloc((unsigned long )((tmp___9 + 1U) * sizeof(char )));
            o.html_file = (char *)tmp___10;
            tmp___11 = strlen((char const   *)p);
            tmp___12 = chomp(p);
            strncpy((char * __restrict  )o.html_file, (char const   * __restrict  )tmp___12,
                    tmp___11);
            tmp___13 = strlen((char const   *)p);
            *(o.html_file + tmp___13) = (char )'\000';
          }
        }
      } else {
        if (! f.config_file) {
          p = & buf[11];
          f.config_file = (unsigned char)1;
          tmp___4 = strlen((char const   *)p);
          tmp___5 = s_malloc((unsigned long )((tmp___4 + 1U) * sizeof(char )));
          o.config_file = (char *)tmp___5;
          tmp___6 = strlen((char const   *)p);
          tmp___7 = chomp(p);
          strncpy((char * __restrict  )o.config_file, (char const   * __restrict  )tmp___7,
                  tmp___6);
          tmp___8 = strlen((char const   *)p);
          *(o.config_file + tmp___8) = (char )'\000';
        }
      }
    } else {
      if (! f.ip_range) {
        p = & buf[8];
        f.ip_range = (unsigned char)1;
        tmp = strlen((char const   *)p);
        tmp___0 = s_malloc((unsigned long )((tmp + 1U) * sizeof(char )));
        o.ip_range = (char *)tmp___0;
        tmp___1 = strlen((char const   *)p);
        tmp___2 = chomp(p);
        strncpy((char * __restrict  )o.ip_range, (char const   * __restrict  )tmp___2,
                tmp___1);
        tmp___3 = strlen((char const   *)p);
        *(o.ip_range + tmp___3) = (char )'\000';
      }
    }
  }
  return (0);
}
}
#pragma merger(0,"/tmp/cil-yhUmpuTR.i","-Wall,-g,-pthread")
char *get_sender_address(char *string ) ;
int is_mbox_seperator(char *string ) ;
extern DIR *opendir(char const   *__name )  __attribute__((__nonnull__(1))) ;
extern int closedir(DIR *__dirp )  __attribute__((__nonnull__(1))) ;
extern struct dirent *readdir(DIR *__dirp )  __attribute__((__nonnull__(1))) ;
int parse_mbox(void) 
{ FILE *fd ;
  char buf[8193] ;
  char temp[8193] ;
  char *email_address ;
  int tmp ;
  int tmp___0 ;
  char *tmp___1 ;
  int tmp___2 ;
  char *tmp___3 ;

  {
  email_address = (char *)((void *)0);
  fd = fopen((char const   * __restrict  )o.mailbox, (char const   * __restrict  )"r");
  if ((unsigned int )fd == (unsigned int )((void *)0)) {
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Unable to open %s for reading\n",
            o.mailbox);
    exit(1);
  }
  while (1) {
    tmp___3 = fgets((char * __restrict  )(buf), 8192, (FILE * __restrict  )fd);
    if (! ((unsigned int )tmp___3 != (unsigned int )((void *)0))) {
      break;
    }
    START: 
    strncpy((char * __restrict  )(temp), (char const   * __restrict  )(buf), 8192U);
    temp[8192] = (char )'\000';
    tmp___2 = is_mbox_seperator(temp);
    if (tmp___2) {
      strncpy((char * __restrict  )(temp), (char const   * __restrict  )(buf), 8192U);
      temp[8192] = (char )'\000';
      email_address = get_sender_address(temp);
      if ((unsigned int )email_address == (unsigned int )((void *)0)) {
        continue;
      }
      while (1) {
        tmp___1 = fgets((char * __restrict  )(buf), 8192, (FILE * __restrict  )fd);
        if (! ((unsigned int )tmp___1 != (unsigned int )((void *)0))) {
          break;
        }
        tmp = strncmp((char const   *)(buf), ":SmtpRCKey:", 11U);
        if (! tmp) {
          check_mail_file(email_address, buf);
        }
        strncpy((char * __restrict  )(temp), (char const   * __restrict  )(buf), 8192U);
        temp[8192] = (char )'\000';
        tmp___0 = is_mbox_seperator(temp);
        if (tmp___0) {
          goto START;
        }
      }
    }
  }
  fclose(fd);
  return (0);
}
}
int parse_maildir(void) 
{ DIR *dip ;
  FILE *fd ;
  struct dirent *dit ;
  char dir[8193] ;
  char buf[8193] ;
  char temp[8193] ;
  char filename[8193] ;
  char *email_address ;
  size_t tmp ;
  size_t tmp___0 ;
  int tmp___1 ;
  int tmp___2 ;
  char *tmp___3 ;
  int tmp___4 ;

  {
  email_address = (char *)((void *)0);
  tmp = strlen((char const   *)o.mailbox);
  if ((int )*(o.mailbox + tmp) == 47) {
    snprintf((char * __restrict  )(dir), 8192U, (char const   * __restrict  )"%snew",
             o.mailbox);
  } else {
    snprintf((char * __restrict  )(dir), 8192U, (char const   * __restrict  )"%s/new",
             o.mailbox);
  }
  dir[8192] = (char )'\000';
  dip = opendir((char const   *)(dir));
  if ((unsigned int )dip == (unsigned int )((void *)0)) {
    perror("opendir");
    fatal((char *)"error opening maildir folder (%s)", dir);
  }
  while (1) {
    dit = readdir(dip);
    if (! ((unsigned int )dit != (unsigned int )((void *)0))) {
      break;
    }
    if ((int )dit->d_name[0] == 46) {
      tmp___0 = strlen((char const   *)(dit->d_name));
      if (tmp___0 < 3U) {
        continue;
      }
    }
    snprintf((char * __restrict  )(filename), 8192U, (char const   * __restrict  )"%s/%s",
             dir, dit->d_name);
    filename[8192] = (char )'\000';
    fd = fopen((char const   * __restrict  )(filename), (char const   * __restrict  )"r");
    if ((unsigned int )fd == (unsigned int )((void *)0)) {
      fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Unable to open mailfile (%s) for reading... Skipping\n",
              filename);
      continue;
    }
    while (1) {
      tmp___3 = fgets((char * __restrict  )(buf), 8192, (FILE * __restrict  )fd);
      if (! ((unsigned int )tmp___3 != (unsigned int )((void *)0))) {
        break;
      }
      tmp___1 = strncmp((char const   *)(buf), "From: ", 6U);
      if (! tmp___1) {
        strncpy((char * __restrict  )(temp), (char const   * __restrict  )(buf), 8192U);
        temp[8192] = (char )'\000';
        email_address = get_sender_address(temp);
        if ((unsigned int )email_address == (unsigned int )((void *)0)) {
          continue;
        }
      }
      tmp___2 = strncmp((char const   *)(buf), ":SmtpRCKey:", 11U);
      if (! tmp___2) {
        check_mail_file(email_address, buf);
      }
    }
  }
  tmp___4 = closedir(dip);
  if (tmp___4 == -1) {
    perror("closedir");
    return (0);
  }
  return (0);
}
}
int parse_popbox(void) 
{ 

  {
  return (0);
}
}
int is_mbox_seperator(char *string ) 
{ char tmp[9][8193] ;
  int count ;
  char *word ;
  int tmp___0 ;

  {
  count = 0;
  tmp___0 = strncmp((char const   *)string, "From ", 5U);
  if (tmp___0) {
    return (0);
  } else {
    word = strtok((char * __restrict  )string, (char const   * __restrict  )" ");
    while (word) {
      count ++;
      if (count < 8) {
        strncpy((char * __restrict  )(tmp[count]), (char const   * __restrict  )word,
                8191U);
      }
      word = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )" ");
    }
    if (count == 7) {
      return (1);
    } else {
      return (0);
    }
  }
}
}
char *get_sender_address(char *string ) 
{ int count ;
  char *word ;
  char *address ;
  size_t tmp ;
  void *tmp___0 ;
  size_t tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;

  {
  count = 0;
  address = (char *)((void *)0);
  word = strtok((char * __restrict  )string, (char const   * __restrict  )" ");
  while (word) {
    count ++;
    if (count == 2) {
      tmp___3 = strlen((char const   *)word);
      if (tmp___3 > 5U) {
        tmp = strlen((char const   *)word);
        tmp___0 = s_malloc((unsigned long )((tmp + 1U) * sizeof(char )));
        address = (char *)tmp___0;
        tmp___1 = strlen((char const   *)word);
        strncpy((char * __restrict  )address, (char const   * __restrict  )word, tmp___1 + 2U);
        tmp___2 = strlen((char const   *)word);
        *(address + (tmp___2 + 1U)) = (char )'\000';
        break;
      }
    }
    word = strtok((char * __restrict  )((void *)0), (char const   * __restrict  )" ");
  }
  if ((unsigned int )address != (unsigned int )((void *)0)) {
    return (address);
  } else {
    return ((char *)((void *)0));
  }
}
}
#pragma merger(0,"/tmp/cil-kzMrYIFm.i","-Wall,-g,-pthread")
extern int usleep(__useconds_t __useconds ) ;
int thread_start(long cur_host ) ;
int cleaner_start(void) ;
extern int nanosleep(struct timespec  const  *__requested_time , struct timespec *__remaining ) ;
extern  __attribute__((__nothrow__)) int pthread_create(pthread_t * __restrict  __newthread ,
                                                        pthread_attr_t const   * __restrict  __attr ,
                                                        void *(*__start_routine)(void * ) ,
                                                        void * __restrict  __arg )  __attribute__((__nonnull__(1,3))) ;
extern int pthread_join(pthread_t __th , void **__thread_return ) ;
extern  __attribute__((__nothrow__)) pthread_t pthread_self(void)  __attribute__((__const__)) ;
extern  __attribute__((__nothrow__)) int pthread_attr_init(pthread_attr_t *__attr )  __attribute__((__nonnull__(1))) ;
extern  __attribute__((__nothrow__)) int pthread_attr_getstacksize(pthread_attr_t const   * __restrict  __attr ,
                                                                   size_t * __restrict  __stacksize )  __attribute__((__nonnull__(1,2))) ;
extern  __attribute__((__nothrow__)) int pthread_attr_setstacksize(pthread_attr_t *__attr ,
                                                                   size_t __stacksize )  __attribute__((__nonnull__(1))) ;
extern  __attribute__((__nothrow__)) int pthread_mutex_init(pthread_mutex_t *__mutex ,
                                                            pthread_mutexattr_t const   *__mutexattr )  __attribute__((__nonnull__(1))) ;
extern  __attribute__((__nothrow__)) int pthread_mutex_lock(pthread_mutex_t *__mutex )  __attribute__((__nonnull__(1))) ;
extern  __attribute__((__nothrow__)) int pthread_mutex_unlock(pthread_mutex_t *__mutex )  __attribute__((__nonnull__(1))) ;
int relay_check(int *sockfd , long cur_host ) ;
pthread_mutex_t main_thread_count_mutex  ;
void start_scan(void) 
{ struct timespec tv ;
  pthread_t c_tid ;
  pthread_attr_t attr ;
  unsigned char flag ;
  unsigned char res ;
  int x ;
  int ret ;
  size_t stack_size ;
  void *tmp ;
  int tmp___0 ;
  int tmp___1 ;

  {
  flag = (unsigned char)0;
  res = (unsigned char)0;
  x = 0;
  ret = 0;
  tv.tv_sec = 0L;
  tv.tv_nsec = 500000000L;
  pthread_mutex_init(& main_thread_count_mutex, (pthread_mutexattr_t const   *)((void *)0));
  ret = pthread_attr_getstacksize((pthread_attr_t const   * __restrict  )(& attr),
                                  (size_t * __restrict  )(& stack_size));
  if (ret != 0) {
    fatal((char *)"cannot get stacksize");
  }
  debug((char *)"\n\nstack size: %d\n", stack_size);
  stack_size = 28672U;
  ret = pthread_attr_init(& attr);
  ret = pthread_attr_setstacksize(& attr, stack_size);
  if (ret != 0) {
    fatal((char *)"cannot setting stacksize");
  }
  ret = pthread_attr_getstacksize((pthread_attr_t const   * __restrict  )(& attr),
                                  (size_t * __restrict  )(& stack_size));
  if (ret != 0) {
    fatal((char *)"cannot get stacksize");
  }
  debug((char *)"\n\nstack size: %d\n", stack_size);
  tmp = s_malloc((o.no_hostnames + 1UL) * (unsigned long )sizeof(pthread_t ));
  o.tid = (pthread_t *)tmp;
  x = 0;
  while ((unsigned long )x < o.no_hostnames) {
    *(o.tid + x) = 0UL;
    x ++;
  }
  tmp___0 = pthread_create((pthread_t * __restrict  )(& c_tid), (pthread_attr_t const   * __restrict  )(& attr),
                           (void *(*)(void * ))((void *)(& cleaner_start)), (void * __restrict  )((void *)0));
  if (tmp___0 != 0) {
    fatal((char *)"Unable to start cleaner thread");
    perror("aa");
  }
  o.cur_host = 0UL;
  while (o.cur_host < o.no_hostnames) {
    pthread_mutex_lock(& main_thread_count_mutex);
    while ((int )o.cur_threads >= (int )o.number_of_threads) {
      pthread_mutex_unlock(& main_thread_count_mutex);
      debug((char *)"Sleeping cur child == %d, max child == %d\n", o.cur_threads,
            o.number_of_threads);
      nanosleep((struct timespec  const  *)(& tv), (struct timespec *)((void *)0));
    }
    pthread_mutex_unlock(& main_thread_count_mutex);
    while (1) {
      tmp___1 = pthread_create((pthread_t * __restrict  )(& c_tid), (pthread_attr_t const   * __restrict  )(& attr),
                               (void *(*)(void * ))((void *)(& thread_start)), (void * __restrict  )((int *)o.cur_host));
      res = (unsigned char )tmp___1;
      if (! ((int )res != 0)) {
        break;
      }
      if ((int )res != 11) {
        fatal((char *)"Unable to create thread - (try reducing the number of threads)\n");
      }
      if (! flag) {
        error((char *)"** Failed to create thread!!\nTrying to use sleep to compensate.... although you should run this again with a lower value for -p\n\n");
        flag = (unsigned char )((int )flag + 1);
      }
      usleep(200000U);
    }
    debug((char *)"Created thread\n");
    pthread_mutex_lock(& main_thread_count_mutex);
    o.cur_threads = (unsigned short )((int )o.cur_threads + 1);
    pthread_mutex_unlock(& main_thread_count_mutex);
    (o.cur_host) ++;
  }
  flag = (unsigned char)0;
  pthread_mutex_lock(& main_thread_count_mutex);
  while ((int )o.cur_threads > 0) {
    pthread_mutex_unlock(& main_thread_count_mutex);
    flag = (unsigned char )((int )flag + 1);
    if (f.debug) {
      goto _L;
    } else {
      if ((int )f.verbose > 1) {
        _L: /* CIL Label */ 
        if ((int )flag > 1) {
          fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"O.cur_childs(%d) id greater than zero...... sleepingz\n",
                  o.cur_threads);
          flag = (unsigned char)0;
        }
      }
    }
    nanosleep((struct timespec  const  *)(& tv), (struct timespec *)((void *)0));
  }
  pthread_mutex_unlock(& main_thread_count_mutex);
  return;
}
}
int cleaner_start(void) 
{ int x ;
  int tmp ;

  {
  x = 0;
  while (1) {
    x = 0;
    while ((unsigned long )x < o.no_hostnames) {
      if ((int )*(o.tid + x)) {
        tmp = pthread_join(*(o.tid + x), (void **)((void *)0));
        if (! tmp) {
          pthread_mutex_lock(& main_thread_count_mutex);
          o.cur_threads = (unsigned short )((int )o.cur_threads - 1);
          pthread_mutex_unlock(& main_thread_count_mutex);
          *(o.tid + x) = 0UL;
        }
      }
      x ++;
    }
    usleep(200000U);
  }
  return (0);
}
}
int thread_start(long cur_host ) 
{ int sockfd ;
  int counter ;
  int x ;
  int res ;
  long ip ;
  char hostnamer[8193] ;
  char *tmp ;
  size_t tmp___0 ;
  void *tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  size_t tmp___4 ;
  int tmp___5 ;
  void *tmp___6 ;
  void *tmp___7 ;

  {
  counter = 0;
  x = 0;
  res = 0;
  debug((char *)"Starting thread_start process\n");
  debug((char *)"hostname == %s o.cur_host == %d\n", (*(hosts + cur_host))->ip_address,
        (int )cur_host);
  ip = get_ip((*(hosts + cur_host))->ip_address);
  if (ip == -1L) {
    debug((char *)"Couldn\'t resolve ip\n");
    *(o.tid + cur_host) = pthread_self();
    return ((int )((void *)0));
  }
  sockfd = tcp_connect(ip);
  if (sockfd != -1) {
    counter ++;
    if (f.resolve_hostnames) {
      tmp = get_hostname((char const   *)(*(hosts + cur_host))->ip_address);
      strncpy((char * __restrict  )(hostnamer), (char const   * __restrict  )tmp,
              8192U);
      hostnamer[8192] = (char )'\000';
      tmp___4 = strlen((char const   *)(*(hosts + cur_host))->ip_address);
      tmp___5 = strncmp((char const   *)(*(hosts + cur_host))->ip_address, (char const   *)(hostnamer),
                        tmp___4);
      if (tmp___5) {
        tmp___0 = strlen((char const   *)(hostnamer));
        tmp___1 = s_malloc((unsigned long )((tmp___0 + 1U) * sizeof(char )));
        (*(hosts + cur_host))->hostname = (char *)tmp___1;
        tmp___2 = strlen((char const   *)(hostnamer));
        strncpy((char * __restrict  )(*(hosts + cur_host))->hostname, (char const   * __restrict  )(hostnamer),
                tmp___2);
        tmp___3 = strlen((char const   *)(hostnamer));
        *((*(hosts + cur_host))->hostname + tmp___3) = (char )'\000';
        (*(hosts + cur_host))->resolved = (unsigned char)1;
      }
    }
    (*(hosts + cur_host))->smtp_open = (unsigned char)1;
    tmp___6 = s_malloc((unsigned long )((unsigned int )((int )o.no_rules + 1) * sizeof(check **)));
    (*(hosts + cur_host))->smtp_check = (check **)tmp___6;
    x = 0;
    while (x <= (int )o.no_rules) {
      tmp___7 = s_malloc((unsigned long )sizeof(check ));
      *((*(hosts + cur_host))->smtp_check + x) = (check *)tmp___7;
      (*((*(hosts + cur_host))->smtp_check + x))->failed = (unsigned char)0;
      (*((*(hosts + cur_host))->smtp_check + x))->passed = (unsigned char)0;
      (*((*(hosts + cur_host))->smtp_check + x))->error_code = (unsigned char)0;
      x ++;
    }
    res = relay_check(& sockfd, cur_host);
    if (res == -1) {
      close(sockfd);
    }
    close(sockfd);
  } else {
    close(sockfd);
  }
  *(o.tid + cur_host) = pthread_self();
  return ((int )((void *)0));
}
}
/* compiler builtin: 
   void __builtin_va_end(__builtin_va_list  ) ;  */
/* compiler builtin: 
   void __builtin_va_start(__builtin_va_list  ) ;  */
#pragma merger(0,"/tmp/cil-5Ceo1BbJ.i","-Wall,-g,-pthread")
extern struct _IO_FILE *stdout ;
extern int fflush(FILE *__stream ) ;
extern int vfprintf(FILE * __restrict  __s , char const   * __restrict  __format ,
                    __gnuc_va_list __arg ) ;
extern  __attribute__((__nothrow__)) void *malloc(size_t __size )  __attribute__((__malloc__)) ;
extern  __attribute__((__nothrow__)) void *calloc(size_t __nmemb , size_t __size )  __attribute__((__malloc__)) ;
void *s_zmalloc(int size ) ;
void swap_macro(char *string , char const   *replace , char const   *macro ) ;
void convert_rule(char *string , int ind ) ;
int check_file_path(char *filename , char *path ) ;
void return_data(long cur_host , int rule___0 , char *string ) ;
void not_implemented(void) ;
void *s_malloc(unsigned long size ) 
{ void *mymem ;

  {
  if (size < 0UL) {
    fatal((char *)"Tried to allocate a negative amount of memory!!");
  }
  mymem = malloc((unsigned int )size);
  if ((unsigned int )mymem == (unsigned int )((void *)0)) {
    fatal((char *)"Malloc failed! Probably out of memory!!");
  }
  return (mymem);
}
}
void *s_zmalloc(int size ) 
{ void *mymem ;

  {
  if (size < 0) {
    fatal((char *)"Tried to allocate a negative amount of memory!!");
  }
  mymem = calloc(1U, (unsigned int )size);
  if ((unsigned int )mymem == (unsigned int )((void *)0)) {
    fatal((char *)"Malloc failed! Probably out of memory!!");
  }
  return (mymem);
}
}
char *chomp(char *string ) 
{ int len ;
  size_t tmp ;

  {
  tmp = strlen((char const   *)string);
  len = (int )tmp;
  if (len < 1) {
    return (string);
  }
  if ((int )*(string + (len - 1)) != 10) {
    if ((int )*(string + (len - 1)) != 13) {
      return (string);
    }
  }
  if (len > 1) {
    if ((int )*(string + (len - 2)) == 13) {
      *(string + (len - 2)) = (char )'\000';
    } else {
      *(string + (len - 1)) = (char )'\000';
    }
  } else {
    *(string + (len - 1)) = (char )'\000';
  }
  return (string);
}
}
void swap_rule(char *dest , char const   *rule___0 , int hostn ) 
{ char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  char *tmp___2 ;
  char *tmp___3 ;

  {
  strncpy((char * __restrict  )dest, (char const   * __restrict  )rule___0, 8192U);
  *(dest + 8192) = (char )'\000';
  tmp = strstr(rule___0, "--NAME--");
  if ((unsigned int )tmp != (unsigned int )((void *)0)) {
    swap_macro(dest, (char const   *)o.name, "--NAME--");
  }
  tmp___0 = strstr(rule___0, "--DOMAIN--");
  if ((unsigned int )tmp___0 != (unsigned int )((void *)0)) {
    swap_macro(dest, (char const   *)o.domain, "--DOMAIN--");
  }
  tmp___1 = strstr(rule___0, "--IP_ADDRESS--");
  if ((unsigned int )tmp___1 != (unsigned int )((void *)0)) {
    swap_macro(dest, (char const   *)(*(hosts + hostn))->ip_address, "--IP_ADDRESS--");
  }
  tmp___3 = strstr(rule___0, "--HOSTNAME--");
  if ((unsigned int )tmp___3 != (unsigned int )((void *)0)) {
    if (f.resolve_hostnames) {
      if ((*(hosts + hostn))->resolved) {
        swap_macro(dest, (char const   *)(*(hosts + hostn))->hostname, "--HOSTNAME--");
      } else {
        goto _L___0;
      }
    } else {
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ 
    tmp___2 = strstr(rule___0, "--HOSTNAME--");
    if ((unsigned int )tmp___2 != (unsigned int )((void *)0)) {
      if (f.resolve_hostnames) {
        swap_macro(dest, (char const   *)(*(hosts + hostn))->ip_address, "--HOSTNAME--");
      }
    }
  }
  return;
}
}
void swap_macro(char *string , char const   *replace , char const   *macro ) 
{ char *p ;
  char *buf ;
  void *tmp ;
  size_t tmp___0 ;

  {
  tmp = s_malloc((unsigned long )(8193U * sizeof(char )));
  buf = (char *)tmp;
  while (1) {
    p = strstr((char const   *)string, macro);
    if (! ((unsigned int )p != (unsigned int )((void *)0))) {
      break;
    }
    memcpy((void * __restrict  )buf, (void const   * __restrict  )string, (unsigned int )(p - string));
    *(buf + (p - string)) = (char )'\000';
    tmp___0 = strlen(macro);
    p += tmp___0;
    strncat((char * __restrict  )buf, (char const   * __restrict  )replace, 8192U);
    strncat((char * __restrict  )buf, (char const   * __restrict  )p, 8192U);
    *(buf + 8192) = (char )'\000';
    strncpy((char * __restrict  )string, (char const   * __restrict  )buf, 8192U);
    *(string + 8192) = (char )'\000';
  }
  free((void *)buf);
  return;
}
}
void convert_rule(char *string , int ind ) 
{ char *buf ;
  void *tmp ;

  {
  tmp = s_malloc((unsigned long )(8193U * sizeof(char )));
  buf = (char *)tmp;
  if (ind == 1) {
    snprintf((char * __restrict  )buf, 8192U, (char const   * __restrict  )"HELO %s\r\n",
             string);
    strncpy((char * __restrict  )string, (char const   * __restrict  )buf, 8192U);
    *(string + 8192) = (char )'\000';
  } else {
    if (ind == 2) {
      snprintf((char * __restrict  )buf, 8192U, (char const   * __restrict  )"MAIL FROM:%s\r\n",
               string);
      strncpy((char * __restrict  )string, (char const   * __restrict  )buf, 8192U);
      *(string + 8192) = (char )'\000';
    } else {
      if (ind == 3) {
        snprintf((char * __restrict  )buf, 8192U, (char const   * __restrict  )"RCPT TO:%s\r\n",
                 string);
        strncpy((char * __restrict  )string, (char const   * __restrict  )buf, 8192U);
        *(string + 8192) = (char )'\000';
      }
    }
  }
  return;
}
}
void debug(char *fmt  , ...) 
{ va_list ap ;

  {
  if (f.debug) {
    __builtin_va_start(ap, fmt);
    fflush(stdout);
    fprintf((FILE * __restrict  )stdout, (char const   * __restrict  )"DEBUG: ");
    vfprintf((FILE * __restrict  )stderr, (char const   * __restrict  )fmt, ap);
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n");
    __builtin_va_end(ap);
  }
  return;
}
}
int check_file_path(char *filename , char *path ) 
{ char *s ;
  char *p ;
  int slash_flag ;
  char *fn ;
  FILE *fd ;
  size_t tmp ;
  void *tmp___0 ;
  size_t tmp___1 ;
  size_t tmp___2 ;
  char *tmp___3 ;
  size_t tmp___4 ;
  void *tmp___5 ;
  size_t tmp___6 ;
  size_t tmp___7 ;

  {
  slash_flag = 0;
  fd = fopen((char const   * __restrict  )filename, (char const   * __restrict  )"w");
  if ((unsigned int )fd == (unsigned int )((void *)0)) {
    return (-1);
  }
  fclose(fd);
  tmp = strlen((char const   *)filename);
  tmp___0 = s_malloc((unsigned long )((tmp + 1U) * sizeof(char )));
  fn = (char *)tmp___0;
  tmp___1 = strlen((char const   *)filename);
  strncpy((char * __restrict  )fn, (char const   * __restrict  )filename, tmp___1);
  tmp___2 = strlen((char const   *)filename);
  *(fn + tmp___2) = (char )'\000';
  s = fn;
  while (1) {
    tmp___3 = s;
    s ++;
    if (! *tmp___3) {
      break;
    }
    if ((int )*s == 47) {
      p = s;
      slash_flag = 1;
    }
  }
  p ++;
  *p = (char )'\000';
  if (! slash_flag) {
    tmp___4 = strlen("./");
    tmp___5 = s_malloc((unsigned long )((tmp___4 + 2U) * sizeof(char )));
    path = (char *)tmp___5;
    tmp___6 = strlen("./");
    strncpy((char * __restrict  )path, (char const   * __restrict  )"./", tmp___6);
    tmp___7 = strlen("./");
    *(path + tmp___7) = (char )'\000';
  } else {
    strncpy((char * __restrict  )path, (char const   * __restrict  )fn, 8192U);
    *(path + 8192) = (char )'\000';
  }
  free((void *)fn);
  return (0);
}
}
void return_data(long cur_host , int rule___0 , char *string ) 
{ char *buf ;
  void *tmp ;

  {
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  snprintf((char * __restrict  )buf, 8192U, (char const   * __restrict  )"Subject: %s\r\n%s\r\n\r\n:SmtpRCKey:%d:%s:%d:\r\n\r\n.\r\n",
           o.email_subject, o.email, (int )o.time, (*(hosts + cur_host))->ip_address,
           rule___0);
  strncpy((char * __restrict  )string, (char const   * __restrict  )buf, 8192U);
  *(string + 8192) = (char )'\000';
  return;
}
}
void set_defaults(void) 
{ size_t tmp ;
  void *tmp___0 ;
  size_t tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  void *tmp___4 ;
  size_t tmp___5 ;
  size_t tmp___6 ;

  {
  o.number_of_threads = (unsigned short)1000;
  o.c_timeout = (unsigned short)10;
  o.r_timeout = (unsigned short)60;
  o.m_timeout = (unsigned short)60;
  tmp = strlen("/usr/local/etc/smtprc/rcheck.conf");
  tmp___0 = s_malloc((unsigned long )((tmp + 1U) * sizeof(char )));
  o.config_file = (char *)tmp___0;
  tmp___1 = strlen("/usr/local/etc/smtprc/rcheck.conf");
  strncpy((char * __restrict  )o.config_file, (char const   * __restrict  )"/usr/local/etc/smtprc/rcheck.conf",
          tmp___1);
  tmp___2 = strlen("/usr/local/etc/smtprc/rcheck.conf");
  *(o.config_file + tmp___2) = (char )'\000';
  f.config_file = (unsigned char)1;
  tmp___3 = strlen("/usr/local/etc/smtprc/email.tmpl");
  tmp___4 = s_malloc((unsigned long )((tmp___3 + 1U) * sizeof(char )));
  o.email_template = (char *)tmp___4;
  tmp___5 = strlen("/usr/local/etc/smtprc/email.tmpl");
  strncpy((char * __restrict  )o.email_template, (char const   * __restrict  )"/usr/local/etc/smtprc/email.tmpl",
          tmp___5);
  tmp___6 = strlen("/usr/local/etc/smtprc/email.tmpl");
  *(o.email_template + tmp___6) = (char )'\000';
  f.email_template = (unsigned char)1;
  return;
}
}
void not_implemented(void) 
{ 

  {
  fatal((char *)"Sorry, This function is not yet implemented");
  return;
}
}
#pragma merger(0,"/tmp/cil-VVVPpkmc.i","-Wall,-g,-pthread")
void print_html_header(FILE *fd , char *title ) ;
void print_html_footer(FILE *fd , long smtp_open___0 ) ;
void print_link(FILE *fd , char *link___0 , char *text , char *color ) ;
void print_check(FILE *fd , long x , int y , char *color ) ;
void print_errord_check(FILE *fd , long x , int y , char *color ) ;
void print_check_details(char *filename , long host___0 ) ;
void print_quit(FILE *fd , long x , int y , char *color ) ;
char *escape_html_chars(char *string , char *s ) ;
char *passed  =    (char *)"smtprc_passed.html";
char *errord  =    (char *)"smtprc_errord.html";
char *failed_file  ;
long smtp_open  =    0L;
void display_html(void) 
{ FILE *failed_fd ;
  FILE *passed_fd ;
  FILE *errord_fd ;
  char buf[8192] ;
  char *p ;
  char *s ;
  char *boo ;
  int failed ;
  int failed_count ;
  int passed_count ;
  int errord_count ;
  int count ;
  long x ;
  int y ;
  size_t tmp ;
  void *tmp___0 ;
  size_t tmp___1 ;
  size_t tmp___2 ;
  char *tmp___3 ;
  size_t tmp___4 ;
  void *tmp___5 ;
  size_t tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  void *tmp___9 ;
  size_t tmp___10 ;
  size_t tmp___11 ;

  {
  failed = 0;
  failed_count = 0;
  passed_count = 0;
  errord_count = 0;
  count = 0;
  x = 0L;
  y = 0;
  tmp = strlen((char const   *)o.html_file);
  tmp___0 = s_malloc((unsigned long )((tmp + 1U) * sizeof(char )));
  boo = (char *)tmp___0;
  tmp___1 = strlen((char const   *)o.html_file);
  strncpy((char * __restrict  )boo, (char const   * __restrict  )o.html_file, tmp___1);
  tmp___2 = strlen((char const   *)o.html_file);
  *(boo + tmp___2) = (char )'\000';
  p = boo;
  while (1) {
    tmp___3 = p;
    p ++;
    if (! *tmp___3) {
      break;
    }
    if ((int )*p == 47) {
      count ++;
      p ++;
      s = p;
    }
  }
  if (! count) {
    tmp___4 = strlen((char const   *)o.html_file);
    tmp___5 = s_malloc((unsigned long )((tmp___4 + 1U) * sizeof(char )));
    failed_file = (char *)tmp___5;
    tmp___6 = strlen((char const   *)o.html_file);
    strncpy((char * __restrict  )failed_file, (char const   * __restrict  )o.html_file,
            tmp___6);
    tmp___7 = strlen((char const   *)o.html_file);
    *(failed_file + tmp___7) = (char )'\000';
  } else {
    tmp___8 = strlen((char const   *)s);
    tmp___9 = s_malloc((unsigned long )((tmp___8 + 1U) * sizeof(char )));
    failed_file = (char *)tmp___9;
    tmp___10 = strlen((char const   *)s);
    strncpy((char * __restrict  )failed_file, (char const   * __restrict  )s, tmp___10);
    tmp___11 = strlen((char const   *)s);
    *(failed_file + tmp___11) = (char )'\000';
  }
  count = 0;
  failed_fd = fopen((char const   * __restrict  )o.html_file, (char const   * __restrict  )"w");
  if ((unsigned int )failed_fd == (unsigned int )((void *)0)) {
    fatal((char *)"Unable to open html file");
  }
  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s",
           o.html_path, passed);
  passed_fd = fopen((char const   * __restrict  )(buf), (char const   * __restrict  )"w");
  if ((unsigned int )passed_fd == (unsigned int )((void *)0)) {
    fatal((char *)"Unable to open html file");
  }
  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s",
           o.html_path, errord);
  errord_fd = fopen((char const   * __restrict  )(buf), (char const   * __restrict  )"w");
  if ((unsigned int )errord_fd == (unsigned int )((void *)0)) {
    fatal((char *)"Unable to open html file");
  }
  print_html_header(failed_fd, (char *)"SMTP Relay Checker");
  print_html_header(passed_fd, (char *)"SMTP Relay Checker");
  print_html_header(errord_fd, (char *)"SMTP Relay Checker");
  fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"<font size=\"1\">Scans marked in <font color=\"orange\">Orange</font> are suspected open relays</font><br />\n");
  fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"<font size=\"1\">Scans marked in <font color=\"red\">Red</font> are definite open relays</font><br /><br /><br /><br />\n");
  fprintf((FILE * __restrict  )passed_fd, (char const   * __restrict  )"<font size=\"1\">Scans marked in <font color=\"blue\">Blue</font> are not open relays and have passed all tests</font><br /><br /><br /><br />\n");
  fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<font size=\"1\">Scans marked in <font color=\"black\">Black</font> Closed the connection after it was established (Probably due to a firewall)</font><br />\n");
  fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<font size=\"1\">Scans marked in <font color=\"darkblue\">Dark Blue</font> Had restrictions in place to disallow access</font><br />\n");
  fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<font size=\"1\">Scans marked in <font color=\"green\">Green</font> Produced Read Timeouts</font><br />\n");
  fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<font size=\"1\">Scans marked in <font color=\"purple\">Purple</font> Produced Unknown Errors</font><br /><br /><br /><br />\n");
  fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"<table align=\"center\" border=\"0\" cellspacing=\"10\"><tr>\n");
  fprintf((FILE * __restrict  )passed_fd, (char const   * __restrict  )"<table align=\"center\" border=\"0\" cellspacing=\"10\"><tr>\n");
  fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<table align=\"center\" border=\"0\" cellspacing=\"10\"><tr>\n");
  x = 0L;
  while ((unsigned long )x < o.no_hostnames) {
    if ((*(hosts + x))->smtp_open) {
      smtp_open ++;
    }
    x ++;
  }
  x = 0L;
  while ((unsigned long )x < o.no_hostnames) {
    if ((*(hosts + x))->smtp_open) {
      y = 0;
      while (y <= (int )o.no_rules) {
        if ((int )(*((*(hosts + x))->smtp_check + y))->failed == 1) {
          if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
            if (failed < 1) {
              failed = 1;
            }
          }
        }
        if ((int )(*((*(hosts + x))->smtp_check + y))->failed == 2) {
          if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
            if (failed < 2) {
              failed = 2;
            }
          }
        }
        y ++;
      }
      if (failed) {
        if (failed == 1) {
          fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"<td>");
          failed_count ++;
          if ((*(hosts + x))->resolved) {
            snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                     (*(hosts + x))->hostname);
            print_link(failed_fd, buf, (*(hosts + x))->hostname, (char *)"orange");
            snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                     o.html_path, (*(hosts + x))->hostname);
          } else {
            snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                     (*(hosts + x))->ip_address);
            print_link(failed_fd, buf, (*(hosts + x))->ip_address, (char *)"orange");
            snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                     o.html_path, (*(hosts + x))->ip_address);
          }
          fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"</td>");
          if (failed_count % 5 == 0) {
            fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"</tr><tr>\n");
          }
        } else {
          if (failed == 2) {
            failed_count ++;
            fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"<td>");
            if ((*(hosts + x))->resolved) {
              snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                       (*(hosts + x))->hostname);
              print_link(failed_fd, buf, (*(hosts + x))->hostname, (char *)"red");
              snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                       o.html_path, (*(hosts + x))->hostname);
            } else {
              snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                       (*(hosts + x))->ip_address);
              print_link(failed_fd, buf, (*(hosts + x))->ip_address, (char *)"red");
              snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                       o.html_path, (*(hosts + x))->ip_address);
            }
            fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"</td>");
            if (failed_count % 5 == 0) {
              fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"</tr><tr>\n");
            }
          }
        }
      } else {
        if ((*(hosts + x))->fatal_error) {
          if ((int )(*(hosts + x))->fatal < 2) {
            if ((int )(*((*(hosts + x))->smtp_check + 0))->error_code == 1) {
              errord_count ++;
              fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<td>");
              if ((*(hosts + x))->resolved) {
                snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                         (*(hosts + x))->hostname);
                print_link(errord_fd, buf, (*(hosts + x))->hostname, (char *)"black");
                snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                         o.html_path, (*(hosts + x))->hostname);
              } else {
                snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                         (*(hosts + x))->ip_address);
                print_link(errord_fd, buf, (*(hosts + x))->ip_address, (char *)"black");
                snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                         o.html_path, (*(hosts + x))->ip_address);
              }
              fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</td>");
              if (errord_count % 5 == 0) {
                fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</tr><tr>\n");
              }
            } else {
              goto _L___2;
            }
          } else {
            goto _L___2;
          }
        } else {
          _L___2: /* CIL Label */ 
          if ((*(hosts + x))->fatal_error) {
            if ((int )(*(hosts + x))->fatal < 2) {
              if ((int )(*((*(hosts + x))->smtp_check + 0))->error_code == 2) {
                errord_count ++;
                fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<td>");
                if ((*(hosts + x))->resolved) {
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                           (*(hosts + x))->hostname);
                  print_link(errord_fd, buf, (*(hosts + x))->hostname, (char *)"darkblue");
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                           o.html_path, (*(hosts + x))->hostname);
                } else {
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                           (*(hosts + x))->ip_address);
                  print_link(errord_fd, buf, (*(hosts + x))->ip_address, (char *)"darkblue");
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                           o.html_path, (*(hosts + x))->ip_address);
                }
                fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</td>");
                if (errord_count % 5 == 0) {
                  fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</tr><tr>\n");
                }
              } else {
                goto _L___0;
              }
            } else {
              goto _L___0;
            }
          } else {
            _L___0: /* CIL Label */ 
            if ((int )(*(hosts + x))->fatal_error == 3) {
              errord_count ++;
              fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<td>");
              if ((*(hosts + x))->resolved) {
                snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                         (*(hosts + x))->hostname);
                print_link(errord_fd, buf, (*(hosts + x))->hostname, (char *)"green");
                snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                         o.html_path, (*(hosts + x))->hostname);
              } else {
                snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                         (*(hosts + x))->ip_address);
                print_link(errord_fd, buf, (*(hosts + x))->ip_address, (char *)"green");
                snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                         o.html_path, (*(hosts + x))->ip_address);
              }
              fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</td>");
              if (errord_count % 5 == 0) {
                fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</tr><tr>\n");
              }
            } else {
              if ((*(hosts + x))->fatal_error) {
                errord_count ++;
                fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<td>");
                if ((*(hosts + x))->resolved) {
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                           (*(hosts + x))->hostname);
                  print_link(errord_fd, buf, (*(hosts + x))->hostname, (char *)"purple");
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                           o.html_path, (*(hosts + x))->hostname);
                } else {
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                           (*(hosts + x))->ip_address);
                  print_link(errord_fd, buf, (*(hosts + x))->ip_address, (char *)"purple");
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                           o.html_path, (*(hosts + x))->ip_address);
                }
                fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</td>");
                if (errord_count % 5 == 0) {
                  fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</tr><tr>\n");
                }
              } else {
                passed_count ++;
                fprintf((FILE * __restrict  )passed_fd, (char const   * __restrict  )"<td>");
                if ((*(hosts + x))->resolved) {
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                           (*(hosts + x))->hostname);
                  print_link(passed_fd, buf, (*(hosts + x))->hostname, (char *)"blue");
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                           o.html_path, (*(hosts + x))->hostname);
                } else {
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s.html",
                           (*(hosts + x))->ip_address);
                  print_link(passed_fd, buf, (*(hosts + x))->ip_address, (char *)"blue");
                  snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%s%s.html",
                           o.html_path, (*(hosts + x))->ip_address);
                }
                fprintf((FILE * __restrict  )passed_fd, (char const   * __restrict  )"</td>");
                if (passed_count % 5 == 0) {
                  fprintf((FILE * __restrict  )passed_fd, (char const   * __restrict  )"</tr><tr>\n");
                }
              }
            }
          }
        }
      }
      print_check_details(buf, x);
      failed = 0;
    }
    x ++;
  }
  fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"</tr></table>");
  fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"</tr></table>");
  fprintf((FILE * __restrict  )passed_fd, (char const   * __restrict  )"</tr></table>");
  if (! failed_count) {
    fprintf((FILE * __restrict  )failed_fd, (char const   * __restrict  )"<br /><br /><br /><center><font size=\"2\" color=\"black\"><b>No Open Relays Were Found</b></font></center><br /><br /><br />\n");
  }
  if (! passed_count) {
    fprintf((FILE * __restrict  )passed_fd, (char const   * __restrict  )"<br /><br /><br /><center><font size=\"2\" color=\"black\"><b>No Mail Servers Passed The Tests</b></font></center><br /><br /><br />\n");
  }
  if (! errord_count) {
    fprintf((FILE * __restrict  )errord_fd, (char const   * __restrict  )"<br /><br /><br /><center><font size=\"2\" color=\"black\"><b>No Errors Were Encountered While Scanning</b></font></center><br /><br /><br />\n");
  }
  print_html_footer(failed_fd, smtp_open);
  print_html_footer(errord_fd, smtp_open);
  print_html_footer(passed_fd, smtp_open);
  fclose(failed_fd);
  fclose(passed_fd);
  fclose(errord_fd);
  return;
}
}
void print_check_details(char *filename , long host___0 ) 
{ FILE *fd ;
  char color[8193] ;
  int y ;

  {
  y = 0;
  fd = fopen((char const   * __restrict  )filename, (char const   * __restrict  )"w");
  if ((unsigned int )fd == (unsigned int )((void *)0)) {
    fatal((char *)"Unable to open file: %s\n", filename);
  }
  print_html_header(fd, (char *)"SMTP Relay Checker");
  y = 0;
  while (y <= (int )o.no_rules) {
    if ((int )(*((*(hosts + host___0))->smtp_check + y))->failed == 1) {
      strncpy((char * __restrict  )(color), (char const   * __restrict  )"orange",
              8192U);
      color[8192] = (char )'\000';
    } else {
      if ((int )(*((*(hosts + host___0))->smtp_check + y))->failed == 2) {
        strncpy((char * __restrict  )(color), (char const   * __restrict  )"red",
                8192U);
        color[8192] = (char )'\000';
      } else {
        if ((*((*(hosts + host___0))->smtp_check + y))->passed) {
          strncpy((char * __restrict  )(color), (char const   * __restrict  )"blue",
                  8192U);
          color[8192] = (char )'\000';
        } else {
          strncpy((char * __restrict  )(color), (char const   * __restrict  )"purple",
                  8192U);
          color[8192] = (char )'\000';
        }
      }
    }
    if ((*(hosts + host___0))->fatal_error) {
      if (y <= (int )(*(hosts + host___0))->fatal) {
        if ((*((*(hosts + host___0))->smtp_check + y))->error_code) {
          if ((int )(*((*(hosts + host___0))->smtp_check + y))->error_code < 21) {
            print_errord_check(fd, host___0, y, (char *)"green");
          } else {
            goto _L;
          }
        } else {
          _L: /* CIL Label */ 
          if ((*((*(hosts + host___0))->smtp_check + y))->passed) {
            print_check(fd, host___0, y, color);
          } else {
            if ((*((*(hosts + host___0))->smtp_check + y))->failed) {
              print_check(fd, host___0, y, color);
            }
          }
        }
      }
    } else {
      print_check(fd, host___0, y, color);
    }
    y ++;
  }
  if ((int )(*((*(hosts + host___0))->smtp_check + o.no_rules))->error_code > 20) {
    if ((int )(*(hosts + host___0))->fatal == (int )o.no_rules) {
      print_quit(fd, host___0, (int )o.no_rules, (char *)"green");
    } else {
      goto _L___0;
    }
  } else {
    _L___0: /* CIL Label */ 
    if (! (*(hosts + host___0))->fatal_error) {
      print_quit(fd, host___0, (int )o.no_rules, (char *)"blue");
    }
  }
  print_html_footer(fd, smtp_open);
  fclose(fd);
  return;
}
}
void print_quit(FILE *fd , long x , int y , char *color ) 
{ 

  {
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n\n<br /><br /><table border=\"0\" cellspacing=\"1\"><font color=\"%s\"><br />\n",
          color);
  if ((*(hosts + x))->resolved) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td colspan=\"2\"><b>Quit sequence for %s [%s]</font></b><br /><br /></td></tr>\n",
            (*(hosts + x))->hostname, (*(hosts + x))->ip_address);
  } else {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td colspan=\"2\"><b>Quit sequence for [%s]</font></b><br /><br /></td></tr>\n",
            (*(hosts + x))->ip_address);
  }
  if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 21) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;A fatal error occured while trying to read/write</font><br /></td></tr>\n",
            color);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 22) {
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;A fatal error occured while trying to read/write</font><br /></td></tr>\n",
              color);
    }
  }
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">QUIT SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
          color, "QUIT\r\n");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">QUIT REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
          color, (*(hosts + x))->r_quit);
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"</table></font><br /><br /><br />\n\n");
  return;
}
}
void print_errord_check(FILE *fd , long x , int y , char *color ) 
{ char *p ;
  char *buf ;
  char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  char *tmp___2 ;
  char *tmp___3 ;
  char *tmp___4 ;
  char *tmp___5 ;
  char *tmp___6 ;
  char *tmp___7 ;
  char *tmp___8 ;
  char *tmp___9 ;
  char *tmp___10 ;
  void *tmp___11 ;
  char *tmp___12 ;
  char *tmp___13 ;
  char *tmp___14 ;
  char *tmp___15 ;

  {
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n\n<br /><br /><table border=\"0\" cellspacing=\"1\"><font color=\"%s\"><br />\n",
          color);
  if ((*(hosts + x))->resolved) {
    tmp = escape_html_chars((*(hosts + x))->ip_address, p);
    tmp___0 = escape_html_chars((*(hosts + x))->hostname, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td colspan=\"2\"><b>Results for %s [%s] check %d</font></b><br /><br /></td></tr>\n",
            tmp___0, tmp, y);
  } else {
    tmp___1 = escape_html_chars((*(hosts + x))->ip_address, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td colspan=\"2\"><b>Results for [%s] check %d</font></b><br /><br /></td></tr>\n",
            tmp___1, y);
  }
  if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 1) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;The server closed the connection.... probably due to a firewall</font><br /></td></tr>\n",
            color);
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    tmp___2 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->r_banner, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">BANNER:</font><font color=\"black\"></td>\n<td>&#9;%s</font><br /></td></tr>\n",
            color, tmp___2);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 1) {
      tmp___2 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->r_banner, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">BANNER:</font><font color=\"black\"></td>\n<td>&#9;%s</font><br /></td></tr>\n",
              color, tmp___2);
    }
  }
  if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 3) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write HELO</font><br /></td></tr>\n",
            color);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 4) {
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write HELO</font><br /></td></tr>\n",
              color);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    tmp___3 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->helo, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">HELO SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___3);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 4) {
      tmp___3 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->helo, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">HELO SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___3);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    tmp___4 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->r_helo, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">HELO REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___4);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 4) {
      tmp___4 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->r_helo, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">HELO REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___4);
    }
  }
  if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 6) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write MAIL FROM</font><br /></td></tr>\n",
            color);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 7) {
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write MAIL FROM</font><br /></td></tr>\n",
              color);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    tmp___5 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->mail_from, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">MAIL FROM SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___5);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 7) {
      tmp___5 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->mail_from,
                                  p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">MAIL FROM SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___5);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    tmp___6 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_mail_from,
                                p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">MAIL FROM REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___6);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 7) {
      tmp___6 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_mail_from,
                                  p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">MAIL FROM REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___6);
    }
  }
  if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 9) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write RCPT TO</font><br /></td></tr>\n",
            color);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 10) {
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write RCPT TO</font><br /></td></tr>\n",
              color);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    goto _L;
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 10) {
      _L: /* CIL Label */ 
      if ((int )(*((*(hosts + x))->smtp_check + y))->passed > 3) {
        tmp___7 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->rcpt_to,
                                    p);
        fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RCPT TO SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
                color, tmp___7);
      }
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    goto _L___0;
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 10) {
      _L___0: /* CIL Label */ 
      if ((int )(*((*(hosts + x))->smtp_check + y))->passed > 3) {
        tmp___8 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_rcpt_to,
                                    p);
        fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RCPT TO REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
                color, tmp___8);
      }
    }
  }
  if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 12) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write DATA</font><br /></td></tr>\n",
            color);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 13) {
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write DATA</font><br /></td></tr>\n",
              color);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    goto _L___1;
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 13) {
      _L___1: /* CIL Label */ 
      if ((int )(*((*(hosts + x))->smtp_check + y))->passed > 4) {
        tmp___9 = escape_html_chars((char *)"DATA\r\n", p);
        fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA START SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
                color, tmp___9);
      }
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    goto _L___2;
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 13) {
      _L___2: /* CIL Label */ 
      if ((int )(*((*(hosts + x))->smtp_check + y))->passed > 4) {
        tmp___10 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_data_start,
                                     p);
        fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA START REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
                color, tmp___10);
      }
    }
  }
  if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 15) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write DATA</font><br /></td></tr>\n",
            color);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 16) {
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write DATA</font><br /></td></tr>\n",
              color);
    }
  }
  tmp___11 = s_malloc((unsigned long )(8193U * sizeof(char )));
  buf = (char *)tmp___11;
  return_data(x, y, buf);
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    goto _L___3;
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 16) {
      _L___3: /* CIL Label */ 
      if ((int )(*((*(hosts + x))->smtp_check + y))->passed > 5) {
        tmp___12 = escape_html_chars(buf, p);
        fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA SENT:</font> &#9;<font color=\"black\"></td>\n<td><pre>%s</pre></font><br /></td></tr>\n",
                color, tmp___12);
      }
    }
  }
  free((void *)buf);
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    goto _L___4;
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 16) {
      _L___4: /* CIL Label */ 
      if ((int )(*((*(hosts + x))->smtp_check + y))->passed > 6) {
        tmp___13 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_data_end,
                                     p);
        fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
                color, tmp___13);
      }
    }
  }
  if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 18) {
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write RSET</font><br /></td></tr>\n",
            color);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code == 19) {
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">FATAL ERROR:</font><font color=\"black\"></td>\n<td>&#9;An fatal error occured while trying to read/write RSET</font><br /></td></tr>\n",
              color);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    tmp___14 = escape_html_chars((char *)"RSET\r\n", p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RESET SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___14);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 19) {
      tmp___14 = escape_html_chars((char *)"RSET\r\n", p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RESET SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___14);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->error_code) {
    tmp___15 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_reset, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RESET REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___15);
  } else {
    if ((int )(*((*(hosts + x))->smtp_check + y))->error_code > 19) {
      tmp___15 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_reset, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RESET REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___15);
    }
  }
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"</table></font><br /><br /><br />\n\n");
  return;
}
}
void print_check(FILE *fd , long x , int y , char *color ) 
{ int passed___0 ;
  char *p ;
  char *buf ;
  char *tmp ;
  char *tmp___0 ;
  char *tmp___1 ;
  char *tmp___2 ;
  char *tmp___3 ;
  char *tmp___4 ;
  char *tmp___5 ;
  char *tmp___6 ;
  char *tmp___7 ;
  char *tmp___8 ;
  char *tmp___9 ;
  char *tmp___10 ;
  void *tmp___11 ;
  char *tmp___12 ;
  char *tmp___13 ;
  char *tmp___14 ;
  char *tmp___15 ;

  {
  passed___0 = 0;
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n\n<br /><br /><table border=\"0\" cellspacing=\"1\"><font color=\"%s\"><br />\n",
          color);
  if ((*(hosts + x))->resolved) {
    tmp = escape_html_chars((*(hosts + x))->ip_address, p);
    tmp___0 = escape_html_chars((*(hosts + x))->hostname, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td colspan=\"2\"><b>Results for %s [%s] check %d</font></b><br /><br /></td></tr>\n",
            tmp___0, tmp, y);
  } else {
    tmp___1 = escape_html_chars((*(hosts + x))->ip_address, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td colspan=\"2\"><b>Results for [%s] check %d</font></b><br /><br /></td></tr>\n",
            tmp___1, y);
  }
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___2 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->r_banner, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">BANNER:</font><font color=\"black\"></td>\n<td>&#9;%s</font><br /></td></tr>\n",
            color, tmp___2);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___2 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->r_banner, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">BANNER:</font><font color=\"black\"></td>\n<td>&#9;%s</font><br /></td></tr>\n",
              color, tmp___2);
    }
  }
  passed___0 ++;
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___3 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->helo, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">HELO SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___3);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___3 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->helo, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">HELO SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___3);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___4 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->r_helo, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">HELO REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___4);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___4 = escape_html_chars((*((*(hosts + x))->smtp_check + 0))->r_helo, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">HELO REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___4);
    }
  }
  passed___0 ++;
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___5 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->mail_from, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">MAIL FROM SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___5);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___5 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->mail_from,
                                  p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">MAIL FROM SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___5);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___6 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_mail_from,
                                p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">MAIL FROM REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___6);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___6 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_mail_from,
                                  p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">MAIL FROM REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___6);
    }
  }
  passed___0 ++;
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___7 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->rcpt_to, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RCPT TO SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___7);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___7 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->rcpt_to, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RCPT TO SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___7);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___8 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_rcpt_to, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RCPT TO REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___8);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___8 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_rcpt_to,
                                  p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RCPT TO REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___8);
    }
  }
  passed___0 ++;
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___9 = escape_html_chars((char *)"DATA\r\n", p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA START SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___9);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___9 = escape_html_chars((char *)"DATA\r\n", p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA START SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___9);
    }
  }
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___10 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_data_start,
                                 p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA START REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___10);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___10 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_data_start,
                                   p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA START REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___10);
    }
  }
  passed___0 ++;
  tmp___11 = s_malloc((unsigned long )(8193U * sizeof(char )));
  buf = (char *)tmp___11;
  return_data(x, y, buf);
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___12 = escape_html_chars(buf, p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA SENT:</font> &#9;<font color=\"black\"></td>\n<td><pre>%s</pre></font><br /></td></tr>\n",
            color, tmp___12);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___12 = escape_html_chars(buf, p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA SENT:</font> &#9;<font color=\"black\"></td>\n<td><pre>%s</pre></font><br /></td></tr>\n",
              color, tmp___12);
    }
  }
  free((void *)buf);
  if (! (*((*(hosts + x))->smtp_check + y))->passed) {
    tmp___13 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_data_end,
                                 p);
    fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
            color, tmp___13);
  } else {
    if (passed___0 < (int )(*((*(hosts + x))->smtp_check + y))->passed) {
      tmp___13 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_data_end,
                                   p);
      fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">DATA REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
              color, tmp___13);
    }
  }
  passed___0 ++;
  tmp___14 = escape_html_chars((char *)"RSET\r\n", p);
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RESET SENT:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
          color, tmp___14);
  tmp___15 = escape_html_chars((*((*(hosts + x))->smtp_check + y))->r_reset, p);
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\n<tr><td>&#9;<font color=\"%s\">RESET REPLY:</font> &#9;<font color=\"black\"></td>\n<td>%s</font><br /></td></tr>\n",
          color, tmp___15);
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"</table></font><br /><br /><br />\n\n");
  return;
}
}
void print_html_header(FILE *fd , char *title ) 
{ 

  {
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t<html xmlns=\"http://www.w3.org/1999/xhtml\">");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t<head><LINK rel=\"stylesheet\" type=\"text/css\" href=\"default.css\">");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t\t<style type=\"text/css\">");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t\t\ttable {\n\t\t\t}\n\t\t\tth, td {\n\t\t\t}\n\t\t\th1, h2, h3, h4, h5, h6 {\n\t\t\t\ttext-transform:capitalize;\n\t\t\t\tfont-size: medium;");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t\t\t}\n\t\t\tA:link {\n\t\t\t\tcolor: darkblue;\n\t\t\t}\n\t\t\tA:visited {\n\t\t\t\tcolor: darkblue;\n\t\t\t}\n\t\t\tA:active {\n\t\t\t\tcolor: violet;");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t\t\t}\n\t\t\tbody {\n\t\t\t\tcolor: black;\n\t\t\t\tbackground-color: white;\n\t\t\t\tfont-family: Verdana, Arial, Helvetica, sans-serif;\n");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t\t\t\tfont-size: small;\n\t\t\t\tborder-width: 10px;\n\t\t\t\tborder-style: solid;\n\t\t\t\tborder-color: darkblue;\n\t\t\t\tpadding-top: 10px;\n");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t\t\t\tpadding-left: 32px;\n\t\t\t\tpadding-right: 10px;\n\t\t\t\tpadding-bottom: 10px;\n\t\t\t\tmargin: 10px;\n\t\t\t}\n\t\t\tblockquote {\n");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t\t\t\tpadding:10px;\n\t\t\t\tborder:red 5px solid;\n\t\t\t\tborder-style:inset outset inset;\n\t\t\t}\n\t\t</style>\n");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"\t\t<title>%s</title>\n\t</head>\n\t<body>",
          title);
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<Font size=\"5\">Smtp Relay Checker</font><br /><br /><br /><br />\n");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<table border=\"0\" cellpadding=\"5\" align=\"center\"><tr>\n");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<td><a href=\"%s\">Checks that Failed</a></td>\n",
          failed_file);
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<td><a href=\"%s\">Checks that passed</a></td>\n",
          passed);
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<td><a href=\"%s\">Checks that produced errors</a></td>\n",
          errord);
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"</tr></table>");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<br /><br />");
  return;
}
}
void print_html_footer(FILE *fd , long smtp_open___0 ) 
{ char buf[8193] ;

  {
  if (o.hours) {
    snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%d Hours, %d Mins and %d Seconds",
             o.hours, o.mins, o.seconds);
  } else {
    if (o.mins) {
      snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%d Mins and %d Seconds",
               o.mins, o.seconds);
    } else {
      snprintf((char * __restrict  )(buf), 8192U, (char const   * __restrict  )"%d Seconds",
               o.seconds);
    }
  }
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<br /><br /><center><br /><br /><hr width=\"30%%\">");
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<font size=\"1\">Scanned %ld hosts in %s<br />%ld of which were running mail servers<br />Spencer Hardy - <a href=\"mailto:diceman@dircon.co.uk\">diceman@dircon.co.uk</a><br /><a href=\"http://www.moejo.co.uk/smtprc-website\">http://www.moejo.co.uk/smtprc-website</a></font><hr width=\"30%%\"></center></body>",
          o.no_hostnames, buf, smtp_open___0);
  return;
}
}
void print_link(FILE *fd , char *link___0 , char *text , char *color ) 
{ char buf[30] ;
  int x ;
  size_t tmp ;

  {
  x = 0;
  while (1) {
    if (x < 20) {
      tmp = strlen((char const   *)text);
      if (! ((size_t )x < tmp)) {
        break;
      }
    } else {
      break;
    }
    buf[x] = *(text + x);
    x ++;
  }
  buf[x] = (char )'\000';
  fprintf((FILE * __restrict  )fd, (char const   * __restrict  )"<a href=\"%s\"><font color=\"%s\">%s</font></a>",
          link___0, color, buf);
  return;
}
}
char *escape_html_chars(char *string , char *s ) 
{ char *p ;
  char buf[8193] ;
  int count ;
  size_t tmp ;
  void *tmp___0 ;
  char *tmp___1 ;
  size_t tmp___2 ;
  void *tmp___3 ;
  size_t tmp___4 ;
  size_t tmp___5 ;

  {
  count = 0;
  memset((void *)(buf), 0, 8192U);
  if ((unsigned int )string == (unsigned int )((void *)0)) {
    tmp = strlen("NULL");
    tmp___0 = s_malloc((unsigned long )((tmp + 2U) * sizeof(char )));
    s = (char *)tmp___0;
    strncpy((char * __restrict  )s, (char const   * __restrict  )"NULL", 4U);
    *(s + 5) = (char )'\000';
    return (s);
  }
  p = string;
  while (1) {
    if ((int )*p == 60) {
      strncat((char * __restrict  )(buf), (char const   * __restrict  )"&lt;", 8192U);
      count += 4;
      goto __Cont;
    }
    if ((int )*p == 62) {
      strncat((char * __restrict  )(buf), (char const   * __restrict  )"&gt;", 8192U);
      count += 4;
      goto __Cont;
    }
    buf[count] = *p;
    count ++;
    __Cont: /* CIL Label */ 
    tmp___1 = p;
    p ++;
    if (! ((int )*tmp___1 != 0)) {
      break;
    }
  }
  tmp___2 = strlen((char const   *)(buf));
  tmp___3 = s_malloc((unsigned long )((tmp___2 + 1U) * sizeof(char )));
  s = (char *)tmp___3;
  tmp___4 = strlen((char const   *)(buf));
  strncpy((char * __restrict  )s, (char const   * __restrict  )(buf), tmp___4);
  tmp___5 = strlen((char const   *)(buf));
  *(s + tmp___5) = (char )'\000';
  return (s);
}
}
#pragma merger(0,"/tmp/cil-0nwjV0jq.i","-Wall,-g,-pthread")
void display_text(void) 
{ 

  {
  return;
}
}
#pragma merger(0,"/tmp/cil-mL4HxtOc.i","-Wall,-g,-pthread")
void validate_options(void) 
{ FILE *fd ;
  DIR *dip ;
  char dir[8193] ;
  char buf[8193] ;
  int tmp ;
  size_t tmp___0 ;
  void *tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  int tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  int tmp___9 ;
  size_t tmp___10 ;
  void *tmp___11 ;
  size_t tmp___12 ;
  size_t tmp___13 ;
  int tmp___14 ;
  size_t tmp___15 ;
  void *tmp___16 ;
  size_t tmp___17 ;
  size_t tmp___18 ;
  size_t tmp___19 ;
  time_t tmp___20 ;

  {
  if (f.ip_range) {
    if (f.ip_list) {
      fatal((char *)"You cannont supply both an ip list and ip range\n");
    }
  }
  if (f.auto_config) {
    if (f.generate_config) {
      fatal((char *)"You can only generate the auto config file from command line options. You cannot also specify the \'-j\' option.\n");
    }
  }
  if (! f.ip_range) {
    if (! f.ip_list) {
      fatal((char *)"You must supply either an ip range or a file that contains a list of ip addresses to scan.\n");
    }
  }
  if ((int )o.number_of_threads < 5) {
    fatal((char *)"You can only scan with a minumum of 5 threads... please increas the number of threads.\n");
  }
  if (f.output_html) {
    tmp = check_file_path(o.html_file, buf);
    if (tmp == -1) {
      fatal((char *)"Unable to open output HTML file %s", o.html_file);
    }
    tmp___0 = strlen((char const   *)(buf));
    tmp___1 = s_malloc((unsigned long )((tmp___0 + 1U) * sizeof(char )));
    o.html_path = (char *)tmp___1;
    tmp___2 = strlen((char const   *)(buf));
    strncpy((char * __restrict  )o.html_path, (char const   * __restrict  )(buf),
            tmp___2);
    tmp___3 = strlen((char const   *)(buf));
    *(o.html_path + tmp___3) = (char )'\000';
  }
  if (f.output_text) {
    tmp___4 = check_file_path(o.text_file, buf);
    if (tmp___4 == -1) {
      fatal((char *)"Unable to open output TEXT file %s", o.text_file);
    }
    tmp___5 = strlen((char const   *)(buf));
    tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
    o.text_path = (char *)tmp___6;
    tmp___7 = strlen((char const   *)(buf));
    strncpy((char * __restrict  )o.text_path, (char const   * __restrict  )(buf),
            tmp___7);
    tmp___8 = strlen((char const   *)(buf));
    *(o.text_path + tmp___8) = (char )'\000';
  }
  if (f.output_machine) {
    tmp___9 = check_file_path(o.machine_file, buf);
    if (tmp___9 == -1) {
      fatal((char *)"Unable to open output MACHINE file %s", o.machine_file);
    }
    tmp___10 = strlen((char const   *)(buf));
    tmp___11 = s_malloc((unsigned long )((tmp___10 + 1U) * sizeof(char )));
    o.machine_path = (char *)tmp___11;
    tmp___12 = strlen((char const   *)(buf));
    strncpy((char * __restrict  )o.machine_path, (char const   * __restrict  )(buf),
            tmp___12);
    tmp___13 = strlen((char const   *)(buf));
    *(o.machine_path + tmp___13) = (char )'\000';
  }
  if (f.output_xml) {
    tmp___14 = check_file_path(o.xml_file, buf);
    if (tmp___14 == -1) {
      fatal((char *)"Unable to open output XML file %s", o.xml_file);
    }
    tmp___15 = strlen((char const   *)(buf));
    tmp___16 = s_malloc((unsigned long )((tmp___15 + 1U) * sizeof(char )));
    o.xml_path = (char *)tmp___16;
    tmp___17 = strlen((char const   *)(buf));
    strncpy((char * __restrict  )o.xml_path, (char const   * __restrict  )(buf), tmp___17);
    tmp___18 = strlen((char const   *)(buf));
    *(o.xml_path + tmp___18) = (char )'\000';
  }
  if (f.maildir) {
    tmp___19 = strlen((char const   *)o.mailbox);
    if ((int )*(o.mailbox + tmp___19) == 47) {
      snprintf((char * __restrict  )(dir), 8192U, (char const   * __restrict  )"%snew",
               o.mailbox);
    } else {
      snprintf((char * __restrict  )(dir), 8192U, (char const   * __restrict  )"%s/new",
               o.mailbox);
    }
    dir[8192] = (char )'\000';
    dip = opendir((char const   *)(dir));
    if ((unsigned int )dip == (unsigned int )((void *)0)) {
      fatal((char *)"Unable to open maildir folder (%s)", dir);
    }
  }
  if (f.mbox) {
    fd = fopen((char const   * __restrict  )o.mailbox, (char const   * __restrict  )"r");
    if ((unsigned int )fd == (unsigned int )((void *)0)) {
      fatal((char *)"Unable to mbox (%s)\n", o.mailbox);
    }
  }
  if (((int )f.mbox + (int )f.maildir) + (int )f.pop > 1) {
    fatal((char *)"You can only supply one mail retreival format");
  }
  if (! f.config_file) {
    printf((char const   * __restrict  )"\nConfig file not specified, using the default location (%s)\n",
           o.config_file);
    f.config_file = (unsigned char)1;
  }
  if (! f.email_template) {
    printf((char const   * __restrict  )"\nEmail template not specified, using the default location (%s)\n",
           o.email_template);
    f.email_template = (unsigned char)1;
  }
  tmp___20 = time((time_t *)((void *)0));
  o.time = (unsigned int )tmp___20;
  return;
}
}
#pragma merger(0,"/tmp/cil-SMk1onHu.i","-Wall,-g,-pthread")
int check_banner(int *sockfd , long cur_host , int rule___0 ) ;
int check_helo(int *sockfd , long cur_host , int rule___0 ) ;
int check_mail_from(int *sockfd , long cur_host , int rule___0 ) ;
int check_rcpt_to(int *sockfd , long cur_host , int rule___0 ) ;
int check_send_data_start(int *sockfd , long cur_host , int rule___0 ) ;
int check_send_data(int *sockfd , long cur_host , int rule___0 ) ;
int suspected_open_relay(long cur_host , int rule___0 ) ;
int reset_smtp(int *sockfd , long cur_host , int rule___0 ) ;
int quit_smtp(int *sockfd , long cur_host , int rule___0 ) ;
int relay_check(int *sockfd , long cur_host ) 
{ int rule___0 ;
  int res ;
  int padding ;
  char checking[8193] ;

  {
  rule___0 = 0;
  res = 0;
  padding = 60;
  if (f.resolve_hostnames) {
    if ((*(hosts + cur_host))->resolved) {
      if (! f.display_only_ips) {
        snprintf((char * __restrict  )(checking), (unsigned int )padding, (char const   * __restrict  )"Checking %s%200c",
                 (*(hosts + cur_host))->hostname, ' ');
      } else {
        snprintf((char * __restrict  )(checking), (unsigned int )padding, (char const   * __restrict  )"Checking %s%200c",
                 (*(hosts + cur_host))->ip_address, ' ');
      }
    } else {
      snprintf((char * __restrict  )(checking), (unsigned int )padding, (char const   * __restrict  )"Checking %s%200c",
               (*(hosts + cur_host))->ip_address, ' ');
    }
  } else {
    snprintf((char * __restrict  )(checking), (unsigned int )padding, (char const   * __restrict  )"Checking %s%200c",
             (*(hosts + cur_host))->ip_address, ' ');
  }
  rule___0 = 0;
  while (rule___0 <= (int )o.no_rules) {
    if (! rule___0) {
      res = check_banner(sockfd, cur_host, rule___0);
      if (res == -1) {
        strncat((char * __restrict  )(checking), (char const   * __restrict  )" !",
                8192U);
        if (f.verbose) {
          printf((char const   * __restrict  )"%s\n", checking);
        }
        return (-1);
      } else {
        if (res == 1) {
          strncat((char * __restrict  )(checking), (char const   * __restrict  )" o",
                  8192U);
          goto RESET;
        }
      }
      res = check_helo(sockfd, cur_host, rule___0);
      if (res == -1) {
        strncat((char * __restrict  )(checking), (char const   * __restrict  )" !",
                8192U);
        if (f.verbose) {
          printf((char const   * __restrict  )"%s\n", checking);
        }
        return (-1);
      } else {
        if (res == 1) {
          strncat((char * __restrict  )(checking), (char const   * __restrict  )" o",
                  8192U);
          goto RESET;
        }
      }
    }
    res = check_mail_from(sockfd, cur_host, rule___0);
    if (res == -1) {
      strncat((char * __restrict  )(checking), (char const   * __restrict  )" !",
              8192U);
      if (f.verbose) {
        printf((char const   * __restrict  )"%s\n", checking);
      }
      return (-1);
    } else {
      if (res == 1) {
        strncat((char * __restrict  )(checking), (char const   * __restrict  )" o",
                8192U);
        goto RESET;
      }
    }
    res = check_rcpt_to(sockfd, cur_host, rule___0);
    if (res == -1) {
      strncat((char * __restrict  )(checking), (char const   * __restrict  )" !",
              8192U);
      if (f.verbose) {
        printf((char const   * __restrict  )"%s\n", checking);
      }
      return (-1);
    } else {
      if (res == 1) {
        strncat((char * __restrict  )(checking), (char const   * __restrict  )" o",
                8192U);
        goto RESET;
      }
    }
    res = check_send_data_start(sockfd, cur_host, rule___0);
    if (res == -1) {
      strncat((char * __restrict  )(checking), (char const   * __restrict  )" !",
              8192U);
      if (f.verbose) {
        printf((char const   * __restrict  )"%s\n", checking);
      }
      return (-1);
    } else {
      if (res == 1) {
        strncat((char * __restrict  )(checking), (char const   * __restrict  )" o",
                8192U);
        goto RESET;
      }
    }
    res = check_send_data(sockfd, cur_host, rule___0);
    if (res == -1) {
      strncat((char * __restrict  )(checking), (char const   * __restrict  )" !",
              8192U);
      if (f.verbose) {
        printf((char const   * __restrict  )"%s\n", checking);
      }
      return (-1);
    } else {
      if (res == 1) {
        strncat((char * __restrict  )(checking), (char const   * __restrict  )" o",
                8192U);
        goto RESET;
      }
    }
    strncat((char * __restrict  )(checking), (char const   * __restrict  )" x", 8192U);
    (*((*(hosts + cur_host))->smtp_check + rule___0))->failed = (unsigned char)1;
    suspected_open_relay(cur_host, rule___0);
    RESET: 
    res = reset_smtp(sockfd, cur_host, rule___0);
    if (res == -1) {
      strncat((char * __restrict  )(checking), (char const   * __restrict  )" !",
              8192U);
      printf((char const   * __restrict  )"%s\n", checking);
      return (-1);
    }
    rule___0 ++;
  }
  res = quit_smtp(sockfd, cur_host, (int )o.no_rules);
  if (res == -1) {
    strncat((char * __restrict  )(checking), (char const   * __restrict  )" !", (unsigned int )padding);
    printf((char const   * __restrict  )"%s\n", checking);
    return (-1);
  }
  printf((char const   * __restrict  )"%s\n", checking);
  return (0);
}
}
#pragma merger(0,"/tmp/cil-AnIOkWli.i","-Wall,-g,-pthread")
void fatal(char *fmt  , ...) 
{ va_list ap ;

  {
  __builtin_va_start(ap, fmt);
  fflush(stdout);
  fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"ERROR: ");
  vfprintf((FILE * __restrict  )stderr, (char const   * __restrict  )fmt, ap);
  fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\nQUITTING!\n");
  __builtin_va_end(ap);
  exit(1);
  return;
}
}
void error(char *fmt  , ...) 
{ va_list ap ;

  {
  __builtin_va_start(ap, fmt);
  fflush(stdout);
  vfprintf((FILE * __restrict  )stderr, (char const   * __restrict  )fmt, ap);
  fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"\n");
  __builtin_va_end(ap);
  return;
}
}
#pragma merger(0,"/tmp/cil-d6rPGVlq.i","-Wall,-g,-pthread")
void display_machine(void) 
{ 

  {
  return;
}
}
#pragma merger(0,"/tmp/cil-EuTtXGmx.i","-Wall,-g,-pthread")
void display_xml(void) 
{ 

  {
  return;
}
}
/* compiler builtin: 
   void *__builtin_alloca(unsigned int  ) ;  */
#pragma merger(0,"/tmp/cil-SKHJ9eww.i","-Wall,-g,-pthread")
extern char *optarg ;
extern  __attribute__((__nothrow__)) int getopt(int ___argc , char * const  *___argv ,
                                                char const   *__shortopts ) ;
void usage(char *pname ) ;
struct options o  ;
struct flags f  ;
void parse_args(int argc , char * const  *argv ) 
{ char c ;
  size_t tmp ;
  void *tmp___0 ;
  size_t tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  void *tmp___4 ;
  size_t tmp___5 ;
  size_t tmp___6 ;
  size_t tmp___7 ;
  void *tmp___8 ;
  size_t tmp___9 ;
  size_t tmp___10 ;
  size_t tmp___11 ;
  void *tmp___12 ;
  size_t tmp___13 ;
  size_t tmp___14 ;
  size_t tmp___15 ;
  void *tmp___16 ;
  size_t tmp___17 ;
  size_t tmp___18 ;
  size_t tmp___19 ;
  void *tmp___20 ;
  size_t tmp___21 ;
  size_t tmp___22 ;
  size_t tmp___23 ;
  void *tmp___24 ;
  size_t tmp___25 ;
  size_t tmp___26 ;
  int tmp___27 ;
  int tmp___28 ;
  size_t tmp___29 ;
  void *tmp___30 ;
  size_t tmp___31 ;
  size_t tmp___32 ;
  int tmp___33 ;
  int tmp___34 ;
  size_t tmp___35 ;
  void *tmp___36 ;
  size_t tmp___37 ;
  size_t tmp___38 ;
  size_t tmp___39 ;
  void *tmp___40 ;
  size_t tmp___41 ;
  size_t tmp___42 ;
  size_t tmp___43 ;
  void *tmp___44 ;
  size_t tmp___45 ;
  size_t tmp___46 ;
  size_t tmp___47 ;
  void *tmp___48 ;
  size_t tmp___49 ;
  size_t tmp___50 ;
  size_t tmp___51 ;
  void *tmp___52 ;
  size_t tmp___53 ;
  size_t tmp___54 ;
  size_t tmp___55 ;
  void *tmp___56 ;
  size_t tmp___57 ;
  size_t tmp___58 ;
  int tmp___59 ;

  {
  while (1) {
    tmp___59 = getopt(argc, argv, "ab:c:de:f:g:hi:j:k:l:m:no:p:qr:s:tu:vw:x:y:");
    c = (char )tmp___59;
    if (! ((int )c != -1)) {
      break;
    }
    switch ((int )c) {
    case 97: 
    f.display_all = (unsigned char)1;
    break;
    case 98: 
    f.send_email = (unsigned char)1;
    tmp = strlen((char const   *)optarg);
    tmp___0 = s_malloc((unsigned long )((tmp + 1U) * sizeof(char )));
    o.email_address = (char *)tmp___0;
    tmp___1 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.email_address, (char const   * __restrict  )optarg,
            tmp___1);
    tmp___2 = strlen((char const   *)optarg);
    *(o.email_address + tmp___2) = (char )'\000';
    break;
    case 99: 
    f.config_file = (unsigned char)1;
    tmp___3 = strlen((char const   *)(optarg + 1));
    tmp___4 = realloc((void *)o.config_file, tmp___3 * sizeof(char ));
    o.config_file = (char *)tmp___4;
    if ((unsigned int )o.config_file == (unsigned int )((void *)0)) {
      fatal((char *)"Realloc Error\n");
    }
    tmp___5 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.config_file, (char const   * __restrict  )optarg,
            tmp___5);
    tmp___6 = strlen((char const   *)optarg);
    *(o.config_file + tmp___6) = (char )'\000';
    break;
    case 100: 
    f.debug = (unsigned char)1;
    break;
    case 101: 
    f.check_mailbox = (unsigned char)1;
    f.mbox = (unsigned char)1;
    tmp___7 = strlen((char const   *)optarg);
    tmp___8 = s_malloc((unsigned long )((tmp___7 + 1U) * sizeof(char )));
    o.mailbox = (char *)tmp___8;
    tmp___9 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.mailbox, (char const   * __restrict  )optarg, tmp___9);
    tmp___10 = strlen((char const   *)optarg);
    *(o.mailbox + tmp___10) = (char )'\000';
    break;
    case 102: 
    not_implemented();
    f.output_text = (unsigned char)1;
    tmp___11 = strlen((char const   *)optarg);
    tmp___12 = s_malloc((unsigned long )((tmp___11 + 1U) * sizeof(char )));
    o.text_file = (char *)tmp___12;
    tmp___13 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.text_file, (char const   * __restrict  )optarg,
            tmp___13);
    tmp___14 = strlen((char const   *)optarg);
    *(o.text_file + tmp___14) = (char )'\000';
    break;
    case 104: 
    usage((char *)*(argv + 0));
    break;
    case 105: 
    f.ip_list = (unsigned char)1;
    tmp___15 = strlen((char const   *)optarg);
    tmp___16 = s_malloc((unsigned long )((tmp___15 + 1U) * sizeof(char )));
    o.ip_list = (char *)tmp___16;
    tmp___17 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.ip_list, (char const   * __restrict  )optarg, tmp___17);
    tmp___18 = strlen((char const   *)optarg);
    *(o.ip_list + tmp___18) = (char )'\000';
    break;
    case 106: 
    f.auto_config = (unsigned char)1;
    tmp___19 = strlen((char const   *)optarg);
    tmp___20 = s_malloc((unsigned long )((tmp___19 + 1U) * sizeof(char )));
    o.auto_config_file = (char *)tmp___20;
    tmp___21 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.auto_config_file, (char const   * __restrict  )optarg,
            tmp___21);
    tmp___22 = strlen((char const   *)optarg);
    *(o.auto_config_file + tmp___22) = (char )'\000';
    break;
    case 107: 
    f.generate_config = (unsigned char)1;
    tmp___23 = strlen((char const   *)optarg);
    tmp___24 = s_malloc((unsigned long )((tmp___23 + 1U) * sizeof(char )));
    o.generate_file = (char *)tmp___24;
    tmp___25 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.generate_file, (char const   * __restrict  )optarg,
            tmp___25);
    tmp___26 = strlen((char const   *)optarg);
    *(o.generate_file + tmp___26) = (char )'\000';
    break;
    case 108: 
    tmp___27 = atoi((char const   *)optarg);
    o.c_timeout = (unsigned short )tmp___27;
    break;
    case 109: 
    tmp___28 = atoi((char const   *)optarg);
    o.m_timeout = (unsigned short )tmp___28;
    break;
    case 110: 
    f.resolve_hostnames = (unsigned char)1;
    break;
    case 111: 
    f.output_machine = (unsigned char)1;
    tmp___29 = strlen((char const   *)optarg);
    tmp___30 = s_malloc((unsigned long )((tmp___29 + 1U) * sizeof(char )));
    o.machine_file = (char *)tmp___30;
    tmp___31 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.machine_file, (char const   * __restrict  )optarg,
            tmp___31);
    tmp___32 = strlen((char const   *)optarg);
    *(o.machine_file + tmp___32) = (char )'\000';
    break;
    case 112: 
    tmp___33 = atoi((char const   *)optarg);
    o.number_of_threads = (unsigned short )tmp___33;
    break;
    case 113: 
    f.display_only_ips = (unsigned char)1;
    break;
    case 114: 
    tmp___34 = atoi((char const   *)optarg);
    o.r_timeout = (unsigned short )tmp___34;
    break;
    case 115: 
    f.ip_range = (unsigned char)1;
    tmp___35 = strlen((char const   *)optarg);
    tmp___36 = s_malloc((unsigned long )((tmp___35 + 1U) * sizeof(char )));
    o.ip_range = (char *)tmp___36;
    tmp___37 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.ip_range, (char const   * __restrict  )optarg,
            tmp___37);
    tmp___38 = strlen((char const   *)optarg);
    *(o.ip_range + tmp___38) = (char )'\000';
    break;
    case 117: 
    f.check_mailbox = (unsigned char)1;
    f.maildir = (unsigned char)1;
    tmp___39 = strlen((char const   *)optarg);
    tmp___40 = s_malloc((unsigned long )((tmp___39 + 1U) * sizeof(char )));
    o.mailbox = (char *)tmp___40;
    tmp___41 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.mailbox, (char const   * __restrict  )optarg, tmp___41);
    tmp___42 = strlen((char const   *)optarg);
    *(o.mailbox + tmp___42) = (char )'\000';
    break;
    case 118: 
    f.verbose = (unsigned char )((int )f.verbose + 1);
    break;
    case 119: 
    f.output_html = (unsigned char)1;
    tmp___43 = strlen((char const   *)optarg);
    tmp___44 = s_malloc((unsigned long )((tmp___43 + 1U) * sizeof(char )));
    o.html_file = (char *)tmp___44;
    tmp___45 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.html_file, (char const   * __restrict  )optarg,
            tmp___45);
    tmp___46 = strlen((char const   *)optarg);
    *(o.html_file + tmp___46) = (char )'\000';
    break;
    case 120: 
    not_implemented();
    f.output_xml = (unsigned char)1;
    tmp___47 = strlen((char const   *)optarg);
    tmp___48 = s_malloc((unsigned long )((tmp___47 + 1U) * sizeof(char )));
    o.xml_file = (char *)tmp___48;
    tmp___49 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.xml_file, (char const   * __restrict  )optarg,
            tmp___49);
    tmp___50 = strlen((char const   *)optarg);
    *(o.xml_file + tmp___50) = (char )'\000';
    case 121: 
    f.email_template = (unsigned char)1;
    tmp___51 = strlen((char const   *)(optarg + 1));
    tmp___52 = realloc((void *)o.email_template, tmp___51 * sizeof(char ));
    o.email_template = (char *)tmp___52;
    if ((unsigned int )o.email_template == (unsigned int )((void *)0)) {
      fatal((char *)"Realloc Error\n");
    }
    tmp___53 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.email_template, (char const   * __restrict  )optarg,
            tmp___53);
    tmp___54 = strlen((char const   *)optarg);
    *(o.email_template + tmp___54) = (char )'\000';
    break;
    case 122: 
    not_implemented();
    f.output_machine = (unsigned char)1;
    tmp___55 = strlen((char const   *)optarg);
    tmp___56 = s_malloc((unsigned long )((tmp___55 + 1U) * sizeof(char )));
    o.machine_file = (char *)tmp___56;
    tmp___57 = strlen((char const   *)optarg);
    strncpy((char * __restrict  )o.machine_file, (char const   * __restrict  )optarg,
            tmp___57);
    tmp___58 = strlen((char const   *)optarg);
    *(o.machine_file + tmp___58) = (char )'\000';
    case 63: 
    usage((char *)*(argv + 0));
    default: 
    usage((char *)*(argv + 0));
    }
  }
  return;
}
}
int get_domain(void) 
{ char *p ;
  char *t ;
  size_t tmp ;
  char *email ;
  unsigned int __lengthofemail ;
  void *tmp___0 ;
  int flag ;
  unsigned short const   **tmp___1 ;
  unsigned short const   **tmp___2 ;
  unsigned short const   **tmp___3 ;
  char *tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  size_t tmp___9 ;
  void *tmp___10 ;
  size_t tmp___11 ;
  size_t tmp___12 ;

  {
  tmp = strlen((char const   *)o.email_address);
  __lengthofemail = tmp + 1U;
  tmp___0 = __builtin_alloca(sizeof(*email) * __lengthofemail);
  email = (char *)tmp___0;
  flag = 0;
  strncpy((char * __restrict  )email, (char const   * __restrict  )o.email_address,
          sizeof(*email) * __lengthofemail);
  p = o.email_address;
  while (1) {
    tmp___4 = p;
    p ++;
    if (! *tmp___4) {
      break;
    }
    if ((int )*p == 0) {
      goto _L;
    } else {
      tmp___3 = __ctype_b_loc();
      if ((int const   )*(*tmp___3 + (int )*p) & 8) {
        goto _L;
      } else {
        if ((int )*p == 46) {
          goto _L;
        } else {
          if ((int )*p == 45) {
            goto _L;
          } else {
            if ((int )*p == 95) {
              goto _L;
            } else {
              if ((int )*p == 64) {
                _L: /* CIL Label */ 
                if ((int )*p == 64) {
                  flag ++;
                  t = p;
                  tmp___1 = __ctype_b_loc();
                  t ++;
                  if (! ((int const   )*(*tmp___1 + (int )*t) & 8)) {
                    fatal((char *)"The email address you have supplied %s is incorrect!!\n",
                          email);
                  }
                  t = p;
                  tmp___2 = __ctype_b_loc();
                  t --;
                  if (! ((int const   )*(*tmp___2 + (int )*t) & 8)) {
                    fatal((char *)"The email address you have supplied %s is incorrect!!\n",
                          email);
                  }
                  t = p;
                  *t = (char )'\000';
                  t ++;
                  p ++;
                }
              } else {
                fatal((char *)"The email address you have supplied %s is incorrect!!\n",
                      email);
              }
            }
          }
        }
      }
    }
  }
  if (! flag) {
    fatal((char *)"The email address you have supplied %s is incorrect!!\n", email);
  } else {
    if (flag > 2) {
      fatal((char *)"The email address you have supplied %s is incorrect!!\n", email);
    }
  }
  tmp___5 = strlen((char const   *)t);
  tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
  o.domain = (char *)tmp___6;
  tmp___7 = strlen((char const   *)t);
  strncpy((char * __restrict  )o.domain, (char const   * __restrict  )t, tmp___7);
  tmp___8 = strlen((char const   *)t);
  *(o.domain + tmp___8) = (char )'\000';
  tmp___9 = strlen((char const   *)o.email_address);
  tmp___10 = s_malloc((unsigned long )((tmp___9 + 1U) * sizeof(char )));
  o.name = (char *)tmp___10;
  tmp___11 = strlen((char const   *)o.email_address);
  strncpy((char * __restrict  )o.name, (char const   * __restrict  )o.email_address,
          tmp___11);
  tmp___12 = strlen((char const   *)o.email_address);
  *(o.name + tmp___12) = (char )'\000';
  debug((char *)"name: %s domain: %s\n", o.name, o.domain);
  return (0);
}
}
#pragma merger(0,"/tmp/cil-pi4v49pL.i","-Wall,-g,-pthread")
extern ssize_t send(int __fd , void const   *__buf , size_t __n , int __flags ) ;
int write_smtp(int *sockfd , char *string , long cur_host ) 
{ int size ;
  size_t tmp ;
  int ret ;
  int *tmp___0 ;

  {
  tmp = strlen((char const   *)string);
  size = (int )tmp;
  ret = 0;
  ret = send(*sockfd, (void const   *)string, (unsigned int )size, 16384);
  if (ret == -1) {
    tmp___0 = __errno_location();
    if (*tmp___0 == 16384) {
      (*(hosts + cur_host))->fatal_error = (unsigned char)1;
    } else {
      if (ret != size) {
        (*(hosts + cur_host))->fatal_error = (unsigned char)1;
      } else {
        (*(hosts + cur_host))->fatal_error = (unsigned char)2;
      }
    }
    return (-1);
  }
  return (0);
}
}
int read_smtp(int *sockfd , char *dest , long cur_host ) 
{ int ret ;

  {
  ret = read_timeo(*sockfd, dest, 8192, (int )o.r_timeout);
  if (ret == -1) {
    (*(hosts + cur_host))->fatal_error = (unsigned char)3;
    return (-1);
  }
  if (! ret) {
    (*(hosts + cur_host))->fatal_error = (unsigned char)4;
    return (-1);
  }
  return (0);
}
}
int check_banner(int *sockfd , long cur_host , int rule___0 ) 
{ char *buf ;
  int res ;
  void *tmp ;
  size_t tmp___0 ;
  void *tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  size_t tmp___4 ;
  void *tmp___5 ;
  size_t tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  void *tmp___9 ;
  size_t tmp___10 ;
  size_t tmp___11 ;
  size_t tmp___12 ;
  void *tmp___13 ;
  size_t tmp___14 ;
  size_t tmp___15 ;
  int tmp___16 ;
  int tmp___17 ;
  int tmp___18 ;

  {
  res = 0;
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  res = read_smtp(sockfd, buf, cur_host);
  if (res == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)1;
    free((void *)buf);
    return (-1);
  }
  tmp___18 = strncmp((char const   *)buf, "220", 3U);
  if (tmp___18) {
    tmp___17 = strncmp((char const   *)buf, "421", 3U);
    if (tmp___17) {
      tmp___16 = strncmp((char const   *)buf, "521", 3U);
      if (tmp___16) {
        (*(hosts + cur_host))->fatal_error = (unsigned char)6;
        (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
        (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)2;
        tmp___12 = strlen((char const   *)buf);
        tmp___13 = s_malloc((unsigned long )((tmp___12 + 1U) * sizeof(char )));
        (*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner = (char *)tmp___13;
        tmp___14 = strlen((char const   *)buf);
        strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner,
                (char const   * __restrict  )buf, tmp___14);
        tmp___15 = strlen((char const   *)buf);
        *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner + tmp___15) = (char )'\000';
        free((void *)buf);
        return (-1);
      } else {
        (*(hosts + cur_host))->fatal_error = (unsigned char)5;
        (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
        (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)2;
        tmp___8 = strlen((char const   *)buf);
        tmp___9 = s_malloc((unsigned long )((tmp___8 + 1U) * sizeof(char )));
        (*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner = (char *)tmp___9;
        tmp___10 = strlen((char const   *)buf);
        strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner,
                (char const   * __restrict  )buf, tmp___10);
        tmp___11 = strlen((char const   *)buf);
        *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner + tmp___11) = (char )'\000';
        free((void *)buf);
        return (-1);
      }
    } else {
      (*(hosts + cur_host))->fatal_error = (unsigned char)5;
      (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
      (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)2;
      tmp___4 = strlen((char const   *)buf);
      tmp___5 = s_malloc((unsigned long )((tmp___4 + 1U) * sizeof(char )));
      (*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner = (char *)tmp___5;
      tmp___6 = strlen((char const   *)buf);
      strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner,
              (char const   * __restrict  )buf, tmp___6);
      tmp___7 = strlen((char const   *)buf);
      *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner + tmp___7) = (char )'\000';
      free((void *)buf);
      return (-1);
    }
  } else {
    tmp___0 = strlen((char const   *)buf);
    tmp___1 = s_malloc((unsigned long )((tmp___0 + 1U) * sizeof(char )));
    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner = (char *)tmp___1;
    tmp___2 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner,
            (char const   * __restrict  )buf, tmp___2);
    tmp___3 = strlen((char const   *)buf);
    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_banner + tmp___3) = (char )'\000';
    free((void *)buf);
    return (0);
  }
  free((void *)buf);
  return (-1);
}
}
int check_helo(int *sockfd , long cur_host , int rule___0 ) 
{ char *buf ;
  int res ;
  void *tmp ;
  size_t tmp___0 ;
  void *tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  int tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  size_t tmp___9 ;
  void *tmp___10 ;
  size_t tmp___11 ;
  size_t tmp___12 ;
  size_t tmp___13 ;
  void *tmp___14 ;
  size_t tmp___15 ;
  size_t tmp___16 ;
  int tmp___17 ;
  int tmp___18 ;

  {
  res = 0;
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  swap_rule(buf, (char const   *)(*(rules + rule___0))->helo, (int )cur_host);
  convert_rule(buf, 1);
  tmp___0 = strlen((char const   *)buf);
  tmp___1 = s_malloc((unsigned long )((tmp___0 + 1U) * sizeof(char )));
  (*((*(hosts + cur_host))->smtp_check + rule___0))->helo = (char *)tmp___1;
  tmp___2 = strlen((char const   *)buf);
  strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->helo,
          (char const   * __restrict  )buf, tmp___2);
  tmp___3 = strlen((char const   *)buf);
  *((*((*(hosts + cur_host))->smtp_check + rule___0))->helo + tmp___3) = (char )'\000';
  tmp___4 = write_smtp(sockfd, buf, cur_host);
  if (tmp___4 == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)3;
    free((void *)buf);
    return (-1);
  }
  memset((void *)buf, 0, 8192U);
  res = read_smtp(sockfd, buf, cur_host);
  if (res == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)4;
    free((void *)buf);
    return (-1);
  }
  tmp___18 = strncmp((char const   *)buf, "250", 3U);
  if (tmp___18) {
    tmp___17 = strncmp((char const   *)buf, "421", 3U);
    if (tmp___17) {
      (*(hosts + cur_host))->fatal_error = (unsigned char)6;
      (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
      (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)5;
      tmp___13 = strlen((char const   *)buf);
      tmp___14 = s_malloc((unsigned long )((tmp___13 + 1U) * sizeof(char )));
      (*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo = (char *)tmp___14;
      tmp___15 = strlen((char const   *)buf);
      strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo,
              (char const   * __restrict  )buf, tmp___15);
      tmp___16 = strlen((char const   *)buf);
      *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo + tmp___16) = (char )'\000';
      free((void *)buf);
      return (-1);
    } else {
      (*(hosts + cur_host))->fatal_error = (unsigned char)5;
      (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
      (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)5;
      tmp___9 = strlen((char const   *)buf);
      tmp___10 = s_malloc((unsigned long )((tmp___9 + 1U) * sizeof(char )));
      (*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo = (char *)tmp___10;
      tmp___11 = strlen((char const   *)buf);
      strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo,
              (char const   * __restrict  )buf, tmp___11);
      tmp___12 = strlen((char const   *)buf);
      *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo + tmp___12) = (char )'\000';
      free((void *)buf);
      return (-1);
    }
  } else {
    tmp___5 = strlen((char const   *)buf);
    tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo = (char *)tmp___6;
    tmp___7 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo,
            (char const   * __restrict  )buf, tmp___7);
    tmp___8 = strlen((char const   *)buf);
    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_helo + tmp___8) = (char )'\000';
    free((void *)buf);
    return (0);
  }
  free((void *)buf);
  return (-1);
}
}
int check_mail_from(int *sockfd , long cur_host , int rule___0 ) 
{ char *buf ;
  int res ;
  void *tmp ;
  size_t tmp___0 ;
  void *tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  int tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  size_t tmp___9 ;
  void *tmp___10 ;
  size_t tmp___11 ;
  size_t tmp___12 ;
  size_t tmp___13 ;
  void *tmp___14 ;
  size_t tmp___15 ;
  size_t tmp___16 ;
  size_t tmp___17 ;
  void *tmp___18 ;
  size_t tmp___19 ;
  size_t tmp___20 ;
  size_t tmp___21 ;
  void *tmp___22 ;
  size_t tmp___23 ;
  size_t tmp___24 ;
  int tmp___25 ;
  int tmp___26 ;
  int tmp___27 ;
  unsigned short const   **tmp___28 ;
  unsigned short const   **tmp___29 ;
  int tmp___30 ;

  {
  res = 0;
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  swap_rule(buf, (char const   *)(*(rules + rule___0))->mail_from, (int )cur_host);
  convert_rule(buf, 2);
  tmp___0 = strlen((char const   *)buf);
  tmp___1 = s_malloc((unsigned long )((tmp___0 + 1U) * sizeof(char )));
  (*((*(hosts + cur_host))->smtp_check + rule___0))->mail_from = (char *)tmp___1;
  tmp___2 = strlen((char const   *)buf);
  strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->mail_from,
          (char const   * __restrict  )buf, tmp___2);
  tmp___3 = strlen((char const   *)buf);
  *((*((*(hosts + cur_host))->smtp_check + rule___0))->mail_from + tmp___3) = (char )'\000';
  tmp___4 = write_smtp(sockfd, buf, cur_host);
  if (tmp___4 == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)6;
    free((void *)buf);
    return (-1);
  }
  memset((void *)buf, 0, 8192U);
  res = read_smtp(sockfd, buf, cur_host);
  if (res == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)7;
    free((void *)buf);
    return (-1);
  }
  tmp___30 = strncmp((char const   *)buf, "250", 3U);
  if (tmp___30) {
    if ((int )*(buf + 0) == 53) {
      tmp___28 = __ctype_b_loc();
      if ((int const   )*(*tmp___28 + (int )*(buf + 1)) & 2048) {
        tmp___29 = __ctype_b_loc();
        if ((int const   )*(*tmp___29 + (int )*(buf + 2)) & 2048) {
          (*((*(hosts + cur_host))->smtp_check + rule___0))->passed = (unsigned char)3;
          tmp___9 = strlen((char const   *)buf);
          tmp___10 = s_malloc((unsigned long )((tmp___9 + 1U) * sizeof(char )));
          (*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from = (char *)tmp___10;
          tmp___11 = strlen((char const   *)buf);
          strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from,
                  (char const   * __restrict  )buf, tmp___11);
          tmp___12 = strlen((char const   *)buf);
          *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from + tmp___12) = (char )'\000';
          free((void *)buf);
          return (1);
        } else {
          goto _L___1;
        }
      } else {
        goto _L___1;
      }
    } else {
      _L___1: /* CIL Label */ 
      tmp___26 = strncmp((char const   *)buf, "451", 3U);
      if (tmp___26) {
        tmp___27 = strncmp((char const   *)buf, "452", 3U);
        if (tmp___27) {
          tmp___25 = strncmp((char const   *)buf, "421", 3U);
          if (tmp___25) {
            (*(hosts + cur_host))->fatal_error = (unsigned char)6;
            (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
            (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)8;
            tmp___21 = strlen((char const   *)buf);
            tmp___22 = s_malloc((unsigned long )((tmp___21 + 1U) * sizeof(char )));
            (*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from = (char *)tmp___22;
            tmp___23 = strlen((char const   *)buf);
            strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from,
                    (char const   * __restrict  )buf, tmp___23);
            tmp___24 = strlen((char const   *)buf);
            *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from + tmp___24) = (char )'\000';
            free((void *)buf);
            return (-1);
          } else {
            (*(hosts + cur_host))->fatal_error = (unsigned char)5;
            (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
            (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)8;
            tmp___17 = strlen((char const   *)buf);
            tmp___18 = s_malloc((unsigned long )((tmp___17 + 1U) * sizeof(char )));
            (*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from = (char *)tmp___18;
            tmp___19 = strlen((char const   *)buf);
            strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from,
                    (char const   * __restrict  )buf, tmp___19);
            tmp___20 = strlen((char const   *)buf);
            *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from + tmp___20) = (char )'\000';
            free((void *)buf);
            return (-1);
          }
        } else {
          _L: /* CIL Label */ 
          (*(hosts + cur_host))->fatal_error = (unsigned char)7;
          (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
          (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)8;
          tmp___13 = strlen((char const   *)buf);
          tmp___14 = s_malloc((unsigned long )((tmp___13 + 1U) * sizeof(char )));
          (*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from = (char *)tmp___14;
          tmp___15 = strlen((char const   *)buf);
          strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from,
                  (char const   * __restrict  )buf, tmp___15);
          tmp___16 = strlen((char const   *)buf);
          *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from + tmp___16) = (char )'\000';
          free((void *)buf);
          return (-1);
        }
      } else {
        goto _L;
      }
    }
  } else {
    tmp___5 = strlen((char const   *)buf);
    tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from = (char *)tmp___6;
    tmp___7 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from,
            (char const   * __restrict  )buf, tmp___7);
    tmp___8 = strlen((char const   *)buf);
    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_mail_from + tmp___8) = (char )'\000';
    free((void *)buf);
    return (0);
  }
  free((void *)buf);
  return (-1);
}
}
int check_rcpt_to(int *sockfd , long cur_host , int rule___0 ) 
{ char *buf ;
  int res ;
  void *tmp ;
  size_t tmp___0 ;
  void *tmp___1 ;
  size_t tmp___2 ;
  size_t tmp___3 ;
  int tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  size_t tmp___9 ;
  void *tmp___10 ;
  size_t tmp___11 ;
  size_t tmp___12 ;
  size_t tmp___13 ;
  void *tmp___14 ;
  size_t tmp___15 ;
  size_t tmp___16 ;
  size_t tmp___17 ;
  void *tmp___18 ;
  size_t tmp___19 ;
  size_t tmp___20 ;
  size_t tmp___21 ;
  void *tmp___22 ;
  size_t tmp___23 ;
  size_t tmp___24 ;
  size_t tmp___25 ;
  void *tmp___26 ;
  size_t tmp___27 ;
  size_t tmp___28 ;
  int tmp___29 ;
  int tmp___30 ;
  int tmp___31 ;
  int tmp___32 ;
  int tmp___33 ;
  int tmp___34 ;
  int tmp___35 ;
  int tmp___36 ;
  int tmp___37 ;
  unsigned short const   **tmp___38 ;
  unsigned short const   **tmp___39 ;
  int tmp___40 ;

  {
  res = 0;
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  swap_rule(buf, (char const   *)(*(rules + rule___0))->rcpt_to, (int )cur_host);
  convert_rule(buf, 3);
  tmp___0 = strlen((char const   *)buf);
  tmp___1 = s_malloc((unsigned long )((tmp___0 + 1U) * sizeof(char )));
  (*((*(hosts + cur_host))->smtp_check + rule___0))->rcpt_to = (char *)tmp___1;
  tmp___2 = strlen((char const   *)buf);
  strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->rcpt_to,
          (char const   * __restrict  )buf, tmp___2);
  tmp___3 = strlen((char const   *)buf);
  *((*((*(hosts + cur_host))->smtp_check + rule___0))->rcpt_to + tmp___3) = (char )'\000';
  debug((char *)"Check rcpt_to: sending %s", buf);
  tmp___4 = write_smtp(sockfd, buf, cur_host);
  if (tmp___4 == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)9;
    free((void *)buf);
    return (-1);
  }
  memset((void *)buf, 0, 8192U);
  res = read_smtp(sockfd, buf, cur_host);
  if (res == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)10;
    free((void *)buf);
    return (-1);
  }
  debug((char *)"Check rcpt_to: received %s", buf);
  tmp___40 = strncmp((char const   *)buf, "250", 3U);
  if (tmp___40) {
    if ((int )*(buf + 0) == 53) {
      tmp___38 = __ctype_b_loc();
      if ((int const   )*(*tmp___38 + (int )*(buf + 1)) & 2048) {
        tmp___39 = __ctype_b_loc();
        if ((int const   )*(*tmp___39 + (int )*(buf + 2)) & 2048) {
          (*((*(hosts + cur_host))->smtp_check + rule___0))->passed = (unsigned char)4;
          tmp___9 = strlen((char const   *)buf);
          tmp___10 = s_malloc((unsigned long )((tmp___9 + 1U) * sizeof(char )));
          (*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to = (char *)tmp___10;
          tmp___11 = strlen((char const   *)buf);
          strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to,
                  (char const   * __restrict  )buf, tmp___11);
          tmp___12 = strlen((char const   *)buf);
          *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to + tmp___12) = (char )'\000';
          free((void *)buf);
          return (1);
        } else {
          goto _L___2;
        }
      } else {
        goto _L___2;
      }
    } else {
      _L___2: /* CIL Label */ 
      tmp___32 = strncmp((char const   *)buf, "450", 3U);
      if (tmp___32) {
        tmp___33 = strncmp((char const   *)buf, "473", 3U);
        if (tmp___33) {
          tmp___34 = strncmp((char const   *)buf, "500", 3U);
          if (tmp___34) {
            tmp___35 = strncmp((char const   *)buf, "521", 3U);
            if (tmp___35) {
              tmp___36 = strncmp((char const   *)buf, "530", 3U);
              if (tmp___36) {
                tmp___37 = strncmp((char const   *)buf, "554", 3U);
                if (tmp___37) {
                  tmp___30 = strncmp((char const   *)buf, "451", 3U);
                  if (tmp___30) {
                    tmp___31 = strncmp((char const   *)buf, "452", 3U);
                    if (tmp___31) {
                      tmp___29 = strncmp((char const   *)buf, "421", 3U);
                      if (tmp___29) {
                        (*(hosts + cur_host))->fatal_error = (unsigned char)6;
                        (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
                        (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)11;
                        tmp___25 = strlen((char const   *)buf);
                        tmp___26 = s_malloc((unsigned long )((tmp___25 + 1U) * sizeof(char )));
                        (*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to = (char *)tmp___26;
                        tmp___27 = strlen((char const   *)buf);
                        strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to,
                                (char const   * __restrict  )buf, tmp___27);
                        tmp___28 = strlen((char const   *)buf);
                        *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to + tmp___28) = (char )'\000';
                        free((void *)buf);
                        return (-1);
                      } else {
                        (*(hosts + cur_host))->fatal_error = (unsigned char)5;
                        (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
                        (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)11;
                        tmp___21 = strlen((char const   *)buf);
                        tmp___22 = s_malloc((unsigned long )((tmp___21 + 1U) * sizeof(char )));
                        (*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to = (char *)tmp___22;
                        tmp___23 = strlen((char const   *)buf);
                        strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to,
                                (char const   * __restrict  )buf, tmp___23);
                        tmp___24 = strlen((char const   *)buf);
                        *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to + tmp___24) = (char )'\000';
                        free((void *)buf);
                        return (-1);
                      }
                    } else {
                      _L: /* CIL Label */ 
                      (*(hosts + cur_host))->fatal_error = (unsigned char)7;
                      (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
                      (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)11;
                      tmp___17 = strlen((char const   *)buf);
                      tmp___18 = s_malloc((unsigned long )((tmp___17 + 1U) * sizeof(char )));
                      (*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to = (char *)tmp___18;
                      tmp___19 = strlen((char const   *)buf);
                      strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to,
                              (char const   * __restrict  )buf, tmp___19);
                      tmp___20 = strlen((char const   *)buf);
                      *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to + tmp___20) = (char )'\000';
                      free((void *)buf);
                      return (-1);
                    }
                  } else {
                    goto _L;
                  }
                } else {
                  _L___0: /* CIL Label */ 
                  (*((*(hosts + cur_host))->smtp_check + rule___0))->passed = (unsigned char)4;
                  tmp___13 = strlen((char const   *)buf);
                  tmp___14 = s_malloc((unsigned long )((tmp___13 + 1U) * sizeof(char )));
                  (*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to = (char *)tmp___14;
                  tmp___15 = strlen((char const   *)buf);
                  strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to,
                          (char const   * __restrict  )buf, tmp___15);
                  tmp___16 = strlen((char const   *)buf);
                  *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to + tmp___16) = (char )'\000';
                  free((void *)buf);
                  return (1);
                }
              } else {
                goto _L___0;
              }
            } else {
              goto _L___0;
            }
          } else {
            goto _L___0;
          }
        } else {
          goto _L___0;
        }
      } else {
        goto _L___0;
      }
    }
  } else {
    tmp___5 = strlen((char const   *)buf);
    tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to = (char *)tmp___6;
    tmp___7 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to,
            (char const   * __restrict  )buf, tmp___7);
    tmp___8 = strlen((char const   *)buf);
    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_rcpt_to + tmp___8) = (char )'\000';
    free((void *)buf);
    return (0);
  }
  free((void *)buf);
  return (-1);
}
}
int check_send_data_start(int *sockfd , long cur_host , int rule___0 ) 
{ char *buf ;
  int res ;
  void *tmp ;
  int tmp___0 ;
  size_t tmp___1 ;
  void *tmp___2 ;
  size_t tmp___3 ;
  size_t tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  size_t tmp___9 ;
  void *tmp___10 ;
  size_t tmp___11 ;
  size_t tmp___12 ;
  size_t tmp___13 ;
  void *tmp___14 ;
  size_t tmp___15 ;
  size_t tmp___16 ;
  size_t tmp___17 ;
  void *tmp___18 ;
  size_t tmp___19 ;
  size_t tmp___20 ;
  int tmp___21 ;
  int tmp___22 ;
  int tmp___23 ;
  unsigned short const   **tmp___24 ;
  unsigned short const   **tmp___25 ;
  int tmp___26 ;

  {
  res = 0;
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  tmp___0 = write_smtp(sockfd, (char *)"DATA\r\n", cur_host);
  if (tmp___0 == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)12;
    free((void *)buf);
    return (-1);
  }
  res = read_smtp(sockfd, buf, cur_host);
  if (res == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)13;
    free((void *)buf);
    return (-1);
  }
  tmp___26 = strncmp((char const   *)buf, "354", 3U);
  if (tmp___26) {
    if ((int )*(buf + 0) == 53) {
      tmp___24 = __ctype_b_loc();
      if ((int const   )*(*tmp___24 + (int )*(buf + 1)) & 2048) {
        tmp___25 = __ctype_b_loc();
        if ((int const   )*(*tmp___25 + (int )*(buf + 2)) & 2048) {
          (*((*(hosts + cur_host))->smtp_check + rule___0))->passed = (unsigned char)5;
          tmp___5 = strlen((char const   *)buf);
          tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
          (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start = (char *)tmp___6;
          tmp___7 = strlen((char const   *)buf);
          strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start,
                  (char const   * __restrict  )buf, tmp___7);
          tmp___8 = strlen((char const   *)buf);
          *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start + tmp___8) = (char )'\000';
          free((void *)buf);
          return (1);
        } else {
          goto _L___1;
        }
      } else {
        goto _L___1;
      }
    } else {
      _L___1: /* CIL Label */ 
      tmp___22 = strncmp((char const   *)buf, "451", 3U);
      if (tmp___22) {
        tmp___23 = strncmp((char const   *)buf, "452", 3U);
        if (tmp___23) {
          tmp___21 = strncmp((char const   *)buf, "421", 3U);
          if (tmp___21) {
            (*(hosts + cur_host))->fatal_error = (unsigned char)6;
            (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
            (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)14;
            tmp___17 = strlen((char const   *)buf);
            tmp___18 = s_malloc((unsigned long )((tmp___17 + 1U) * sizeof(char )));
            (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start = (char *)tmp___18;
            tmp___19 = strlen((char const   *)buf);
            strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start,
                    (char const   * __restrict  )buf, tmp___19);
            tmp___20 = strlen((char const   *)buf);
            *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start + tmp___20) = (char )'\000';
            free((void *)buf);
            return (-1);
          } else {
            (*(hosts + cur_host))->fatal_error = (unsigned char)5;
            (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
            (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)14;
            tmp___13 = strlen((char const   *)buf);
            tmp___14 = s_malloc((unsigned long )((tmp___13 + 1U) * sizeof(char )));
            (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start = (char *)tmp___14;
            tmp___15 = strlen((char const   *)buf);
            strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start,
                    (char const   * __restrict  )buf, tmp___15);
            tmp___16 = strlen((char const   *)buf);
            *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start + tmp___16) = (char )'\000';
            free((void *)buf);
            return (-1);
          }
        } else {
          _L: /* CIL Label */ 
          (*(hosts + cur_host))->fatal_error = (unsigned char)7;
          (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
          (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)14;
          tmp___9 = strlen((char const   *)buf);
          tmp___10 = s_malloc((unsigned long )((tmp___9 + 1U) * sizeof(char )));
          (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start = (char *)tmp___10;
          tmp___11 = strlen((char const   *)buf);
          strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start,
                  (char const   * __restrict  )buf, tmp___11);
          tmp___12 = strlen((char const   *)buf);
          *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start + tmp___12) = (char )'\000';
          free((void *)buf);
          return (-1);
        }
      } else {
        goto _L;
      }
    }
  } else {
    tmp___1 = strlen((char const   *)buf);
    tmp___2 = s_malloc((unsigned long )((tmp___1 + 1U) * sizeof(char )));
    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start = (char *)tmp___2;
    tmp___3 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start,
            (char const   * __restrict  )buf, tmp___3);
    tmp___4 = strlen((char const   *)buf);
    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_start + tmp___4) = (char )'\000';
    free((void *)buf);
    return (0);
  }
  free((void *)buf);
  return (-1);
}
}
int check_send_data(int *sockfd , long cur_host , int rule___0 ) 
{ char *buf ;
  int res ;
  void *tmp ;
  int tmp___0 ;
  size_t tmp___1 ;
  void *tmp___2 ;
  size_t tmp___3 ;
  size_t tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  size_t tmp___9 ;
  void *tmp___10 ;
  size_t tmp___11 ;
  size_t tmp___12 ;
  size_t tmp___13 ;
  void *tmp___14 ;
  size_t tmp___15 ;
  size_t tmp___16 ;
  size_t tmp___17 ;
  void *tmp___18 ;
  size_t tmp___19 ;
  size_t tmp___20 ;
  size_t tmp___21 ;
  void *tmp___22 ;
  size_t tmp___23 ;
  size_t tmp___24 ;
  int tmp___25 ;
  int tmp___26 ;
  int tmp___27 ;
  int tmp___28 ;
  int tmp___29 ;
  int tmp___30 ;
  int tmp___31 ;
  int tmp___32 ;
  int tmp___33 ;
  int tmp___34 ;
  int tmp___35 ;
  int tmp___36 ;

  {
  res = 0;
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  return_data(cur_host, rule___0, buf);
  tmp___0 = write_smtp(sockfd, buf, cur_host);
  if (tmp___0 == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)15;
    free((void *)buf);
    return (-1);
  }
  memset((void *)buf, 0, 8192U);
  res = read_smtp(sockfd, buf, cur_host);
  if (res == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)16;
    free((void *)buf);
    return (-1);
  }
  tmp___36 = strncmp((char const   *)buf, "250", 3U);
  if (tmp___36) {
    tmp___33 = strncmp((char const   *)buf, "550", 3U);
    if (tmp___33) {
      tmp___34 = strncmp((char const   *)buf, "55", 2U);
      if (tmp___34) {
        tmp___35 = strncmp((char const   *)buf, "571", 3U);
        if (tmp___35) {
          tmp___28 = strncmp((char const   *)buf, "450", 3U);
          if (tmp___28) {
            tmp___29 = strncmp((char const   *)buf, "473", 3U);
            if (tmp___29) {
              tmp___30 = strncmp((char const   *)buf, "500", 3U);
              if (tmp___30) {
                tmp___31 = strncmp((char const   *)buf, "521", 3U);
                if (tmp___31) {
                  tmp___32 = strncmp((char const   *)buf, "530", 3U);
                  if (tmp___32) {
                    tmp___26 = strncmp((char const   *)buf, "451", 3U);
                    if (tmp___26) {
                      tmp___27 = strncmp((char const   *)buf, "452", 3U);
                      if (tmp___27) {
                        tmp___25 = strncmp((char const   *)buf, "421", 3U);
                        if (tmp___25) {
                          (*(hosts + cur_host))->fatal_error = (unsigned char)6;
                          (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
                          (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)17;
                          tmp___21 = strlen((char const   *)buf);
                          tmp___22 = s_malloc((unsigned long )((tmp___21 + 1U) * sizeof(char )));
                          (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end = (char *)tmp___22;
                          tmp___23 = strlen((char const   *)buf);
                          strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end,
                                  (char const   * __restrict  )buf, tmp___23);
                          tmp___24 = strlen((char const   *)buf);
                          *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end + tmp___24) = (char )'\000';
                          free((void *)buf);
                          return (-1);
                        } else {
                          (*(hosts + cur_host))->fatal_error = (unsigned char)5;
                          (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
                          (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)17;
                          tmp___17 = strlen((char const   *)buf);
                          tmp___18 = s_malloc((unsigned long )((tmp___17 + 1U) * sizeof(char )));
                          (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end = (char *)tmp___18;
                          tmp___19 = strlen((char const   *)buf);
                          strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end,
                                  (char const   * __restrict  )buf, tmp___19);
                          tmp___20 = strlen((char const   *)buf);
                          *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end + tmp___20) = (char )'\000';
                          free((void *)buf);
                          return (-1);
                        }
                      } else {
                        _L: /* CIL Label */ 
                        (*(hosts + cur_host))->fatal_error = (unsigned char)7;
                        (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
                        (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)17;
                        tmp___13 = strlen((char const   *)buf);
                        tmp___14 = s_malloc((unsigned long )((tmp___13 + 1U) * sizeof(char )));
                        (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end = (char *)tmp___14;
                        tmp___15 = strlen((char const   *)buf);
                        strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end,
                                (char const   * __restrict  )buf, tmp___15);
                        tmp___16 = strlen((char const   *)buf);
                        *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end + tmp___16) = (char )'\000';
                        free((void *)buf);
                        return (-1);
                      }
                    } else {
                      goto _L;
                    }
                  } else {
                    _L___0: /* CIL Label */ 
                    (*((*(hosts + cur_host))->smtp_check + rule___0))->passed = (unsigned char)6;
                    tmp___9 = strlen((char const   *)buf);
                    tmp___10 = s_malloc((unsigned long )((tmp___9 + 1U) * sizeof(char )));
                    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end = (char *)tmp___10;
                    tmp___11 = strlen((char const   *)buf);
                    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end,
                            (char const   * __restrict  )buf, tmp___11);
                    tmp___12 = strlen((char const   *)buf);
                    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end + tmp___12) = (char )'\000';
                    free((void *)buf);
                    return (1);
                  }
                } else {
                  goto _L___0;
                }
              } else {
                goto _L___0;
              }
            } else {
              goto _L___0;
            }
          } else {
            goto _L___0;
          }
        } else {
          _L___1: /* CIL Label */ 
          (*((*(hosts + cur_host))->smtp_check + rule___0))->passed = (unsigned char)6;
          tmp___5 = strlen((char const   *)buf);
          tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
          (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end = (char *)tmp___6;
          tmp___7 = strlen((char const   *)buf);
          strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end,
                  (char const   * __restrict  )buf, tmp___7);
          tmp___8 = strlen((char const   *)buf);
          *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end + tmp___8) = (char )'\000';
          free((void *)buf);
          return (1);
        }
      } else {
        goto _L___1;
      }
    } else {
      goto _L___1;
    }
  } else {
    tmp___1 = strlen((char const   *)buf);
    tmp___2 = s_malloc((unsigned long )((tmp___1 + 1U) * sizeof(char )));
    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end = (char *)tmp___2;
    tmp___3 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end,
            (char const   * __restrict  )buf, tmp___3);
    tmp___4 = strlen((char const   *)buf);
    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_data_end + tmp___4) = (char )'\000';
    free((void *)buf);
    return (0);
  }
  free((void *)buf);
  return (-1);
}
}
int suspected_open_relay(long cur_host , int rule___0 ) 
{ 

  {
  return (0);
}
}
int reset_smtp(int *sockfd , long cur_host , int rule___0 ) 
{ char *buf ;
  int res ;
  void *tmp ;
  int tmp___0 ;
  size_t tmp___1 ;
  void *tmp___2 ;
  size_t tmp___3 ;
  size_t tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  int tmp___9 ;

  {
  res = 0;
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  tmp___0 = write_smtp(sockfd, (char *)"RSET\r\n", cur_host);
  if (tmp___0 == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)18;
    free((void *)buf);
    return (-1);
  }
  res = read_smtp(sockfd, buf, cur_host);
  if (res == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)19;
    free((void *)buf);
    return (-1);
  }
  tmp___9 = strncmp((char const   *)buf, "250", 3U);
  if (tmp___9) {
    (*(hosts + cur_host))->fatal_error = (unsigned char)8;
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)20;
    tmp___1 = strlen((char const   *)buf);
    tmp___2 = s_malloc((unsigned long )((tmp___1 + 1U) * sizeof(char )));
    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_reset = (char *)tmp___2;
    tmp___3 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_reset,
            (char const   * __restrict  )buf, tmp___3);
    tmp___4 = strlen((char const   *)buf);
    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_reset + tmp___4) = (char )'\000';
    free((void *)buf);
    return (-1);
  } else {
    tmp___5 = strlen((char const   *)buf);
    tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
    (*((*(hosts + cur_host))->smtp_check + rule___0))->r_reset = (char *)tmp___6;
    tmp___7 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*((*(hosts + cur_host))->smtp_check + rule___0))->r_reset,
            (char const   * __restrict  )buf, tmp___7);
    tmp___8 = strlen((char const   *)buf);
    *((*((*(hosts + cur_host))->smtp_check + rule___0))->r_reset + tmp___8) = (char )'\000';
    free((void *)buf);
    return (0);
  }
  free((void *)buf);
  return (0);
}
}
int quit_smtp(int *sockfd , long cur_host , int rule___0 ) 
{ char *buf ;
  int res ;
  void *tmp ;
  int tmp___0 ;
  size_t tmp___1 ;
  void *tmp___2 ;
  size_t tmp___3 ;
  size_t tmp___4 ;
  size_t tmp___5 ;
  void *tmp___6 ;
  size_t tmp___7 ;
  size_t tmp___8 ;
  int tmp___9 ;

  {
  res = 0;
  tmp = s_zmalloc((int )(8193U * sizeof(char )));
  buf = (char *)tmp;
  tmp___0 = write_smtp(sockfd, (char *)"QUIT\r\n", cur_host);
  if (tmp___0 == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)21;
    free((void *)buf);
    return (-1);
  }
  res = read_smtp(sockfd, buf, cur_host);
  if (res == -1) {
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)22;
    free((void *)buf);
    return (-1);
  }
  tmp___9 = strncmp((char const   *)buf, "221", 3U);
  if (tmp___9) {
    (*(hosts + cur_host))->fatal_error = (unsigned char)9;
    (*(hosts + cur_host))->fatal = (unsigned char )rule___0;
    (*((*(hosts + cur_host))->smtp_check + rule___0))->error_code = (unsigned char)23;
    tmp___1 = strlen((char const   *)buf);
    tmp___2 = s_malloc((unsigned long )((tmp___1 + 1U) * sizeof(char )));
    (*(hosts + cur_host))->r_quit = (char *)tmp___2;
    tmp___3 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*(hosts + cur_host))->r_quit, (char const   * __restrict  )buf,
            tmp___3);
    tmp___4 = strlen((char const   *)buf);
    *((*(hosts + cur_host))->r_quit + tmp___4) = (char )'\000';
    free((void *)buf);
    return (-1);
  } else {
    tmp___5 = strlen((char const   *)buf);
    tmp___6 = s_malloc((unsigned long )((tmp___5 + 1U) * sizeof(char )));
    (*(hosts + cur_host))->r_quit = (char *)tmp___6;
    tmp___7 = strlen((char const   *)buf);
    strncpy((char * __restrict  )(*(hosts + cur_host))->r_quit, (char const   * __restrict  )buf,
            tmp___7);
    tmp___8 = strlen((char const   *)buf);
    *((*(hosts + cur_host))->r_quit + tmp___8) = (char )'\000';
    free((void *)buf);
    return (0);
  }
  free((void *)buf);
  return (0);
}
}
#pragma merger(0,"/tmp/cil-gbAoEKxk.i","-Wall,-g,-pthread")
void usage(char *pname ) 
{ 

  {
  printf((char const   * __restrict  )"\n\nUsage: %s -c [config file] -s [iprange] -w [path to html file] -b [email address to relay to] -e [path to mbox]\n",
         pname);
  printf((char const   * __restrict  )"\nOptions:\n\n");
  printf((char const   * __restrict  )"-p [number of threads]\n");
  printf((char const   * __restrict  )"\t\tForks the specified number of threads\n");
  printf((char const   * __restrict  )"\t\tSet this to whatever works best for the machine\n");
  printf((char const   * __restrict  )"\t\tFreeBSD seems fine with 400+ The Linux test\n");
  printf((char const   * __restrict  )"\t\tmachine won\'t take anymore that 250\n");
  printf((char const   * __restrict  )"\n-b [email address]\n");
  printf((char const   * __restrict  )"\t\tWhen this option is supplied, SmtpRC will send email\n");
  printf((char const   * __restrict  )"\t\tthrough any servers that fail any tests. It must\n");
  printf((char const   * __restrict  )"\t\talso correspond with the configuration file. see the\n");
  printf((char const   * __restrict  )"\t\tREADME file for more info.\n");
  printf((char const   * __restrict  )"\n-e [path to mbox]\n");
  printf((char const   * __restrict  )"\t\tWhen this opton is used SmtpRC will check the mail file\n");
  printf((char const   * __restrict  )"\t\tspecified for relayed emails\n");
  printf((char const   * __restrict  )"\n-u [path to maildir]\n");
  printf((char const   * __restrict  )"\t\tWhen this opton is used SmtpRC will check the maildir\n");
  printf((char const   * __restrict  )"\t\tspecified for relayed emails\n");
  printf((char const   * __restrict  )"\n-w [filename]\n");
  printf((char const   * __restrict  )"\t\tPrints detailed HTML output of all failed\n");
  printf((char const   * __restrict  )"\t\tchecks to the filename specified. If used with the -a\n");
  printf((char const   * __restrict  )"\t\toption it will print all checks not just those that\n");
  printf((char const   * __restrict  )"\t\tfailed\n");
  printf((char const   * __restrict  )"\n-f [filename]\n");
  printf((char const   * __restrict  )"\t\tOutput results in text format\n");
  printf((char const   * __restrict  )"\n-o [filename]\n");
  printf((char const   * __restrict  )"\t\tOutput results in machine readable format (comma\n");
  printf((char const   * __restrict  )"\t\tseperated values)\n");
  printf((char const   * __restrict  )"\n-c [config file]\n");
  printf((char const   * __restrict  )"\t\tRead the checks from the specified filename.\n");
  printf((char const   * __restrict  )"\n-y [email template file]\n");
  printf((char const   * __restrict  )"\t\tSpecify an email template to use.\n");
  printf((char const   * __restrict  )"\n-s [ip address range]\n");
  printf((char const   * __restrict  )"\t\tYou can use this option to specify\n");
  printf((char const   * __restrict  )"\t\tthe ip address range (or single host) to scan for\n");
  printf((char const   * __restrict  )"\t\topen relay\'s. Must be in the format 127.0.*.1-200\n");
  printf((char const   * __restrict  )"\n-i [ip list file]\n");
  printf((char const   * __restrict  )"\t\tUse this option to specify a list of ip addresses or\n");
  printf((char const   * __restrict  )"\t\thostnames to scan\n");
  printf((char const   * __restrict  )"\n-k [config file to generate]\n");
  printf((char const   * __restrict  )"\t\tUse this option to generate an automatic config file with the options\n");
  printf((char const   * __restrict  )"\t\tused on the command line\n");
  printf((char const   * __restrict  )"\n-j [auto config file]\n");
  printf((char const   * __restrict  )"\t\tuse this option to use an automatic config file\n");
  printf((char const   * __restrict  )"\n-r [timeout]\n");
  printf((char const   * __restrict  )"\t\tSpecify a timeout value used for reading\n");
  printf((char const   * __restrict  )"\t\tdata from hosts. The default is 60 seconds but you\n");
  printf((char const   * __restrict  )"\t\tmay have to increase it up to 90+.\n");
  printf((char const   * __restrict  )"\n-m [time to wait]\n");
  printf((char const   * __restrict  )"\t\tUse this option to specify the time to wait before checking\n");
  printf((char const   * __restrict  )"\t\tthe mail file\n");
  printf((char const   * __restrict  )"\n-l [timeout]\n");
  printf((char const   * __restrict  )"\t\tSpecify a timeout value used for connecting\n");
  printf((char const   * __restrict  )"\t\tto hosts. The default is 30 seconds but you may\n");
  printf((char const   * __restrict  )"\t\tneed to increase it with slow networks\n");
  printf((char const   * __restrict  )"\n-n\t\tUsing this option will convert all IP addresses to\n");
  printf((char const   * __restrict  )"\t\tdomiain names\n");
  printf((char const   * __restrict  )"\n-a\t\tThis option will print all of the checks to the output file\n");
  printf((char const   * __restrict  )"\t\tspecified not just the tests that fail. Failed tests\n");
  printf((char const   * __restrict  )"\t\twill be highlighted in red\n");
  printf((char const   * __restrict  )"\n-v\t\tVerbose mode. This is not a rcommended option. It\n");
  printf((char const   * __restrict  )"\t\tdisplays more output about what\'s going on.\n");
  fflush(stdout);
  exit(0);
}
}
void banner(void) 
{ 

  {
  printf((char const   * __restrict  )"\n\n\n\n\t----------------------------\n");
  printf((char const   * __restrict  )"\t|    SMTP Relay Checker    |\n");
  printf((char const   * __restrict  )"\t|      Spencer Hardy       |\n");
  printf((char const   * __restrict  )"\t|   diceman@dircon.co.uk   |\n");
  printf((char const   * __restrict  )"\t|          2.0.3           |\n");
  printf((char const   * __restrict  )"\t----------------------------\n\n\n\n");
  fflush(stdout);
  return;
}
}
